{"version":3,"sources":["../../js/map.js"],"names":["$selectExclude","$selectPokemonNotify","$selectRarityNotify","$textPerfectionNotify","$selectStyle","$selectIconResolution","$selectIconSize","$selectOpenGymsOnly","$selectTeamGymsOnly","$selectLastUpdateGymsOnly","$selectMinGymLevel","$selectMaxGymLevel","$selectLuredPokestopsOnly","$selectGymMarkerStyle","$selectLocationIconMarker","$switchGymSidebar","language","document","documentElement","lang","idToPokemon","i8lnDictionary","languageLookups","languageLookupThreshold","searchMarkerStyles","timestamp","excludedPokemon","notifiedPokemon","notifiedRarity","notifiedMinPerfection","buffer","reincludedPokemon","reids","map","rawDataIsLoading","locationMarker","rangeMarkers","storeZoom","scanPath","moves","oSwLat","oSwLng","oNeLat","oNeLng","lastpokestops","lastgyms","lastpokemon","lastslocs","lastspawns","selectedStyle","updateWorker","lastUpdateTime","gymTypes","gymPrestige","audio","Audio","genderType","unownForm","notifyIvTitle","notifyNoIvTitle","notifyText","excludePokemon","id","val","concat","trigger","notifyAboutPokemon","removePokemonMarker","encounterId","mapData","pokemons","marker","rangeCircle","setMap","hidden","initMap","google","maps","Map","getElementById","center","lat","centerLat","lng","centerLng","zoom","Store","get","fullscreenControl","streetViewControl","mapTypeControl","clickableIcons","mapTypeControlOptions","style","MapTypeControlStyle","DROPDOWN_MENU","position","ControlPosition","RIGHT_TOP","mapTypeIds","MapTypeId","ROADMAP","SATELLITE","HYBRID","styleNoLabels","StyledMapType","noLabelsStyle","name","mapTypes","set","styleDark","darkStyle","styleLight2","light2Style","stylePgo","pGoStyle","styleDarkNl","darkStyleNoLabels","styleLight2Nl","light2StyleNoLabels","stylePgoNl","pGoStyleNoLabels","stylePgoDay","pGoStyleDay","stylePgoNight","pGoStyleNight","currentDate","Date","currentHour","getHours","stylePgoDynamic","addListener","s","mapTypeId","setMapTypeId","updateMap","getZoom","redrawPokemon","lurePokemons","createMyLocationButton","initSidebar","updateLocationMarker","setIcon","icon","createLocationMarker","Marker","animation","Animation","DROP","draggable","optimized","zIndex","MAX_ZINDEX","infoWindow","InfoWindow","content","disableAutoPan","addListeners","event","newLocation","getPosition","$","prop","toggle","searchBox","places","Autocomplete","css","place","getPlace","geometry","loc","location","changeLocation","icons","each","pokemonSprites","key","value","append","attr","text","pad","number","slice","getTypeSpan","type","openMapDirections","url","window","open","getDateStr","t","dateStr","moment","format","pokemonLabel","item","rarityDisplay","types","typesDisplay","latitude","longitude","disappearTime","disappearDate","atk","def","sta","pMove1","undefined","i8ln","pMove2","weight","height","gender","form","cp","cpMultiplier","level","index","details","iv","getIv","toFixed","pokemonLevel","getPokemonLevel","contentstring","getMinutes","getSeconds","gymLabel","teamName","teamId","gymPoints","lastScanned","arguments","length","lastModified","members","guardPokemon","memberStr","i","pokemon_name","trainer_name","trainer_level","pokemon_id","pokemon_cp","lastModifiedStr","lastScannedStr","directionsStr","nameStr","gymColor","str","gymLevel","getGymLevel","points","pokestopLabel","expireTime","expireDate","formatSpawnTime","seconds","Math","floor","substr","spawnpointLabel","time","special","addRangeCircle","targetmap","circleCenter","LatLng","gymColors","teamColor","range","circleColor","rangeCircleOpts","radius","strokeWeight","strokeColor","strokeOpacity","fillColor","fillOpacity","Circle","isRangeActive","stm","round","lpad","len","padstr","Array","max","String","join","repArray","find","replace","getTimeUntil","now","tdiff","sec","min","hour","getNotifyText","ntitle","dist","toLocaleString","minute","second","hour12","until","udist","ntext","customizePokemonMarker","skipNotification","setAnimation","animationDisabled","indexOf","play","sendNotification","fav_title","fav_text","BOUNCE","perfection","setupGymMarker","scaledSize","Size","gymSidebar","querySelector","getAttribute","classList","contains","remove","setAttribute","showGymDetails","persist","isMobileDevice","isTouchDevice","clearSelection","updateLabelDiffTime","close","updateGymMarker","setContent","updateGymIcons","gyms","setupPokestopMarker","imagename","getColorByDate","diff","hue","toString","setupScannedMarker","clickable","getColorBySpawnTime","changeSpawnIcon","color","urlColor","zoomScale","minimumSize","newSize","newIcon","anchor","Point","spawnPointIndex","newIndex","scale","setupSpawnpointMarker","selection","empty","getSelection","removeAllRanges","infoWindowIsOpen","clearStaleMarkers","getTime","scanned","showInBoundsMarkers","markers","show","getBounds","intersects","team_id","getMap","oldAnimation","getAnimation","loadRawData","loadPokemon","loadGyms","loadPokestops","loadScanned","loadSpawnpoints","loadLuredOnly","Boolean","bounds","swPoint","getSouthWest","nePoint","getNorthEast","swLat","swLng","neLat","neLng","ajax","timeout","data","dataType","cache","beforeSend","error","toastr","options","complete","processPokemons","setupPokemonMarker","processPokestops","pokestops","item2","updatePokestops","removeStops","currentTime","push","processGyms","gym_points","removeGymFromMap","gymid","gymHasOpenSpot","pokemonInGym","pokemon","closePrestige","last_scanned","last_modified","processScanned","scanId","updateScanned","setOptions","processSpawnpoints","spawnpoints","updateSpawnPoints","setZIndex","getCenter","done","result","hasClass","countMarkers","filter","e","drawScanPath","scanPathPoints","idx","point","Polyline","path","geodesic","pokemonList","newMarker","element","disappearsAt","parseInt","hours","minutes","timestring","ttime","getPointDistance","pointA","pointB","spherical","computeDistanceBetween","title","Notification","permission","requestPermission","notification","body","sound","onclick","focus","centerMap","locationContainer","createElement","locationButton","backgroundColor","border","outline","width","borderRadius","boxShadow","cursor","marginRight","padding","appendChild","locationIcon","margin","backgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","addEventListener","centerMapOnLocation","controls","RIGHT_BOTTOM","currentLocation","imgX","animationInterval","setInterval","navigator","geolocation","getCurrentPosition","latlng","coords","setPosition","setCenter","clearInterval","setZoom","word","isEmptyObject","async","success","jqXHR","status","_error","console","log","updateGeoLocation","panTo","createUpdateWorker","Worker","updateBlob","Blob","updateBlobURL","URL","createObjectURL","onmessage","postMessage","ex","message","sidebar","sidebarClose","add","nextLvlPrestige","prestigePercentage","freeSlots","freeSlotsStr","gymLevelStr","pokemonHtml","headerHtml","perfectPercent","iv_attack","iv_defense","iv_stamina","moveEnergy","move_2_energy","move_1_name","move_1_type","toLowerCase","move_1_damage","move_2_name","move_2_type","move_2_damage","guard_pokemon_id","guard_pokemon_name","innerHTML","href","className","tabIndex","preventDefault","stopPropagation","toggleGymPokemonDetails","lastElementChild","firstElementChild","nextElementSibling","err","getJSON","styleList","select2","placeholder","minimumResultsForSearch","Infinity","on","checked","d","dType","searchMarkerStyleList","formatState","state","$state","numberOfPokemon","pokeList","_types","pokemonType","templateResult","Number","isNaN","buildSwitchChangeListener","storageKey","change","wrapper","hide","wrapper2","bind","setDraggable","accordion","active","collapsible","heightStyle","DataTable","paging","searching","info","errMode","order"],"mappings":";;AAAA;AACA;AACA;;AAEA,IAAIA,cAAJ;AACA,IAAIC,oBAAJ;AACA,IAAIC,mBAAJ;AACA,IAAIC,qBAAJ;AACA,IAAIC,YAAJ;AACA,IAAIC,qBAAJ;AACA,IAAIC,eAAJ;AACA,IAAIC,mBAAJ;AACA,IAAIC,mBAAJ;AACA,IAAIC,yBAAJ;AACA,IAAIC,kBAAJ;AACA,IAAIC,kBAAJ;AACA,IAAIC,yBAAJ;AACA,IAAIC,qBAAJ;AACA,IAAIC,yBAAJ;AACA,IAAIC,iBAAJ;;AAEA,IAAIC,WAAWC,SAASC,eAAT,CAAyBC,IAAzB,KAAkC,EAAlC,GAAuC,IAAvC,GAA8CF,SAASC,eAAT,CAAyBC,IAAtF;AACA,IAAIC,cAAc,EAAlB;AACA,IAAIC,iBAAiB,EAArB;AACA,IAAIC,kBAAkB,CAAtB;AACA,IAAIC,0BAA0B,CAA9B;;AAEA,IAAIC,kBAAJ;;AAEA,IAAIC,SAAJ;AACA,IAAIC,kBAAkB,EAAtB;AACA,IAAIC,kBAAkB,EAAtB;AACA,IAAIC,iBAAiB,EAArB;AACA,IAAIC,wBAAwB,IAA5B;;AAEA,IAAIC,SAAS,EAAb;AACA,IAAIC,oBAAoB,EAAxB;AACA,IAAIC,QAAQ,EAAZ;;AAEA,IAAIC,GAAJ;AACA,IAAIC,mBAAmB,KAAvB;AACA,IAAIC,cAAJ;AACA,IAAIC,eAAe,CAAC,SAAD,EAAY,UAAZ,EAAwB,KAAxB,CAAnB;AACA,IAAIC,YAAY,IAAhB;AACA,IAAIC,QAAJ;AACA,IAAIC,KAAJ;;AAEA,IAAIC,MAAJ;AACA,IAAIC,MAAJ;AACA,IAAIC,MAAJ;AACA,IAAIC,MAAJ;;AAEA,IAAIC,aAAJ;AACA,IAAIC,QAAJ;AACA,IAAIC,WAAJ;AACA,IAAIC,SAAJ;AACA,IAAIC,UAAJ;;AAEA,IAAIC,gBAAgB,OAApB;;AAEA,IAAIC,YAAJ;AACA,IAAIC,cAAJ;;AAEA,IAAIC,WAAW,CAAC,aAAD,EAAgB,QAAhB,EAA0B,OAA1B,EAAmC,UAAnC,CAAf;AACA,IAAIC,cAAc,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,KAAnB,EAA0B,KAA1B,EAAiC,KAAjC,EAAwC,KAAxC,EAA+C,KAA/C,EAAsD,KAAtD,CAAlB;AACA,IAAIC,QAAQ,IAAIC,KAAJ,CAAU,wBAAV,CAAZ;;AAEA,IAAIC,aAAa,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAjB;AACA,IAAIC,YAAY,CAAC,OAAD,EAAU,GAAV,EAAe,GAAf,EAAoB,GAApB,EAAyB,GAAzB,EAA8B,GAA9B,EAAmC,GAAnC,EAAwC,GAAxC,EAA6C,GAA7C,EAAkD,GAAlD,EAAuD,GAAvD,EAA4D,GAA5D,EAAiE,GAAjE,EAAsE,GAAtE,EAA2E,GAA3E,EAAgF,GAAhF,EAAqF,GAArF,EAA0F,GAA1F,EAA+F,GAA/F,EAAoG,GAApG,EAAyG,GAAzG,EAA8G,GAA9G,EAAmH,GAAnH,EAAwH,GAAxH,EAA6H,GAA7H,EAAkI,GAAlI,EAAuI,GAAvI,EAA4I,GAA5I,EAAiJ,GAAjJ,CAAhB;;AAEA;;;;;;;;AAQA,IAAIC,gBAAgB,kCAApB;AACA,IAAIC,kBAAkB,OAAtB;;AAEA;;;;;AAKA,IAAIC,aAAa,gCAAjB;;AAEA;AACA;AACA;;AAEA,SAASC,cAAT,CAAwBC,EAAxB,EAA4B;AAAE;AAC1B9D,mBAAe+D,GAAf,CACI/D,eAAe+D,GAAf,GAAqBC,MAArB,CAA4BF,EAA5B,CADJ,EAEEG,OAFF,CAEU,QAFV;AAGH;;AAED,SAASC,kBAAT,CAA4BJ,EAA5B,EAAgC;AAAE;AAC9B7D,yBAAqB8D,GAArB,CACI9D,qBAAqB8D,GAArB,GAA2BC,MAA3B,CAAkCF,EAAlC,CADJ,EAEEG,OAFF,CAEU,QAFV;AAGH;;AAED,SAASE,mBAAT,CAA6BC,WAA7B,EAA0C;AAAE;AACxC,QAAIC,QAAQC,QAAR,CAAiBF,WAAjB,EAA8BG,MAA9B,CAAqCC,WAAzC,EAAsD;AAClDH,gBAAQC,QAAR,CAAiBF,WAAjB,EAA8BG,MAA9B,CAAqCC,WAArC,CAAiDC,MAAjD,CAAwD,IAAxD;AACA,eAAOJ,QAAQC,QAAR,CAAiBF,WAAjB,EAA8BG,MAA9B,CAAqCC,WAA5C;AACH;AACDH,YAAQC,QAAR,CAAiBF,WAAjB,EAA8BG,MAA9B,CAAqCE,MAArC,CAA4C,IAA5C;AACAJ,YAAQC,QAAR,CAAiBF,WAAjB,EAA8BM,MAA9B,GAAuC,IAAvC;AACH;;AAED,SAASC,OAAT,GAAmB;AAAE;AACjB1C,UAAM,IAAI2C,OAAOC,IAAP,CAAYC,GAAhB,CAAoB7D,SAAS8D,cAAT,CAAwB,KAAxB,CAApB,EAAoD;AACtDC,gBAAQ;AACJC,iBAAKC,SADD;AAEJC,iBAAKC;AAFD,SAD8C;AAKtDC,cAAMA,QAAQ,IAAR,GAAeC,MAAMC,GAAN,CAAU,WAAV,CAAf,GAAwCF,IALQ;AAMtDG,2BAAmB,IANmC;AAOtDC,2BAAmB,KAPmC;AAQtDC,wBAAgB,KARsC;AAStDC,wBAAgB,KATsC;AAUtDC,+BAAuB;AACnBC,mBAAOjB,OAAOC,IAAP,CAAYiB,mBAAZ,CAAgCC,aADpB;AAEnBC,sBAAUpB,OAAOC,IAAP,CAAYoB,eAAZ,CAA4BC,SAFnB;AAGnBC,wBAAY,CACRvB,OAAOC,IAAP,CAAYuB,SAAZ,CAAsBC,OADd,EAERzB,OAAOC,IAAP,CAAYuB,SAAZ,CAAsBE,SAFd,EAGR1B,OAAOC,IAAP,CAAYuB,SAAZ,CAAsBG,MAHd,EAIR,gBAJQ,EAKR,YALQ,EAMR,cANQ,EAOR,WAPQ,EAQR,eARQ,EASR,iBATQ,EAUR,cAVQ,EAWR,eAXQ,EAYR,iBAZQ,EAaR,mBAbQ;AAHO;AAV+B,KAApD,CAAN;;AA+BA,QAAIC,gBAAgB,IAAI5B,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BC,aAA9B,EAA6C;AAC7DC,cAAM;AADuD,KAA7C,CAApB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,gBAAjB,EAAmCL,aAAnC;;AAEA,QAAIM,YAAY,IAAIlC,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BM,SAA9B,EAAyC;AACrDJ,cAAM;AAD+C,KAAzC,CAAhB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,YAAjB,EAA+BC,SAA/B;;AAEA,QAAIE,cAAc,IAAIpC,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BQ,WAA9B,EAA2C;AACzDN,cAAM;AADmD,KAA3C,CAAlB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,cAAjB,EAAiCG,WAAjC;;AAEA,QAAIE,WAAW,IAAItC,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BU,QAA9B,EAAwC;AACnDR,cAAM;AAD6C,KAAxC,CAAf;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,WAAjB,EAA8BK,QAA9B;;AAEA,QAAIE,cAAc,IAAIxC,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BY,iBAA9B,EAAiD;AAC/DV,cAAM;AADyD,KAAjD,CAAlB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,eAAjB,EAAkCO,WAAlC;;AAEA,QAAIE,gBAAgB,IAAI1C,OAAOC,IAAP,CAAY4B,aAAhB,CAA8Bc,mBAA9B,EAAmD;AACnEZ,cAAM;AAD6D,KAAnD,CAApB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,iBAAjB,EAAoCS,aAApC;;AAEA,QAAIE,aAAa,IAAI5C,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BgB,gBAA9B,EAAgD;AAC7Dd,cAAM;AADuD,KAAhD,CAAjB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,cAAjB,EAAiCW,UAAjC;;AAEA,QAAIE,cAAc,IAAI9C,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BkB,WAA9B,EAA2C;AACzDhB,cAAM;AADmD,KAA3C,CAAlB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,eAAjB,EAAkCa,WAAlC;;AAEA,QAAIE,gBAAgB,IAAIhD,OAAOC,IAAP,CAAY4B,aAAhB,CAA8BoB,aAA9B,EAA6C;AAC7DlB,cAAM;AADuD,KAA7C,CAApB;AAGA1E,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,iBAAjB,EAAoCe,aAApC;;AAEA;AACA,QAAIE,cAAc,IAAIC,IAAJ,EAAlB;AACA,QAAIC,cAAcF,YAAYG,QAAZ,EAAlB;AACA,QAAIC,kBAAkBF,eAAe,CAAf,IAAoBA,cAAc,EAAlC,GAAuCN,WAAvC,GAAqDE,aAA3E;AACA3F,QAAI2E,QAAJ,CAAaC,GAAb,CAAiB,mBAAjB,EAAsCqB,eAAtC;;AAEAjG,QAAIkG,WAAJ,CAAgB,mBAAhB,EAAqC,UAAUC,CAAV,EAAa;AAC9C9C,cAAMuB,GAAN,CAAU,WAAV,EAAuB,KAAKwB,SAA5B;AACH,KAFD;;AAIApG,QAAIqG,YAAJ,CAAiBhD,MAAMC,GAAN,CAAU,WAAV,CAAjB;AACAtD,QAAIkG,WAAJ,CAAgB,MAAhB,EAAwBI,SAAxB;;AAEAtG,QAAIkG,WAAJ,CAAgB,cAAhB,EAAgC,YAAY;AACxC,YAAI9F,cAAc,IAAlB,EAAwB;AACpBiD,kBAAMuB,GAAN,CAAU,WAAV,EAAuB,KAAK2B,OAAL,EAAvB;AACH,SAFD,MAEO;AACHnG,wBAAY,IAAZ;AACH;;AAEDoG,sBAAcpE,QAAQC,QAAtB;AACAmE,sBAAcpE,QAAQqE,YAAtB;AACH,KATD;;AAWAC;AACAC;AACH;;AAED,SAASC,oBAAT,CAA8BhD,KAA9B,EAAqC;AACjC,QAAIA,SAASrE,kBAAb,EAAiC;AAC7BW,uBAAe2G,OAAf,CAAuBtH,mBAAmBqE,KAAnB,EAA0BkD,IAAjD;AACAzD,cAAMuB,GAAN,CAAU,qBAAV,EAAiChB,KAAjC;AACH;AACD,WAAO1D,cAAP;AACH;;AAED,SAAS6G,oBAAT,GAAgC;AAC5B,QAAIhD,WAAWV,MAAMC,GAAN,CAAU,0BAAV,CAAf;AACA,QAAIN,MAAM,SAASe,QAAT,GAAoBA,SAASf,GAA7B,GAAmCC,SAA7C;AACA,QAAIC,MAAM,SAASa,QAAT,GAAoBA,SAASb,GAA7B,GAAmCC,SAA7C;;AAEA,QAAIjD,iBAAiB,IAAIyC,OAAOC,IAAP,CAAYoE,MAAhB,CAAuB;AACxChH,aAAKA,GADmC;AAExCiH,mBAAWtE,OAAOC,IAAP,CAAYsE,SAAZ,CAAsBC,IAFO;AAGxCpD,kBAAU;AACNf,iBAAKA,GADC;AAENE,iBAAKA;AAFC,SAH8B;AAOxCkE,mBAAW,KAP6B;AAQxCN,cAAM,IARkC;AASxCO,mBAAW,KAT6B;AAUxCC,gBAAQ3E,OAAOC,IAAP,CAAYoE,MAAZ,CAAmBO,UAAnB,GAAgC;AAVA,KAAvB,CAArB;;AAaArH,mBAAe2G,OAAf,CAAuBtH,mBAAmB8D,MAAMC,GAAN,CAAU,qBAAV,CAAnB,EAAqDwD,IAA5E;;AAEA5G,mBAAesH,UAAf,GAA4B,IAAI7E,OAAOC,IAAP,CAAY6E,UAAhB,CAA2B;AACnDC,iBAAS,+BAD0C;AAEnDC,wBAAgB;AAFmC,KAA3B,CAA5B;;AAKAC,iBAAa1H,cAAb;;AAEAyC,WAAOC,IAAP,CAAYiF,KAAZ,CAAkB3B,WAAlB,CAA8BhG,cAA9B,EAA8C,SAA9C,EAAyD,YAAY;AACjE,YAAI4H,cAAc5H,eAAe6H,WAAf,EAAlB;AACA1E,cAAMuB,GAAN,CAAU,0BAAV,EAAsC;AAClC5B,iBAAK8E,YAAY9E,GAAZ,EAD6B;AAElCE,iBAAK4E,YAAY5E,GAAZ;AAF6B,SAAtC;AAIH,KAND;;AAQA,WAAOhD,cAAP;AACH;;AAED,SAASyG,WAAT,GAAuB;AACnBqB,MAAE,cAAF,EAAkBC,IAAlB,CAAuB,SAAvB,EAAkC5E,MAAMC,GAAN,CAAU,UAAV,CAAlC;AACA0E,MAAE,qBAAF,EAAyBC,IAAzB,CAA8B,SAA9B,EAAyC5E,MAAMC,GAAN,CAAU,eAAV,CAAzC;AACA0E,MAAE,sBAAF,EAA0BE,MAA1B,CAAiC7E,MAAMC,GAAN,CAAU,UAAV,CAAjC;AACA0E,MAAE,sBAAF,EAA0BE,MAA1B,CAAiC7E,MAAMC,GAAN,CAAU,UAAV,CAAjC;AACA0E,MAAE,wBAAF,EAA4BlG,GAA5B,CAAgCuB,MAAMC,GAAN,CAAU,kBAAV,CAAhC;AACA0E,MAAE,wBAAF,EAA4BlG,GAA5B,CAAgCuB,MAAMC,GAAN,CAAU,kBAAV,CAAhC;AACA0E,MAAE,+BAAF,EAAmClG,GAAnC,CAAuCuB,MAAMC,GAAN,CAAU,aAAV,CAAvC;AACA0E,MAAE,+BAAF,EAAmClG,GAAnC,CAAuCuB,MAAMC,GAAN,CAAU,aAAV,CAAvC;AACA0E,MAAE,0BAAF,EAA8BlG,GAA9B,CAAkCuB,MAAMC,GAAN,CAAU,yBAAV,CAAlC;AACA0E,MAAE,iBAAF,EAAqBC,IAArB,CAA0B,SAA1B,EAAqC5E,MAAMC,GAAN,CAAU,aAAV,CAArC;AACA0E,MAAE,mBAAF,EAAuBC,IAAvB,CAA4B,SAA5B,EAAuC5E,MAAMC,GAAN,CAAU,eAAV,CAAvC;AACA0E,MAAE,8BAAF,EAAkClG,GAAlC,CAAsCuB,MAAMC,GAAN,CAAU,wBAAV,CAAtC;AACA0E,MAAE,+BAAF,EAAmCE,MAAnC,CAA0C7E,MAAMC,GAAN,CAAU,eAAV,CAA1C;AACA0E,MAAE,gCAAF,EAAoCC,IAApC,CAAyC,SAAzC,EAAoD5E,MAAMC,GAAN,CAAU,qBAAV,CAApD;AACA0E,MAAE,gCAAF,EAAoCC,IAApC,CAAyC,SAAzC,EAAoD5E,MAAMC,GAAN,CAAU,qBAAV,CAApD;AACA0E,MAAE,4BAAF,EAAgCC,IAAhC,CAAqC,SAArC,EAAgD5E,MAAMC,GAAN,CAAU,kBAAV,CAAhD;AACA0E,MAAE,iBAAF,EAAqBC,IAArB,CAA0B,SAA1B,EAAqC5E,MAAMC,GAAN,CAAU,aAAV,CAArC;AACA0E,MAAE,qBAAF,EAAyBC,IAAzB,CAA8B,SAA9B,EAAyC5E,MAAMC,GAAN,CAAU,iBAAV,CAAzC;AACA0E,MAAE,gBAAF,EAAoBC,IAApB,CAAyB,SAAzB,EAAoC5E,MAAMC,GAAN,CAAU,YAAV,CAApC;AACA0E,MAAE,eAAF,EAAmBC,IAAnB,CAAwB,SAAxB,EAAmC5E,MAAMC,GAAN,CAAU,WAAV,CAAnC;AACA,QAAItE,SAAS8D,cAAT,CAAwB,eAAxB,CAAJ,EAA8C;AAC1C,YAAIqF,YAAY,IAAIxF,OAAOC,IAAP,CAAYwF,MAAZ,CAAmBC,YAAvB,CAAoCrJ,SAAS8D,cAAT,CAAwB,eAAxB,CAApC,CAAhB;AACAkF,UAAE,gBAAF,EAAoBM,GAApB,CAAwB,kBAAxB,EAA4CN,EAAE,gBAAF,EAAoBC,IAApB,CAAyB,SAAzB,IAAsC,SAAtC,GAAkD,SAA9F;;AAEAE,kBAAUjC,WAAV,CAAsB,eAAtB,EAAuC,YAAY;AAC/C,gBAAIqC,QAAQJ,UAAUK,QAAV,EAAZ;;AAEA,gBAAI,CAACD,MAAME,QAAX,EAAqB;;AAErB,gBAAIC,MAAMH,MAAME,QAAN,CAAeE,QAAzB;AACAC,2BAAeF,IAAI1F,GAAJ,EAAf,EAA0B0F,IAAIxF,GAAJ,EAA1B;AACH,SAPD;AAQH;;AAED,QAAI2F,QAAQb,EAAE,gBAAF,CAAZ;AACAA,MAAEc,IAAF,CAAOC,cAAP,EAAuB,UAAUC,GAAV,EAAeC,KAAf,EAAsB;AACzCJ,cAAMK,MAAN,CAAalB,EAAE,mBAAF,EAAuBmB,IAAvB,CAA4B,OAA5B,EAAqCH,GAArC,EAA0CI,IAA1C,CAA+CH,MAAMvE,IAArD,CAAb;AACH,KAFD;AAGAmE,UAAM/G,GAAN,CAAUiH,eAAe1F,MAAMC,GAAN,CAAU,cAAV,CAAf,IAA4CD,MAAMC,GAAN,CAAU,cAAV,CAA5C,GAAwE,SAAlF;;AAEA0E,MAAE,oBAAF,EAAwBlG,GAAxB,CAA4BuB,MAAMC,GAAN,CAAU,kBAAV,CAA5B;AACH;;AAED,SAAS+F,GAAT,CAAaC,MAAb,EAAqB;AACjB,WAAOA,UAAU,EAAV,GAAe,CAAC,MAAMA,MAAP,EAAeC,KAAf,CAAqB,CAAC,CAAtB,CAAf,GAA0CD,MAAjD;AACH;;AAED,SAASE,WAAT,CAAqBC,IAArB,EAA2B;AACvB,WAAO,+KAA+KA,KAAK,OAAL,CAA/K,GAA+L,KAA/L,GAAuMA,KAAK,MAAL,CAAvM,GAAsN,SAA7N;AACH;;AAED,SAASC,iBAAT,CAA2B1G,GAA3B,EAAgCE,GAAhC,EAAqC;AAAE;AACnC,QAAIyG,MAAM,wCAAwC3G,GAAxC,GAA8C,GAA9C,GAAoDE,GAA9D;AACA0G,WAAOC,IAAP,CAAYF,GAAZ,EAAiB,QAAjB;AACH;;AAED;AACA,SAASG,UAAT,CAAoBC,CAApB,EAAuB;AACnB,QAAIC,UAAU,SAAd;AACA,QAAID,CAAJ,EAAO;AACHC,kBAAUC,OAAOF,CAAP,EAAUG,MAAV,CAAiB,sBAAjB,CAAV;AACH;AACD,WAAOF,OAAP;AACH;;AAED,SAASG,YAAT,CAAsBC,IAAtB,EAA4B;AACxB,QAAI1F,OAAO0F,KAAK,cAAL,CAAX;AACA,QAAIC,gBAAgBD,KAAK,gBAAL,IAAyB,MAAMA,KAAK,gBAAL,CAAN,GAA+B,GAAxD,GAA8D,EAAlF;AACA,QAAIE,QAAQF,KAAK,eAAL,CAAZ;AACA,QAAIG,eAAe,EAAnB;AACA,QAAIpI,cAAciI,KAAK,cAAL,CAAlB;AACA,QAAIvI,KAAKuI,KAAK,YAAL,CAAT;AACA,QAAII,WAAWJ,KAAK,UAAL,CAAf;AACA,QAAIK,YAAYL,KAAK,WAAL,CAAhB;AACA,QAAIM,gBAAgBN,KAAK,gBAAL,CAApB;AACA,QAAIO,gBAAgB,IAAI7E,IAAJ,CAAS4E,aAAT,CAApB;AACA,QAAIE,MAAMR,KAAK,mBAAL,CAAV;AACA,QAAIS,MAAMT,KAAK,oBAAL,CAAV;AACA,QAAIU,MAAMV,KAAK,oBAAL,CAAV;AACA,QAAIW,SAASzK,MAAM8J,KAAK,QAAL,CAAN,MAA0BY,SAA1B,GAAsCC,KAAK3K,MAAM8J,KAAK,QAAL,CAAN,EAAsB,MAAtB,CAAL,CAAtC,GAA4E,aAAzF;AACA,QAAIc,SAAS5K,MAAM8J,KAAK,QAAL,CAAN,MAA0BY,SAA1B,GAAsCC,KAAK3K,MAAM8J,KAAK,QAAL,CAAN,EAAsB,MAAtB,CAAL,CAAtC,GAA4E,aAAzF;AACA,QAAIe,SAASf,KAAK,QAAL,CAAb;AACA,QAAIgB,SAAShB,KAAK,QAAL,CAAb;AACA,QAAIiB,SAASjB,KAAK,QAAL,CAAb;AACA,QAAIkB,OAAOlB,KAAK,MAAL,CAAX;AACA,QAAImB,KAAKnB,KAAK,IAAL,CAAT;AACA,QAAIoB,eAAepB,KAAK,eAAL,CAAnB;AACA,QAAIqB,QAAQrB,KAAK,OAAL,CAAZ;;AAEApC,MAAEc,IAAF,CAAOwB,KAAP,EAAc,UAAUoB,KAAV,EAAiBjC,IAAjB,EAAuB;AACjCc,wBAAgBf,YAAYC,IAAZ,CAAhB;AACH,KAFD;;AAIA,QAAIkC,UAAU,EAAd;AACA,QAAIf,OAAO,IAAP,IAAeC,OAAO,IAAtB,IAA8BC,OAAO,IAAzC,EAA+C;AAC3C,YAAIc,KAAKC,MAAMjB,GAAN,EAAWC,GAAX,EAAgBC,GAAhB,CAAT;AACAa,kBACI,UACA,MADA,GACSC,GAAGE,OAAH,CAAW,CAAX,CADT,GACyB,KADzB,GACiClB,GADjC,GACuC,GADvC,GAC6CC,GAD7C,GACmD,GADnD,GACyDC,GADzD,GAC+D,GAD/D,GAEA,QAHJ;;AAKA,YAAIS,MAAM,IAAN,KAAeC,gBAAgB,IAAhB,IAAwBC,SAAS,IAAhD,CAAJ,EAA2D;AACvD,gBAAIM,YAAJ;AACA,gBAAIN,SAAS,IAAb,EAAmB;AACfM,+BAAeN,KAAf;AACH,aAFD,MAEO;AACHM,+BAAeC,gBAAgBR,YAAhB,CAAf;AACH;AACDG,uBACI,UACA,MADA,GACSJ,EADT,GACc,YADd,GAC6BQ,YAD7B,GAEA,QAHJ;AAIH;;AAEDJ,mBACI,UACA,SADA,GACYZ,MADZ,GACqB,KADrB,GAC6BG,MAD7B,GAEA,QAHJ;AAIH;AACD,QAAIG,UAAU,IAAd,EAAoB;AAChBM,mBACI,UACA,UADA,GACapK,WAAW8J,SAAS,CAApB,CAFjB;AAGA,YAAIF,UAAU,IAAV,IAAkBC,UAAU,IAAhC,EAAsC;AAClCO,uBAAW,gBAAgBR,OAAOW,OAAP,CAAe,CAAf,CAAhB,GAAoC,eAApC,GAAsDV,OAAOU,OAAP,CAAe,CAAf,CAAtD,GAA0E,GAArF;AACH;AACDH,mBACI,QADJ;AAEH;AACD,QAAIM,gBACA,UACA,KADA,GACQvH,IADR,GACe,MAFnB;AAGA,QAAI7C,OAAO,GAAP,IAAcyJ,SAAS,IAAvB,IAA+BA,OAAO,CAA1C,EAA6C;AACzCW,yBAAiB,OAAOzK,UAAU4I,KAAK,MAAL,CAAV,CAAP,GAAiC,GAAlD;AACH;AACD6B,qBAAiB,qBACb,SADa,GAEb,kDAFa,GAEwCpK,EAFxC,GAE6C,6CAF7C,GAE6FA,EAF7F,GAEkG,MAFlG,GAGb,UAHa,GAIb,SAJa,GAIDwI,aAJC,GAIe,SAJf,GAKb,kBALa,GAMb,SANa,GAMDE,YANC,GAMc,UANd,GAOb,QAPa,GAQb,OARa,GASb,gBATa,GASMlB,IAAIsB,cAAc3E,QAAd,EAAJ,CATN,GASsC,GATtC,GAS4CqD,IAAIsB,cAAcuB,UAAd,EAAJ,CAT5C,GAS8E,GAT9E,GASoF7C,IAAIsB,cAAcwB,UAAd,EAAJ,CATpF,GAUb,+CAVa,GAUqCzB,aAVrC,GAUqD,mBAVrD,GAWb,QAXa,GAYb,OAZa,GAab,YAba,GAaEF,SAASsB,OAAT,CAAiB,CAAjB,CAbF,GAawB,IAbxB,GAa+BrB,UAAUqB,OAAV,CAAkB,CAAlB,CAb/B,GAcb,QAda,GAebH,OAfa,GAgBb,OAhBa,GAiBb,qCAjBa,GAiB2B9J,EAjB3B,GAiBgC,0BAjBhC,GAkBb,yCAlBa,GAkB+BA,EAlB/B,GAkBoC,yBAlBpC,GAmBb,4CAnBa,GAmBkCM,WAnBlC,GAmBgD,2BAnBhD,GAoBb,qEApBa,GAoB2DqI,QApB3D,GAoBsE,IApBtE,GAoB6EC,SApB7E,GAoByF,4CApBzF,GAqBb,QArBJ;AAsBA,WAAOwB,aAAP;AACH;;AAED,SAASG,QAAT,CAAkBC,QAAlB,EAA4BC,MAA5B,EAAoCC,SAApC,EAA+C/B,QAA/C,EAAyDC,SAAzD,EAAoE;AAChE,QAAI+B,cAAcC,UAAUC,MAAV,GAAmB,CAAnB,IAAwBD,UAAU,CAAV,MAAiBzB,SAAzC,GAAqDyB,UAAU,CAAV,CAArD,GAAoE,IAAtF;AACA,QAAIE,eAAeF,UAAUC,MAAV,GAAmB,CAAnB,IAAwBD,UAAU,CAAV,MAAiBzB,SAAzC,GAAqDyB,UAAU,CAAV,CAArD,GAAoE,IAAvF;AACA,QAAI/H,OAAO+H,UAAUC,MAAV,GAAmB,CAAnB,IAAwBD,UAAU,CAAV,MAAiBzB,SAAzC,GAAqDyB,UAAU,CAAV,CAArD,GAAoE,IAA/E;AACA,QAAIG,UAAUH,UAAUC,MAAV,GAAmB,CAAnB,IAAwBD,UAAU,CAAV,MAAiBzB,SAAzC,GAAqDyB,UAAU,CAAV,CAArD,GAAoE,EAAlF;AACA;AACA,QAAII,eAAeJ,UAAU,EAAV,CAAnB;;AAEA,QAAIK,YAAY,EAAhB;AACA,QAAIF,QAAQF,MAAR,GAAiB,CAArB,EAAwB;AACpB,aAAK,IAAIK,IAAI,CAAb,EAAgBA,IAAIH,QAAQF,MAA5B,EAAoCK,GAApC,EAAyC;AACrCD,yBACI,qCAAqCF,QAAQG,CAAR,EAAWC,YAAhD,GAA+D,KAA/D,GAAuEJ,QAAQG,CAAR,EAAWE,YAAlF,GAAiG,QAAjG,GAA4GL,QAAQG,CAAR,EAAWG,aAAvH,GAAuI,IAAvI,GACA,4BADA,GAC+BN,QAAQG,CAAR,EAAWI,UAD1C,GACuD,QADvD,GAEA,uBAFA,GAE0Bb,MAF1B,GAEmC,IAFnC,GAE0CM,QAAQG,CAAR,EAAWK,UAFrD,GAEkE,SAFlE,GAGA,SAJJ;AAKH;AACJ,KARD,MAQO;AACHN,oBACI,8BACA,4BADA,GAC+BD,YAD/B,GAC8C,QAD9C,GAEA,SAHJ;AAIH;;AAED,QAAIQ,kBAAkBvD,WAAW6C,YAAX,CAAtB;AACA,QAAIW,iBAAiB,EAArB;AACA,QAAId,eAAe,IAAnB,EAAyB;AACrBc,yBACI,UACA,gBADA,GACmBxD,WAAW0C,WAAX,CADnB,GAEA,QAHJ;AAIH;AACD,QAAIe,gBAAgB,EAApB;AACA,QAAI,CAAClK,MAAMC,GAAN,CAAU,eAAV,CAAL,EAAiC;AAC7BiK,wBACI,UACA,wEADA,GAC2E/C,QAD3E,GACsF,GADtF,GAC4FC,SAD5F,GACwG,+CADxG,GAEA,QAHJ;AAIH;;AAED,QAAI+C,UAAU9I,OAAO,UAAUA,IAAV,GAAiB,QAAxB,GAAmC,EAAjD;;AAEA,QAAI+I,WAAW,CAAC,aAAD,EAAgB,kBAAhB,EAAoC,iBAApC,EAAuD,kBAAvD,CAAf;AACA,QAAIC,GAAJ;AACA,QAAIpB,WAAW,CAAf,EAAkB;AACdoB,cAAM,WACF,UADE,GAEF,OAFE,GAGF,uBAHE,GAGwBD,SAASnB,MAAT,CAHxB,GAG2C,KAH3C,GAGmDD,QAHnD,GAG8D,UAH9D,GAIF,4DAJE,GAI6DA,QAJ7D,GAIwE,cAJxE,GAKF,QALE,GAMFmB,OANE,GAOF,OAPE,GAQF,YARE,GAQahD,SAASsB,OAAT,CAAiB,CAAjB,CARb,GAQmC,IARnC,GAQ0CrB,UAAUqB,OAAV,CAAkB,CAAlB,CAR1C,GASF,QATE,GAUF,OAVE,GAWF,iBAXE,GAWkBuB,eAXlB,GAYF,QAZE,GAaFC,cAbE,GAcFC,aAdE,GAeF,WAfE,GAgBF,QAhBJ;AAiBH,KAlBD,MAkBO;AACH,YAAII,WAAWC,YAAYrB,SAAZ,CAAf;AACAmB,cACI,UACA,UADA,GAEA,mCAFA,GAGA,eAHA,GAIA,QAJA,GAKA,OALA,GAMA,uBANA,GAM0BD,SAASnB,MAAT,CAN1B,GAM6C,UAN7C,GAM0DD,QAN1D,GAMqE,UANrE,GAOA,4DAPA,GAO+DA,QAP/D,GAO0E,cAP1E,GAQA,QARA,GASA,OATA,GAUAmB,OAVA,GAWA,QAXA,GAYA,OAZA,GAaA,SAbA,GAaYG,QAbZ,GAauB,eAbvB,GAayCpB,SAbzC,GAaqD,GAbrD,IAa4DnL,YAAYuM,WAAW,CAAvB,KAA6B,KAbzF,IAcA,QAdA,GAeA,OAfA,GAeUb,SAfV,GAgBA,QAhBA,GAiBA,OAjBA,GAkBA,YAlBA,GAkBetC,SAASsB,OAAT,CAAiB,CAAjB,CAlBf,GAkBqC,IAlBrC,GAkB4CrB,UAAUqB,OAAV,CAAkB,CAAlB,CAlB5C,GAmBA,QAnBA,GAoBA,OApBA,GAqBA,iBArBA,GAqBoBuB,eArBpB,GAsBA,QAtBA,GAsBWC,cAtBX,GAuBAC,aAvBA,GAwBA,WAxBA,GAyBA,QA1BJ;AA2BH;;AAED,WAAOG,GAAP;AACH;;AAED,SAASE,WAAT,CAAqBC,MAArB,EAA6B;AACzB,QAAIpC,QAAQ,CAAZ;AACA,WAAOoC,UAAUzM,YAAYqK,QAAQ,CAApB,CAAjB,EAAyC;AACrCA;AACH;;AAED,WAAOA,KAAP;AACH;;AAED,SAASqC,aAAT,CAAuBC,UAAvB,EAAmCvD,QAAnC,EAA6CC,SAA7C,EAAwD;AACpD,QAAIiD,GAAJ;AACA,QAAIK,UAAJ,EAAgB;AACZ,YAAIC,aAAa,IAAIlI,IAAJ,CAASiI,UAAT,CAAjB;;AAEAL,cACI,UACA,uBADA,GAEA,QAFA,GAGA,OAHA,GAIA,kBAJA,GAIqBrE,IAAI2E,WAAWhI,QAAX,EAAJ,CAJrB,GAIkD,GAJlD,GAIwDqD,IAAI2E,WAAW9B,UAAX,EAAJ,CAJxD,GAIuF,GAJvF,GAI6F7C,IAAI2E,WAAW7B,UAAX,EAAJ,CAJ7F,GAKA,+CALA,GAKkD4B,UALlD,GAK+D,mBAL/D,GAMA,QANA,GAOA,OAPA,GAQA,YARA,GAQevD,SAASsB,OAAT,CAAiB,CAAjB,CARf,GAQqC,IARrC,GAQ4CrB,UAAUqB,OAAV,CAAkB,CAAlB,CAR5C,GASA,QATA,GAUA,OAVA,GAWA,qEAXA,GAWwEtB,QAXxE,GAWmF,GAXnF,GAWyFC,SAXzF,GAWqG,4CAXrG,GAYA,QAbJ;AAcH,KAjBD,MAiBO;AACHiD,cACI,UACA,iBADA,GAEA,QAFA,GAGA,OAHA,GAIA,YAJA,GAIelD,SAASsB,OAAT,CAAiB,CAAjB,CAJf,GAIqC,IAJrC,GAI4CrB,UAAUqB,OAAV,CAAkB,CAAlB,CAJ5C,GAKA,QALA,GAMA,OANA,GAOA,qEAPA,GAOwEtB,QAPxE,GAOmF,GAPnF,GAOyFC,SAPzF,GAOqG,4CAPrG,GAQA,QATJ;AAUH;;AAED,WAAOiD,GAAP;AACH;;AAED,SAASO,eAAT,CAAyBC,OAAzB,EAAkC;AAC9B;AACA;AACA,WAAO,CAAC,MAAMC,KAAKC,KAAL,CAAW,CAACF,UAAU,IAAX,IAAmB,IAAnB,GAA0B,EAArC,CAAP,EAAiDG,MAAjD,CAAwD,CAAC,CAAzD,IAA8D,GAA9D,GAAoE,CAAC,MAAMH,UAAU,EAAjB,EAAqBG,MAArB,CAA4B,CAAC,CAA7B,CAA3E;AACH;;AAED,SAASC,eAAT,CAAyBlE,IAAzB,EAA+B;AAC3B,QAAIsD,MACA,UACA,oBADA,GAEA,QAFA,GAGA,OAHA,GAIA,kBAJA,GAIqBO,gBAAgB7D,KAAKmE,IAArB,CAJrB,GAIkD,MAJlD,GAI2DN,gBAAgB7D,KAAKmE,IAAL,GAAY,GAA5B,CAJ3D,GAKA,QANJ;;AAQA,QAAInE,KAAKoE,OAAT,EAAkB;AACdd,eACI,UACA,yBADA,GAC4BO,gBAAgB7D,KAAKmE,IAAL,GAAY,IAA5B,CAD5B,GAEA,QAHJ;AAIH;AACD,WAAOb,GAAP;AACH;;AAED,SAASe,cAAT,CAAwBnM,MAAxB,EAAgCtC,GAAhC,EAAqCyJ,IAArC,EAA2C6C,MAA3C,EAAmD;AAC/C,QAAIoC,YAAY,IAAhB;AACA,QAAIC,eAAe,IAAIhM,OAAOC,IAAP,CAAYgM,MAAhB,CAAuBtM,OAAOyB,QAAP,CAAgBf,GAAhB,EAAvB,EAA8CV,OAAOyB,QAAP,CAAgBb,GAAhB,EAA9C,CAAnB;AACA,QAAI2L,YAAY,CAAC,SAAD,EAAY,SAAZ,EAAuB,SAAvB,EAAkC,SAAlC,CAAhB,CAH+C,CAGc;AAC7D,QAAIC,YAAYD,UAAU,CAAV,CAAhB;AACA,QAAIvC,MAAJ,EAAYwC,YAAYD,UAAUvC,MAAV,CAAZ;;AAEZ,QAAIyC,KAAJ;AACA,QAAIC,WAAJ;;AAEA;AACA,YAAQvF,IAAR;AACI,aAAK,SAAL;AACIuF,0BAAc,SAAd;AACAD,oBAAQ,EAAR,CAFJ,CAEe;AACX;AACJ,aAAK,UAAL;AACIC,0BAAc,SAAd;AACAD,oBAAQ,EAAR;AACA;AACJ,aAAK,KAAL;AACIC,0BAAcF,SAAd;AACAC,oBAAQ,EAAR;AACA;AAZR;;AAeA,QAAI/O,GAAJ,EAAS0O,YAAY1O,GAAZ;;AAET,QAAIiP,kBAAkB;AAClBjP,aAAK0O,SADa;AAElBQ,gBAAQH,KAFU,EAEH;AACfI,sBAAc,CAHI;AAIlBC,qBAAaJ,WAJK;AAKlBK,uBAAe,GALG;AAMlBtM,gBAAQ4L,YANU;AAOlBW,mBAAWN,WAPO;AAQlBO,qBAAa;AARK,KAAtB;AAUA,QAAIhN,cAAc,IAAII,OAAOC,IAAP,CAAY4M,MAAhB,CAAuBP,eAAvB,CAAlB;AACA,WAAO1M,WAAP;AACH;;AAED,SAASkN,aAAT,CAAuBzP,GAAvB,EAA4B;AACxB,QAAIA,IAAIuG,OAAJ,KAAgB,EAApB,EAAwB,OAAO,KAAP;AACxB,WAAOlD,MAAMC,GAAN,CAAU,YAAV,CAAP;AACH;;AAED,SAASuI,KAAT,CAAejB,GAAf,EAAoBC,GAApB,EAAyB6E,GAAzB,EAA8B;AAC1B,QAAI9E,QAAQ,IAAZ,EAAkB;AACd,eAAO,SAASA,MAAMC,GAAN,GAAY6E,GAArB,IAA4B,EAAnC;AACH;;AAED,WAAO,KAAP;AACH;;AAED,SAAS1D,eAAT,CAAyBR,YAAzB,EAAuC;AACnC,QAAIA,eAAe,KAAnB,EAA0B;AACtB,YAAIO,eAAe,cAAcP,YAAd,GAA6BA,YAA7B,GAA4C,cAAcA,YAA1D,GAAyE,YAA5F;AACH,KAFD,MAEO;AACHO,uBAAe,cAAcP,YAAd,GAA6B,WAA5C;AACH;AACDO,mBAAeoC,KAAKwB,KAAL,CAAW5D,YAAX,IAA2B,CAA3B,GAA+B,CAA9C;;AAEA,WAAOA,YAAP;AACH;;AAED,SAAS6D,IAAT,CAAclC,GAAd,EAAmBmC,GAAnB,EAAwBC,MAAxB,EAAgC;AAC5B,WAAOC,MAAM5B,KAAK6B,GAAL,CAASH,MAAMI,OAAOvC,GAAP,EAAYhB,MAAlB,GAA2B,CAApC,EAAuC,CAAvC,CAAN,EAAiDwD,IAAjD,CAAsDJ,MAAtD,IAAgEpC,GAAvE;AACH;;AAED,SAASyC,QAAT,CAAkB/G,IAAlB,EAAwBgH,IAAxB,EAA8BC,OAA9B,EAAuC;AACnC,SAAK,IAAItD,IAAI,CAAb,EAAgBA,IAAIqD,KAAK1D,MAAzB,EAAiCK,GAAjC,EAAsC;AAClC3D,eAAOA,KAAKiH,OAAL,CAAaD,KAAKrD,CAAL,CAAb,EAAsBsD,QAAQtD,CAAR,CAAtB,CAAP;AACH;;AAED,WAAO3D,IAAP;AACH;;AAED,SAASkH,YAAT,CAAsB/B,IAAtB,EAA4B;AACxB,QAAIgC,MAAM,CAAC,IAAIzK,IAAJ,EAAX;AACA,QAAI0K,QAAQjC,OAAOgC,GAAnB;;AAEA,QAAIE,MAAMtC,KAAKC,KAAL,CAAWoC,QAAQ,IAAR,GAAe,EAA1B,CAAV;AACA,QAAIE,MAAMvC,KAAKC,KAAL,CAAWoC,QAAQ,IAAR,GAAe,EAAf,GAAoB,EAA/B,CAAV;AACA,QAAIG,OAAOxC,KAAKC,KAAL,CAAWoC,SAAS,OAAO,EAAP,GAAY,EAArB,IAA2B,EAAtC,CAAX;;AAEA,WAAO;AACH,iBAASA,KADN;AAEH,gBAAQG,IAFL;AAGH,eAAOD,GAHJ;AAIH,eAAOD,GAJJ;AAKH,eAAOF,GALJ;AAMH,iBAAShC;AANN,KAAP;AAQH;;AAED,SAASqC,aAAT,CAAuBxG,IAAvB,EAA6B;AACzB,QAAIwB,KAAKC,MAAMzB,KAAK,mBAAL,CAAN,EAAiCA,KAAK,oBAAL,CAAjC,EAA6DA,KAAK,oBAAL,CAA7D,CAAT;AACA,QAAIgG,OAAO,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB,EAA4B,OAA5B,EAAqC,OAArC,CAAX;AACA,QAAIC,UAAU,CAACzE,KAAKA,GAAGE,OAAH,CAAW,CAAX,CAAL,GAAqB,EAAtB,EAA0B1B,KAAK,cAAL,CAA1B,EAAgDA,KAAK,mBAAL,CAAhD,EAA2EA,KAAK,oBAAL,CAA3E,EAAuGA,KAAK,oBAAL,CAAvG,CAAd;AACA,QAAIyG,SAASV,SAASvE,KAAKnK,aAAL,GAAqBC,eAA9B,EAA+C0O,IAA/C,EAAqDC,OAArD,CAAb;AACA,QAAIS,OAAO,IAAIhL,IAAJ,CAASsE,KAAK,gBAAL,CAAT,EAAiC2G,cAAjC,CAAgD,EAAhD,EAAoD;AAC3DJ,cAAM,SADqD,EAC1CK,QAAQ,SADkC;AAE3DC,gBAAQ,SAFmD,EAExCC,QAAQ;AAFgC,KAApD,CAAX;AAIA,QAAIC,QAAQb,aAAalG,KAAK,gBAAL,CAAb,CAAZ;AACA,QAAIgH,QAAQD,MAAMR,IAAN,GAAa,CAAb,GAAiBQ,MAAMR,IAAN,GAAa,GAA9B,GAAoC,EAAhD;AACAS,aAASxB,KAAKuB,MAAMT,GAAX,EAAgB,CAAhB,EAAmB,CAAnB,IAAwB,GAAxB,GAA8Bd,KAAKuB,MAAMV,GAAX,EAAgB,CAAhB,EAAmB,CAAnB,CAA9B,GAAsD,GAA/D;AACAL,WAAO,CAAC,QAAD,EAAW,SAAX,CAAP;AACAC,cAAU,CAACS,IAAD,EAAOM,KAAP,CAAV;AACA,QAAIC,QAAQlB,SAASxO,UAAT,EAAqByO,IAArB,EAA2BC,OAA3B,CAAZ;;AAEA,WAAO;AACH,qBAAaQ,MADV;AAEH,oBAAYQ;AAFT,KAAP;AAIH;;AAED,SAASC,sBAAT,CAAgChP,MAAhC,EAAwC8H,IAAxC,EAA8CmH,gBAA9C,EAAgE;AAC5DjP,WAAO4D,WAAP,CAAmB,OAAnB,EAA4B,YAAY;AACpC,aAAKsL,YAAL,CAAkB,IAAlB;AACA,aAAKC,iBAAL,GAAyB,IAAzB;AACH,KAHD;;AAKA,QAAI,CAACnP,OAAOC,WAAR,IAAuBkN,cAAczP,GAAd,CAA3B,EAA+C;AAC3CsC,eAAOC,WAAP,GAAqBkM,eAAenM,MAAf,EAAuBtC,GAAvB,EAA4B,SAA5B,CAArB;AACH;;AAEDsC,WAAOkF,UAAP,GAAoB,IAAI7E,OAAOC,IAAP,CAAY6E,UAAhB,CAA2B;AAC3CC,iBAASyC,aAAaC,IAAb,CADkC;AAE3CzC,wBAAgB;AAF2B,KAA3B,CAApB;;AAKA,QAAIjI,gBAAgBgS,OAAhB,CAAwBtH,KAAK,YAAL,CAAxB,IAA8C,CAAC,CAA/C,IAAoDzK,eAAe+R,OAAf,CAAuBtH,KAAK,gBAAL,CAAvB,IAAiD,CAAC,CAA1G,EAA6G;AACzG,YAAI,CAACmH,gBAAL,EAAuB;AACnB,gBAAIlO,MAAMC,GAAN,CAAU,WAAV,CAAJ,EAA4B;AACxBjC,sBAAMsQ,IAAN;AACH;AACDC,6BAAiBhB,cAAcxG,IAAd,EAAoByH,SAArC,EAAgDjB,cAAcxG,IAAd,EAAoB0H,QAApE,EAA8E,kBAAkB1H,KAAK,YAAL,CAAlB,GAAuC,MAArH,EAA6HA,KAAK,UAAL,CAA7H,EAA+IA,KAAK,WAAL,CAA/I;AACH;AACD,YAAI9H,OAAOmP,iBAAP,KAA6B,IAAjC,EAAuC;AACnCnP,mBAAOkP,YAAP,CAAoB7O,OAAOC,IAAP,CAAYsE,SAAZ,CAAsB6K,MAA1C;AACH;AACJ;;AAED,QAAI3H,KAAK,mBAAL,KAA6B,IAAjC,EAAuC;AACnC,YAAI4H,aAAanG,MAAMzB,KAAK,mBAAL,CAAN,EAAiCA,KAAK,oBAAL,CAAjC,EAA6DA,KAAK,oBAAL,CAA7D,CAAjB;AACA,YAAIxK,wBAAwB,CAAxB,IAA6BoS,cAAcpS,qBAA/C,EAAsE;AAClE,gBAAI,CAAC2R,gBAAL,EAAuB;AACnB,oBAAIlO,MAAMC,GAAN,CAAU,WAAV,CAAJ,EAA4B;AACxBjC,0BAAMsQ,IAAN;AACH;AACDC,iCAAiBhB,cAAcxG,IAAd,EAAoByH,SAArC,EAAgDjB,cAAcxG,IAAd,EAAoB0H,QAApE,EAA8E,kBAAkB1H,KAAK,YAAL,CAAlB,GAAuC,MAArH,EAA6HA,KAAK,UAAL,CAA7H,EAA+IA,KAAK,WAAL,CAA/I;AACH;AACD,gBAAI9H,OAAOmP,iBAAP,KAA6B,IAAjC,EAAuC;AACnCnP,uBAAOkP,YAAP,CAAoB7O,OAAOC,IAAP,CAAYsE,SAAZ,CAAsB6K,MAA1C;AACH;AACJ;AACJ;;AAEDnK,iBAAatF,MAAb;AACH;;AAED,SAAS2P,cAAT,CAAwB7H,IAAxB,EAA8B;AAC1B,QAAI9H,SAAS,IAAIK,OAAOC,IAAP,CAAYoE,MAAhB,CAAuB;AAChCjD,kBAAU;AACNf,iBAAKoH,KAAK,UAAL,CADC;AAENlH,iBAAKkH,KAAK,WAAL;AAFC,SADsB;AAKhCpK,aAAKA,GAL2B;AAMhC8G,cAAM;AACF6C,iBAAK,kBAAkBtG,MAAMC,GAAN,CAAU,gBAAV,CAAlB,GAAgD,GAAhD,GAAsDnC,SAASiJ,KAAK,SAAL,CAAT,CAAtD,IAAmFA,KAAK,SAAL,MAAoB,CAApB,GAAwB,MAAMwD,YAAYxD,KAAK,YAAL,CAAZ,CAA9B,GAAgE,EAAnJ,IAAyJ,MAD5J;AAEF8H,wBAAY,IAAIvP,OAAOC,IAAP,CAAYuP,IAAhB,CAAqB,EAArB,EAAyB,EAAzB;AAFV;AAN0B,KAAvB,CAAb;;AAYA,QAAI,CAAC7P,OAAOC,WAAR,IAAuBkN,cAAczP,GAAd,CAA3B,EAA+C;AAC3CsC,eAAOC,WAAP,GAAqBkM,eAAenM,MAAf,EAAuBtC,GAAvB,EAA4B,KAA5B,EAAmCoK,KAAK,SAAL,CAAnC,CAArB;AACH;;AAED9H,WAAOkF,UAAP,GAAoB,IAAI7E,OAAOC,IAAP,CAAY6E,UAAhB,CAA2B;AAC3CC,iBAAS0E,SAASjL,SAASiJ,KAAK,SAAL,CAAT,CAAT,EAAoCA,KAAK,SAAL,CAApC,EAAqDA,KAAK,YAAL,CAArD,EAAyEA,KAAK,UAAL,CAAzE,EAA2FA,KAAK,WAAL,CAA3F,EAA8GA,KAAK,cAAL,CAA9G,EAAoIA,KAAK,eAAL,CAApI,EAA2JA,KAAK,MAAL,CAA3J,EAAyKA,KAAK,SAAL,CAAzK,EAA0LA,KAAK,QAAL,CAA1L,EAA0MA,KAAK,kBAAL,CAA1M,CADkC;AAE3CzC,wBAAgB;AAF2B,KAA3B,CAApB;;AAKA,QAAItE,MAAMC,GAAN,CAAU,eAAV,CAAJ,EAAgC;AAC5BhB,eAAO4D,WAAP,CAAmB,OAAnB,EAA4B,YAAY;AACpC,gBAAIkM,aAAapT,SAASqT,aAAT,CAAuB,cAAvB,CAAjB;AACA,gBAAID,WAAWE,YAAX,CAAwB,SAAxB,MAAuClI,KAAK,QAAL,CAAvC,IAAyDgI,WAAWG,SAAX,CAAqBC,QAArB,CAA8B,SAA9B,CAA7D,EAAuG;AACnGJ,2BAAWG,SAAX,CAAqBE,MAArB,CAA4B,SAA5B;AACH,aAFD,MAEO;AACHL,2BAAWM,YAAX,CAAwB,SAAxB,EAAmCtI,KAAK,QAAL,CAAnC;AACAuI,+BAAevI,KAAK,QAAL,CAAf;AACH;AACJ,SARD;;AAUAzH,eAAOC,IAAP,CAAYiF,KAAZ,CAAkB3B,WAAlB,CAA8B5D,OAAOkF,UAArC,EAAiD,YAAjD,EAA+D,YAAY;AACvElF,mBAAOsQ,OAAP,GAAiB,IAAjB;AACH,SAFD;;AAIA,YAAI,CAACC,gBAAD,IAAqB,CAACC,eAA1B,EAA2C;AACvCxQ,mBAAO4D,WAAP,CAAmB,WAAnB,EAAgC,YAAY;AACxC5D,uBAAOkF,UAAP,CAAkBqC,IAAlB,CAAuB7J,GAAvB,EAA4BsC,MAA5B;AACAyQ;AACAC;AACH,aAJD;AAKH;;AAED1Q,eAAO4D,WAAP,CAAmB,UAAnB,EAA+B,YAAY;AACvC,gBAAI,CAAC5D,OAAOsQ,OAAZ,EAAqB;AACjBtQ,uBAAOkF,UAAP,CAAkByL,KAAlB;AACH;AACJ,SAJD;AAKH,KA5BD,MA4BO;AACHrL,qBAAatF,MAAb;AACH;AACD,WAAOA,MAAP;AACH;;AAED,SAAS4Q,eAAT,CAAyB9I,IAAzB,EAA+B9H,MAA/B,EAAuC;AACnCA,WAAOuE,OAAP,CAAe;AACX8C,aAAK,kBAAkBtG,MAAMC,GAAN,CAAU,gBAAV,CAAlB,GAAgD,GAAhD,GAAsDnC,SAASiJ,KAAK,SAAL,CAAT,CAAtD,IAAmFA,KAAK,SAAL,MAAoB,CAApB,GAAwB,MAAMwD,YAAYxD,KAAK,YAAL,CAAZ,CAA9B,GAAgE,EAAnJ,IAAyJ,MADnJ;AAEX8H,oBAAY,IAAIvP,OAAOC,IAAP,CAAYuP,IAAhB,CAAqB,EAArB,EAAyB,EAAzB;AAFD,KAAf;AAIA7P,WAAOkF,UAAP,CAAkB2L,UAAlB,CAA6B/G,SAASjL,SAASiJ,KAAK,SAAL,CAAT,CAAT,EAAoCA,KAAK,SAAL,CAApC,EAAqDA,KAAK,YAAL,CAArD,EAAyEA,KAAK,UAAL,CAAzE,EAA2FA,KAAK,WAAL,CAA3F,EAA8GA,KAAK,cAAL,CAA9G,EAAoIA,KAAK,eAAL,CAApI,EAA2JA,KAAK,MAAL,CAA3J,EAAyKA,KAAK,SAAL,CAAzK,EAA0LA,KAAK,QAAL,CAA1L,EAA0MA,KAAK,kBAAL,CAA1M,CAA7B;AACA,WAAO9H,MAAP;AACH;;AAED,SAAS8Q,cAAT,GAA0B;AACtBpL,MAAEc,IAAF,CAAO1G,QAAQiR,IAAf,EAAqB,UAAUrK,GAAV,EAAeC,KAAf,EAAsB;AACvC7G,gBAAQiR,IAAR,CAAarK,GAAb,EAAkB,QAAlB,EAA4BnC,OAA5B,CAAoC;AAChC8C,iBAAK,kBAAkBtG,MAAMC,GAAN,CAAU,gBAAV,CAAlB,GAAgD,GAAhD,GAAsDnC,SAASiB,QAAQiR,IAAR,CAAarK,GAAb,EAAkB,SAAlB,CAAT,CAAtD,IAAgG5G,QAAQiR,IAAR,CAAarK,GAAb,EAAkB,SAAlB,MAAiC,CAAjC,GAAqC,MAAM4E,YAAYxL,QAAQiR,IAAR,CAAarK,GAAb,EAAkB,YAAlB,CAAZ,CAA3C,GAA0F,EAA1L,IAAgM,MADrK;AAEhCkJ,wBAAY,IAAIvP,OAAOC,IAAP,CAAYuP,IAAhB,CAAqB,EAArB,EAAyB,EAAzB;AAFoB,SAApC;AAIH,KALD;AAMH;;AAED,SAASmB,mBAAT,CAA6BlJ,IAA7B,EAAmC;AAC/B,QAAImJ,YAAYnJ,KAAK,iBAAL,IAA0B,YAA1B,GAAyC,OAAzD;AACA,QAAI9H,SAAS,IAAIK,OAAOC,IAAP,CAAYoE,MAAhB,CAAuB;AAChCjD,kBAAU;AACNf,iBAAKoH,KAAK,UAAL,CADC;AAENlH,iBAAKkH,KAAK,WAAL;AAFC,SADsB;AAKhCpK,aAAKA,GAL2B;AAMhCsH,gBAAQ,CANwB;AAOhCR,cAAM,kBAAkByM,SAAlB,GAA8B;AAPJ,KAAvB,CAAb;;AAUA,QAAI,CAACjR,OAAOC,WAAR,IAAuBkN,cAAczP,GAAd,CAA3B,EAA+C;AAC3CsC,eAAOC,WAAP,GAAqBkM,eAAenM,MAAf,EAAuBtC,GAAvB,EAA4B,UAA5B,CAArB;AACH;;AAEDsC,WAAOkF,UAAP,GAAoB,IAAI7E,OAAOC,IAAP,CAAY6E,UAAhB,CAA2B;AAC3CC,iBAASoG,cAAc1D,KAAK,iBAAL,CAAd,EAAuCA,KAAK,UAAL,CAAvC,EAAyDA,KAAK,WAAL,CAAzD,CADkC;AAE3CzC,wBAAgB;AAF2B,KAA3B,CAApB;;AAKAC,iBAAatF,MAAb;AACA,WAAOA,MAAP;AACH;;AAED,SAASkR,cAAT,CAAwBvK,KAAxB,EAA+B;AAC3B;AACA,QAAIwK,OAAO,CAAC3N,KAAKyK,GAAL,KAAatH,KAAd,IAAuB,IAAvB,GAA8B,EAA9B,GAAmC,EAA9C;;AAEA,QAAIwK,OAAO,CAAX,EAAc;AACVA,eAAO,CAAP;AACH;;AAED;AACA,QAAIC,MAAM,CAAC,CAAC,IAAID,IAAL,IAAa,GAAd,EAAmBE,QAAnB,CAA4B,EAA5B,CAAV;AACA,WAAO,CAAC,MAAD,EAASD,GAAT,EAAc,YAAd,EAA4BxD,IAA5B,CAAiC,EAAjC,CAAP;AACH;;AAED,SAAS0D,kBAAT,CAA4BxJ,IAA5B,EAAkC;AAC9B,QAAIuE,eAAe,IAAIhM,OAAOC,IAAP,CAAYgM,MAAhB,CAAuBxE,KAAK,UAAL,CAAvB,EAAyCA,KAAK,WAAL,CAAzC,CAAnB;;AAEA,QAAI9H,SAAS,IAAIK,OAAOC,IAAP,CAAY4M,MAAhB,CAAuB;AAChCxP,aAAKA,GAD2B;AAEhC6T,mBAAW,KAFqB;AAGhC9Q,gBAAQ4L,YAHwB;AAIhCO,gBAAQ,EAJwB,EAIpB;AACZI,mBAAWkE,eAAepJ,KAAK,eAAL,CAAf,CALqB;AAMhCmF,qBAAa,GANmB;AAOhCJ,sBAAc,CAPkB;AAQhCE,uBAAe;AARiB,KAAvB,CAAb;;AAWA,WAAO/M,MAAP;AACH;;AAED,SAASwR,mBAAT,CAA6B7K,KAA7B,EAAoC;AAChC,QAAIsH,MAAM,IAAIzK,IAAJ,EAAV;AACA,QAAIoI,UAAUqC,IAAIrE,UAAJ,KAAmB,EAAnB,GAAwBqE,IAAIpE,UAAJ,EAAtC;;AAEA;AACA,QAAI+B,UAAU,GAAV,IAAiBjF,QAAQ,IAA7B,EAAmC;AAC/BiF,mBAAW,IAAX;AACH,KAFD,MAEO,IAAIA,UAAU,IAAV,IAAkBjF,QAAQ,GAA9B,EAAmC;AACtCA,iBAAS,IAAT;AACH;;AAED,QAAIwK,OAAOvF,UAAUjF,KAArB;AACA,QAAIyK,MAAM,GAAV,CAZgC,CAYlB;AACd,QAAID,QAAQ,CAAR,IAAaA,QAAQ,GAAzB,EAA8B;AAC1B;AACAC,cAAM,CAAC,IAAID,OAAO,EAAP,GAAY,EAAjB,IAAuB,GAA7B;AACH,KAHD,MAGO,IAAIA,OAAO,CAAP,IAAYA,OAAO,CAAC,GAAxB,EAA6B;AAChC;AACAC,cAAM,CAAC,IAAI,CAACD,IAAD,GAAQ,EAAR,GAAa,CAAlB,IAAuB,EAAvB,GAA4B,GAAlC;AACH;;AAEDC,UAAMvF,KAAKwB,KAAL,CAAW+D,MAAM,CAAjB,IAAsB,CAA5B;;AAEA,WAAOA,GAAP;AACH;;AAED,SAASK,eAAT,CAAyBC,KAAzB,EAAgC5Q,IAAhC,EAAsC;AAClC,QAAI6Q,WAAW,EAAf;AACA,QAAID,UAAU,GAAd,EAAmB;AACfC,mBAAW,kCAAX;AACH,KAFD,MAEO;AACHA,mBAAW,wBAAwBD,KAAxB,GAAgC,MAA3C;AACH;AACD,QAAIE,YAAY,GAAhB,CAPkC,CAOd;AACpB,QAAIC,cAAc,CAAlB;AACA,QAAIC,UAAUjG,KAAKwB,KAAL,CAAWuE,aAAa9Q,OAAO,EAApB,CAAX,CAAmC;AAAnC,KAAd;AAEA,QAAIgR,UAAUD,WAAd,EAA2B;AACvBC,kBAAUD,WAAV;AACH;;AAED,QAAIE,UAAU;AACV1K,aAAKsK,QADK;AAEV/B,oBAAY,IAAIvP,OAAOC,IAAP,CAAYuP,IAAhB,CAAqBiC,OAArB,EAA8BA,OAA9B,CAFF;AAGVE,gBAAQ,IAAI3R,OAAOC,IAAP,CAAY2R,KAAhB,CAAsBH,UAAU,CAAhC,EAAmCA,UAAU,CAA7C;AAHE,KAAd;;AAMA,WAAOC,OAAP;AACH;;AAED,SAASG,eAAT,CAAyBR,KAAzB,EAAgC;AAC5B,QAAIS,WAAW,CAAf;AACA,QAAIC,QAAQ,CAAZ;AACA,QAAIV,SAAS,CAAT,IAAcA,SAAS,GAA3B,EAAgC;AAC5B;AACAU,gBAAQV,QAAQ,GAAhB;AACAS,mBAAW,MAAMC,QAAQ,GAAzB;AACH,KAJD,MAIO,IAAIV,SAAS,GAAT,IAAgBA,SAAS,GAA7B,EAAkC;AACrC;AACAU,gBAAQ,CAACV,QAAQ,GAAT,IAAgB,EAAxB;AACAS,mBAAWC,QAAQ,GAAnB;AACH;;AAED,WAAOD,QAAP;AACH;;AAED,SAASE,qBAAT,CAA+BvK,IAA/B,EAAqC;AACjC,QAAIuE,eAAe,IAAIhM,OAAOC,IAAP,CAAYgM,MAAhB,CAAuBxE,KAAK,UAAL,CAAvB,EAAyCA,KAAK,WAAL,CAAzC,CAAnB;AACA,QAAIsJ,MAAMI,oBAAoB1J,KAAKmE,IAAzB,CAAV;AACA,QAAInL,OAAOpD,IAAIuG,OAAJ,EAAX;;AAEA,QAAIjE,SAAS,IAAIK,OAAOC,IAAP,CAAYoE,MAAhB,CAAuB;AAChChH,aAAKA,GAD2B;AAEhC+D,kBAAU4K,YAFsB;AAGhC7H,cAAMiN,gBAAgBL,GAAhB,EAAqBtQ,IAArB,CAH0B;AAIhCkE,gBAAQkN,gBAAgBd,GAAhB;AAJwB,KAAvB,CAAb;;AAOApR,WAAOkF,UAAP,GAAoB,IAAI7E,OAAOC,IAAP,CAAY6E,UAAhB,CAA2B;AAC3CC,iBAAS4G,gBAAgBlE,IAAhB,CADkC;AAE3CzC,wBAAgB,IAF2B;AAG3C5D,kBAAU4K;AAHiC,KAA3B,CAApB;;AAMA/G,iBAAatF,MAAb;;AAEA,WAAOA,MAAP;AACH;;AAED,SAASyQ,cAAT,GAA0B;AACtB,QAAI/T,SAAS4V,SAAb,EAAwB;AACpB5V,iBAAS4V,SAAT,CAAmBC,KAAnB;AACH,KAFD,MAEO,IAAIjL,OAAOkL,YAAX,EAAyB;AAC5BlL,eAAOkL,YAAP,GAAsBC,eAAtB;AACH;AACJ;;AAED,SAASnN,YAAT,CAAsBtF,MAAtB,EAA8B;AAC1BA,WAAO4D,WAAP,CAAmB,OAAnB,EAA4B,YAAY;AACpC,YAAI,CAAC5D,OAAO0S,gBAAZ,EAA8B;AAC1B1S,mBAAOkF,UAAP,CAAkBqC,IAAlB,CAAuB7J,GAAvB,EAA4BsC,MAA5B;AACAyQ;AACAC;AACA1Q,mBAAOsQ,OAAP,GAAiB,IAAjB;AACAtQ,mBAAO0S,gBAAP,GAA0B,IAA1B;AACH,SAND,MAMO;AACH1S,mBAAOsQ,OAAP,GAAiB,IAAjB;AACAtQ,mBAAOkF,UAAP,CAAkByL,KAAlB;AACA3Q,mBAAO0S,gBAAP,GAA0B,KAA1B;AACH;AACJ,KAZD;;AAcArS,WAAOC,IAAP,CAAYiF,KAAZ,CAAkB3B,WAAlB,CAA8B5D,OAAOkF,UAArC,EAAiD,YAAjD,EAA+D,YAAY;AACvElF,eAAOsQ,OAAP,GAAiB,IAAjB;AACH,KAFD;;AAIA,QAAI,CAACC,gBAAD,IAAqB,CAACC,eAA1B,EAA2C;AACvCxQ,eAAO4D,WAAP,CAAmB,WAAnB,EAAgC,YAAY;AACxC5D,mBAAOkF,UAAP,CAAkBqC,IAAlB,CAAuB7J,GAAvB,EAA4BsC,MAA5B;AACAyQ;AACAC;AACH,SAJD;AAKH;;AAED1Q,WAAO4D,WAAP,CAAmB,UAAnB,EAA+B,YAAY;AACvC,YAAI,CAAC5D,OAAOsQ,OAAZ,EAAqB;AACjBtQ,mBAAOkF,UAAP,CAAkByL,KAAlB;AACH;AACJ,KAJD;;AAMA,WAAO3Q,MAAP;AACH;;AAED,SAAS2S,iBAAT,GAA6B;AACzBjN,MAAEc,IAAF,CAAO1G,QAAQC,QAAf,EAAyB,UAAU2G,GAAV,EAAeC,KAAf,EAAsB;AAC3C,YAAI7G,QAAQC,QAAR,CAAiB2G,GAAjB,EAAsB,gBAAtB,IAA0C,IAAIlD,IAAJ,GAAWoP,OAAX,EAA1C,IAAkEzV,gBAAgBiS,OAAhB,CAAwBtP,QAAQC,QAAR,CAAiB2G,GAAjB,EAAsB,YAAtB,CAAxB,KAAgE,CAAtI,EAAyI;AACrI,gBAAI5G,QAAQC,QAAR,CAAiB2G,GAAjB,EAAsB1G,MAAtB,CAA6BC,WAAjC,EAA8C;AAC1CH,wBAAQC,QAAR,CAAiB2G,GAAjB,EAAsB1G,MAAtB,CAA6BC,WAA7B,CAAyCC,MAAzC,CAAgD,IAAhD;AACA,uBAAOJ,QAAQC,QAAR,CAAiB2G,GAAjB,EAAsB1G,MAAtB,CAA6BC,WAApC;AACH;AACDH,oBAAQC,QAAR,CAAiB2G,GAAjB,EAAsB1G,MAAtB,CAA6BE,MAA7B,CAAoC,IAApC;AACA,mBAAOJ,QAAQC,QAAR,CAAiB2G,GAAjB,CAAP;AACH;AACJ,KATD;;AAWAhB,MAAEc,IAAF,CAAO1G,QAAQqE,YAAf,EAA6B,UAAUuC,GAAV,EAAeC,KAAf,EAAsB;AAC/C,YAAI7G,QAAQqE,YAAR,CAAqBuC,GAArB,EAA0B,iBAA1B,IAA+C,IAAIlD,IAAJ,GAAWoP,OAAX,EAA/C,IAAuEzV,gBAAgBiS,OAAhB,CAAwBtP,QAAQqE,YAAR,CAAqBuC,GAArB,EAA0B,YAA1B,CAAxB,KAAoE,CAA/I,EAAkJ;AAC9I5G,oBAAQqE,YAAR,CAAqBuC,GAArB,EAA0B1G,MAA1B,CAAiCE,MAAjC,CAAwC,IAAxC;AACA,mBAAOJ,QAAQqE,YAAR,CAAqBuC,GAArB,CAAP;AACH;AACJ,KALD;;AAOAhB,MAAEc,IAAF,CAAO1G,QAAQ+S,OAAf,EAAwB,UAAUnM,GAAV,EAAeC,KAAf,EAAsB;AAC1C;AACA,YAAI7G,QAAQ+S,OAAR,CAAgBnM,GAAhB,EAAqB,eAArB,IAAwC,IAAIlD,IAAJ,GAAWoP,OAAX,KAAuB,KAAK,EAAL,GAAU,IAA7E,EAAmF;AAC/E9S,oBAAQ+S,OAAR,CAAgBnM,GAAhB,EAAqB1G,MAArB,CAA4BE,MAA5B,CAAmC,IAAnC;AACA,mBAAOJ,QAAQ+S,OAAR,CAAgBnM,GAAhB,CAAP;AACH;AACJ,KAND;AAOH;;AAED,SAASoM,mBAAT,CAA6BC,OAA7B,EAAsC5L,IAAtC,EAA4C;AACxCzB,MAAEc,IAAF,CAAOuM,OAAP,EAAgB,UAAUrM,GAAV,EAAeC,KAAf,EAAsB;AAClC,YAAI3G,SAAS+S,QAAQrM,GAAR,EAAa1G,MAA1B;AACA,YAAIgT,OAAO,KAAX;AACA,YAAI,CAACD,QAAQrM,GAAR,EAAavG,MAAlB,EAA0B;AACtB,gBAAI,OAAOH,OAAOiT,SAAd,KAA4B,UAAhC,EAA4C;AACxC,oBAAIvV,IAAIuV,SAAJ,GAAgBC,UAAhB,CAA2BlT,OAAOiT,SAAP,EAA3B,CAAJ,EAAoD;AAChDD,2BAAO,IAAP;AACH;AACJ,aAJD,MAIO,IAAI,OAAOhT,OAAOyF,WAAd,KAA8B,UAAlC,EAA8C;AACjD,oBAAI/H,IAAIuV,SAAJ,GAAgB/C,QAAhB,CAAyBlQ,OAAOyF,WAAP,EAAzB,CAAJ,EAAoD;AAChDuN,2BAAO,IAAP;AACH;AACJ;AACJ;AACD;AACA,YAAIA,QAAQnV,aAAauR,OAAb,CAAqBjI,IAArB,MAA+B,CAAC,CAA5C,EAA+C;AAC3C;AACA,gBAAI,CAACnH,OAAOC,WAAZ,EAAyB;AACrB;AACA,oBAAIkN,cAAczP,GAAd,CAAJ,EAAwB;AACpB,wBAAIyJ,SAAS,KAAb,EAAoBnH,OAAOC,WAAP,GAAqBkM,eAAenM,MAAf,EAAuBtC,GAAvB,EAA4ByJ,IAA5B,EAAkC4L,QAAQrM,GAAR,EAAayM,OAA/C,CAArB,CAApB,KACKnT,OAAOC,WAAP,GAAqBkM,eAAenM,MAAf,EAAuBtC,GAAvB,EAA4ByJ,IAA5B,CAArB;AACR;AACJ,aAND,MAMO;AACH;AACA,oBAAIgG,cAAczP,GAAd,CAAJ,EAAwB;AACpBsC,2BAAOC,WAAP,CAAmBC,MAAnB,CAA0BxC,GAA1B;AACH,iBAFD,MAEO;AACHsC,2BAAOC,WAAP,CAAmBC,MAAnB,CAA0B,IAA1B;AACH;AACJ;AACJ;;AAED,YAAI8S,QAAQ,CAAChT,OAAOoT,MAAP,EAAb,EAA8B;AAC1BpT,mBAAOE,MAAP,CAAcxC;AACV;AADJ;AAGA,gBAAIsC,OAAOkP,YAAP,IAAuBlP,OAAOqT,YAAlC,EAAgD;AAC5CrT,uBAAOkP,YAAP,CAAoBlP,OAAOqT,YAA3B;AACH;AACJ,SAPD,MAOO,IAAI,CAACL,IAAD,IAAShT,OAAOoT,MAAP,EAAb,EAA8B;AACjC;AACA,gBAAIpT,OAAOsT,YAAX,EAAyB;AACrBtT,uBAAOqT,YAAP,GAAsBrT,OAAOsT,YAAP,EAAtB;AACH;AACD,gBAAItT,OAAOC,WAAX,EAAwBD,OAAOC,WAAP,CAAmBC,MAAnB,CAA0B,IAA1B;AACxBF,mBAAOE,MAAP,CAAc,IAAd;AACH;AACJ,KAhDD;AAiDH;;AAED,SAASqT,WAAT,GAAuB;AACnB,QAAIC,cAAczS,MAAMC,GAAN,CAAU,aAAV,CAAlB;AACA,QAAIyS,WAAW1S,MAAMC,GAAN,CAAU,UAAV,CAAf;AACA,QAAI0S,gBAAgB3S,MAAMC,GAAN,CAAU,eAAV,CAApB;AACA,QAAI2S,cAAc5S,MAAMC,GAAN,CAAU,aAAV,CAAlB;AACA,QAAI4S,kBAAkB7S,MAAMC,GAAN,CAAU,iBAAV,CAAtB;AACA,QAAI6S,gBAAgBC,QAAQ/S,MAAMC,GAAN,CAAU,wBAAV,CAAR,CAApB;;AAEA,QAAI+S,SAASrW,IAAIuV,SAAJ,EAAb;AACA,QAAIe,UAAUD,OAAOE,YAAP,EAAd;AACA,QAAIC,UAAUH,OAAOI,YAAP,EAAd;AACA,QAAIC,QAAQJ,QAAQtT,GAAR,EAAZ;AACA,QAAI2T,QAAQL,QAAQpT,GAAR,EAAZ;AACA,QAAI0T,QAAQJ,QAAQxT,GAAR,EAAZ;AACA,QAAI6T,QAAQL,QAAQtT,GAAR,EAAZ;;AAEA,WAAO8E,EAAE8O,IAAF,CAAO;AACVnN,aAAK,UADK;AAEVF,cAAM,KAFI;AAGVsN,iBAAS,MAHC;AAIVC,cAAM;AACF,yBAAaxX,SADX;AAEF,uBAAWsW,WAFT;AAGF,2BAAejV,WAHb;AAIF,yBAAamV,aAJX;AAKF,6BAAiBrV,aALf;AAMF,yBAAawV,aANX;AAOF,oBAAQJ,QAPN;AAQF,wBAAYnV,QARV;AASF,uBAAWqV,WATT;AAUF,yBAAanV,SAVX;AAWF,2BAAeoV,eAXb;AAYF,0BAAcnV,UAZZ;AAaF,qBAAS2V,KAbP;AAcF,qBAASC,KAdP;AAeF,qBAASC,KAfP;AAgBF,qBAASC,KAhBP;AAiBF,sBAAUtW,MAjBR;AAkBF,sBAAUC,MAlBR;AAmBF,sBAAUC,MAnBR;AAoBF,sBAAUC,MApBR;AAqBF,qBAASuP,OAAOnQ,iBAAP,CArBP;AAsBF,oBAAQmQ,OAAOxQ,eAAP;AAtBN,SAJI;AA4BVwX,kBAAU,MA5BA;AA6BVC,eAAO,KA7BG;AA8BVC,oBAAY,SAASA,UAAT,GAAsB;AAC9B,gBAAIlX,gBAAJ,EAAsB;AAClB,uBAAO,KAAP;AACH,aAFD,MAEO;AACHA,mCAAmB,IAAnB;AACH;AACJ,SApCS;AAqCVmX,eAAO,SAASA,KAAT,GAAiB;AACpB;AACAC,mBAAO,OAAP,EAAgB,sDAAhB,EAAwE,oBAAxE;AACAA,mBAAOC,OAAP,GAAiB;AACb,+BAAe,IADF;AAEb,yBAAS,KAFI;AAGb,+BAAe,IAHF;AAIb,+BAAe,KAJF;AAKb,iCAAiB,iBALJ;AAMb,qCAAqB,IANR;AAOb,2BAAW,IAPE;AAQb,gCAAgB,KARH;AASb,gCAAgB,MATH;AAUb,2BAAW,OAVE;AAWb,mCAAmB,MAXN;AAYb,8BAAc,OAZD;AAab,8BAAc,QAbD;AAcb,8BAAc,QAdD;AAeb,8BAAc;AAfD,aAAjB;AAiBH,SAzDS;AA0DVC,kBAAU,SAASA,QAAT,GAAoB;AAC1BtX,+BAAmB,KAAnB;AACH;AA5DS,KAAP,CAAP;AA8DH;;AAED,SAASuX,eAAT,CAAyBzK,CAAzB,EAA4B3C,IAA5B,EAAkC;AAC9B,QAAI,CAAC/G,MAAMC,GAAN,CAAU,aAAV,CAAL,EAA+B;AAC3B,eAAO,KAAP,CAD2B,CACd;AAChB;;AAED,QAAI,EAAE8G,KAAK,cAAL,KAAwBhI,QAAQC,QAAlC,KAA+C5C,gBAAgBiS,OAAhB,CAAwBtH,KAAK,YAAL,CAAxB,IAA8C,CAA7F,IAAkGA,KAAK,gBAAL,IAAyBtE,KAAKyK,GAAL,EAA/H,EAA2I;AACvI;AACA,YAAInG,KAAK9H,MAAT,EAAiB;AACb8H,iBAAK9H,MAAL,CAAYE,MAAZ,CAAmB,IAAnB;AACH;AACD,YAAI,CAAC4H,KAAK3H,MAAV,EAAkB;AACd2H,iBAAK9H,MAAL,GAAcmV,mBAAmBrN,IAAnB,EAAyBpK,GAAzB,CAAd;AACAsR,mCAAuBlH,KAAK9H,MAA5B,EAAoC8H,IAApC;AACAhI,oBAAQC,QAAR,CAAiB+H,KAAK,cAAL,CAAjB,IAAyCA,IAAzC;AACH;AACJ;AACJ;;AAED,SAASsN,gBAAT,CAA0B3K,CAA1B,EAA6B3C,IAA7B,EAAmC;AAC/B,QAAI,CAAC/G,MAAMC,GAAN,CAAU,eAAV,CAAL,EAAiC;AAC7B,eAAO,KAAP;AACH;;AAED,QAAID,MAAMC,GAAN,CAAU,wBAAV,KAAuC,CAAC8G,KAAK,iBAAL,CAA5C,EAAqE;AACjE,eAAO,IAAP;AACH;;AAED,QAAI,CAAChI,QAAQuV,SAAR,CAAkBvN,KAAK,aAAL,CAAlB,CAAL,EAA6C;AACzC;AACA,YAAIA,KAAK9H,MAAL,IAAe8H,KAAK9H,MAAL,CAAYC,WAA/B,EAA4C;AACxC6H,iBAAK9H,MAAL,CAAYC,WAAZ,CAAwBC,MAAxB,CAA+B,IAA/B;AACH;AACD,YAAI4H,KAAK9H,MAAT,EAAiB;AACb8H,iBAAK9H,MAAL,CAAYE,MAAZ,CAAmB,IAAnB;AACH;AACD4H,aAAK9H,MAAL,GAAcgR,oBAAoBlJ,IAApB,CAAd;AACAhI,gBAAQuV,SAAR,CAAkBvN,KAAK,aAAL,CAAlB,IAAyCA,IAAzC;AACH,KAVD,MAUO;AACH;AACA,YAAIwN,QAAQxV,QAAQuV,SAAR,CAAkBvN,KAAK,aAAL,CAAlB,CAAZ;AACA,YAAI,CAAC,CAACA,KAAK,iBAAL,CAAF,KAA8B,CAAC,CAACwN,MAAM,iBAAN,CAApC,EAA8D;AAC1D,gBAAIA,MAAMtV,MAAN,IAAgBsV,MAAMtV,MAAN,CAAaC,WAAjC,EAA8C;AAC1CqV,sBAAMtV,MAAN,CAAaC,WAAb,CAAyBC,MAAzB,CAAgC,IAAhC;AACH;AACDoV,kBAAMtV,MAAN,CAAaE,MAAb,CAAoB,IAApB;AACA4H,iBAAK9H,MAAL,GAAcgR,oBAAoBlJ,IAApB,CAAd;AACAhI,oBAAQuV,SAAR,CAAkBvN,KAAK,aAAL,CAAlB,IAAyCA,IAAzC;AACH;AACJ;AACJ;;AAED,SAASyN,eAAT,GAA2B;AACvB,QAAI,CAACxU,MAAMC,GAAN,CAAU,eAAV,CAAL,EAAiC;AAC7B,eAAO,KAAP;AACH;;AAED,QAAIwU,cAAc,EAAlB;AACA,QAAIC,cAAc,IAAIjS,IAAJ,GAAWoP,OAAX,EAAlB;;AAEA;AACAlN,MAAEc,IAAF,CAAO1G,QAAQuV,SAAf,EAA0B,UAAU3O,GAAV,EAAeC,KAAf,EAAsB;AAC5C,YAAIA,MAAM,iBAAN,KAA4BA,MAAM,iBAAN,IAA2B8O,WAA3D,EAAwE;AACpE9O,kBAAM,iBAAN,IAA2B,IAA3B;AACA,gBAAIA,MAAM3G,MAAN,IAAgB2G,MAAM3G,MAAN,CAAaC,WAAjC,EAA8C;AAC1C0G,sBAAM3G,MAAN,CAAaC,WAAb,CAAyBC,MAAzB,CAAgC,IAAhC;AACH;AACDyG,kBAAM3G,MAAN,CAAaE,MAAb,CAAoB,IAApB;AACAyG,kBAAM3G,MAAN,GAAegR,oBAAoBrK,KAApB,CAAf;AACH;AACJ,KATD;;AAWA;AACA,QAAI5F,MAAMC,GAAN,CAAU,wBAAV,CAAJ,EAAyC;AACrC0E,UAAEc,IAAF,CAAO1G,QAAQuV,SAAf,EAA0B,UAAU3O,GAAV,EAAeC,KAAf,EAAsB;AAC5C,gBAAI,CAACA,MAAM,iBAAN,CAAL,EAA+B;AAC3B6O,4BAAYE,IAAZ,CAAiBhP,GAAjB;AACH;AACJ,SAJD;AAKAhB,UAAEc,IAAF,CAAOgP,WAAP,EAAoB,UAAU9O,GAAV,EAAeC,KAAf,EAAsB;AACtC,gBAAI7G,QAAQuV,SAAR,CAAkB1O,KAAlB,KAA4B7G,QAAQuV,SAAR,CAAkB1O,KAAlB,EAAyB3G,MAAzD,EAAiE;AAC7D,oBAAIF,QAAQuV,SAAR,CAAkB1O,KAAlB,EAAyB3G,MAAzB,CAAgCC,WAApC,EAAiD;AAC7CH,4BAAQuV,SAAR,CAAkB1O,KAAlB,EAAyB3G,MAAzB,CAAgCC,WAAhC,CAA4CC,MAA5C,CAAmD,IAAnD;AACH;AACDJ,wBAAQuV,SAAR,CAAkB1O,KAAlB,EAAyB3G,MAAzB,CAAgCE,MAAhC,CAAuC,IAAvC;AACA,uBAAOJ,QAAQuV,SAAR,CAAkB1O,KAAlB,CAAP;AACH;AACJ,SARD;AASH;AACJ;;AAED,SAASgP,WAAT,CAAqBlL,CAArB,EAAwB3C,IAAxB,EAA8B;AAC1B,QAAI,CAAC/G,MAAMC,GAAN,CAAU,UAAV,CAAL,EAA4B;AACxB,eAAO,KAAP,CADwB,CACX;AAChB;;AAED,QAAIqK,WAAWC,YAAYxD,KAAK8N,UAAjB,CAAf;AACA,QAAIC,mBAAmB,SAASA,gBAAT,CAA0BC,KAA1B,EAAiC;AACpD,YAAIhW,QAAQiR,IAAR,CAAa+E,KAAb,KAAuBhW,QAAQiR,IAAR,CAAa+E,KAAb,EAAoB9V,MAA/C,EAAuD;AACnD,gBAAIF,QAAQiR,IAAR,CAAa+E,KAAb,EAAoB9V,MAApB,CAA2BC,WAA/B,EAA4C;AACxCH,wBAAQiR,IAAR,CAAa+E,KAAb,EAAoB9V,MAApB,CAA2BC,WAA3B,CAAuCC,MAAvC,CAA8C,IAA9C;AACH;AACDJ,oBAAQiR,IAAR,CAAa+E,KAAb,EAAoB9V,MAApB,CAA2BE,MAA3B,CAAkC,IAAlC;AACA,mBAAOJ,QAAQiR,IAAR,CAAa+E,KAAb,CAAP;AACH;AACJ,KARD;;AAUA,QAAIC,iBAAiB,SAASA,cAAT,CAAwB1K,QAAxB,EAAkC2K,YAAlC,EAAgD;AACjE,eAAO3K,WAAWvD,KAAKmO,OAAL,CAAa7L,MAAxB,IAAkCtC,KAAKmO,OAAL,CAAa7L,MAAb,KAAwB,CAAjE;AACH,KAFD;;AAIA,QAAIrJ,MAAMC,GAAN,CAAU,kBAAV,MAAkC,CAAtC,EAAyC;AACrC,YAAI,CAAC+U,eAAe1K,QAAf,EAAyBvD,KAAKmO,OAAL,CAAa7L,MAAtC,CAAL,EAAoD;AAChDyL,6BAAiB/N,KAAK,QAAL,CAAjB;AACA,mBAAO,IAAP;AACH;AACJ;;AAED,QAAI/G,MAAMC,GAAN,CAAU,kBAAV,IAAgC,CAApC,EAAuC;AACnC,YAAIkV,gBAAgB,CAApB;AACA,gBAAQnV,MAAMC,GAAN,CAAU,kBAAV,CAAR;AACI,iBAAK,CAAL;AACIkV,gCAAgB,IAAhB;AACA;AACJ,iBAAK,CAAL;AACIA,gCAAgB,IAAhB;AACA;AACJ,iBAAK,CAAL;AACIA,gCAAgB,IAAhB;AACA;AATR;;AAYA,YAAI,CAACH,eAAe1K,QAAf,EAAyBvD,KAAKmO,OAAL,CAAa7L,MAAtC,CAAD,KAAmDtL,YAAYuM,WAAW,CAAvB,IAA4B6K,gBAAgBpO,KAAK8N,UAAjD,IAA+DvK,aAAa,EAA/H,CAAJ,EAAwI;AACpIwK,6BAAiB/N,KAAK,QAAL,CAAjB;AACA,mBAAO,IAAP;AACH;AACJ;;AAED,QAAI/G,MAAMC,GAAN,CAAU,kBAAV,KAAiCD,MAAMC,GAAN,CAAU,kBAAV,MAAkC8G,KAAKqL,OAA5E,EAAqF;AACjF0C,yBAAiB/N,KAAK,QAAL,CAAjB;AACA,eAAO,IAAP;AACH;;AAED,QAAI/G,MAAMC,GAAN,CAAU,yBAAV,CAAJ,EAA0C;AACtC,YAAIiN,MAAM,IAAIzK,IAAJ,EAAV;AACA,YAAIsE,KAAKqO,YAAL,IAAqB,IAAzB,EAA+B;AAC3B,gBAAIpV,MAAMC,GAAN,CAAU,yBAAV,IAAuC,IAAvC,GAA8C,IAA9C,GAAqD8G,KAAKsO,aAA1D,GAA0EnI,IAAI2E,OAAJ,EAA9E,EAA6F;AACzFiD,iCAAiB/N,KAAK,QAAL,CAAjB;AACA,uBAAO,IAAP;AACH;AACJ,SALD,MAKO;AACH,gBAAI/G,MAAMC,GAAN,CAAU,yBAAV,IAAuC,IAAvC,GAA8C,IAA9C,GAAqD8G,KAAKqO,YAA1D,GAAyElI,IAAI2E,OAAJ,EAA7E,EAA4F;AACxFiD,iCAAiB/N,KAAK,QAAL,CAAjB;AACA,uBAAO,IAAP;AACH;AACJ;AACJ;;AAED,QAAIuD,WAAWtK,MAAMC,GAAN,CAAU,aAAV,CAAf,EAAyC;AACrC6U,yBAAiB/N,KAAK,QAAL,CAAjB;AACA,eAAO,IAAP;AACH;;AAED,QAAIuD,WAAWtK,MAAMC,GAAN,CAAU,aAAV,CAAf,EAAyC;AACrC6U,yBAAiB/N,KAAK,QAAL,CAAjB;AACA,eAAO,IAAP;AACH;;AAED,QAAIA,KAAK,QAAL,KAAkBhI,QAAQiR,IAA9B,EAAoC;AAChCjJ,aAAK9H,MAAL,GAAc4Q,gBAAgB9I,IAAhB,EAAsBhI,QAAQiR,IAAR,CAAajJ,KAAK,QAAL,CAAb,EAA6B9H,MAAnD,CAAd;AACH,KAFD,MAEO;AACH;AACA8H,aAAK9H,MAAL,GAAc2P,eAAe7H,IAAf,CAAd;AACH;AACDhI,YAAQiR,IAAR,CAAajJ,KAAK,QAAL,CAAb,IAA+BA,IAA/B;AACH;;AAED,SAASuO,cAAT,CAAwB5L,CAAxB,EAA2B3C,IAA3B,EAAiC;AAC7B,QAAI,CAAC/G,MAAMC,GAAN,CAAU,aAAV,CAAL,EAA+B;AAC3B,eAAO,KAAP;AACH;;AAED,QAAIsV,SAASxO,KAAK,UAAL,IAAmB,GAAnB,GAAyBA,KAAK,WAAL,CAAtC;;AAEA,QAAI,EAAEwO,UAAUxW,QAAQ+S,OAApB,CAAJ,EAAkC;AAC9B;AACA,YAAI/K,KAAK9H,MAAT,EAAiB;AACb8H,iBAAK9H,MAAL,CAAYE,MAAZ,CAAmB,IAAnB;AACH;AACD4H,aAAK9H,MAAL,GAAcsR,mBAAmBxJ,IAAnB,CAAd;AACAhI,gBAAQ+S,OAAR,CAAgByD,MAAhB,IAA0BxO,IAA1B;AACH,KAPD,MAOO;AACHhI,gBAAQ+S,OAAR,CAAgByD,MAAhB,EAAwBF,aAAxB,GAAwCtO,KAAK,eAAL,CAAxC;AACH;AACJ;;AAED,SAASyO,aAAT,GAAyB;AACrB,QAAI,CAACxV,MAAMC,GAAN,CAAU,aAAV,CAAL,EAA+B;AAC3B,eAAO,KAAP;AACH;;AAED0E,MAAEc,IAAF,CAAO1G,QAAQ+S,OAAf,EAAwB,UAAUnM,GAAV,EAAeC,KAAf,EAAsB;AAC1C,YAAIjJ,IAAIuV,SAAJ,GAAgBC,UAAhB,CAA2BvM,MAAM3G,MAAN,CAAaiT,SAAb,EAA3B,CAAJ,EAA0D;AACtDtM,kBAAM3G,MAAN,CAAawW,UAAb,CAAwB;AACpBxJ,2BAAWkE,eAAevK,MAAM,eAAN,CAAf;AADS,aAAxB;AAGH;AACJ,KAND;AAOH;;AAED,SAAS8P,kBAAT,CAA4BhM,CAA5B,EAA+B3C,IAA/B,EAAqC;AACjC,QAAI,CAAC/G,MAAMC,GAAN,CAAU,iBAAV,CAAL,EAAmC;AAC/B,eAAO,KAAP;AACH;;AAED,QAAIzB,KAAKuI,KAAK,eAAL,CAAT;;AAEA,QAAI,EAAEvI,MAAMO,QAAQ4W,WAAhB,CAAJ,EAAkC;AAC9B;AACA,YAAI5O,KAAK9H,MAAT,EAAiB;AACb8H,iBAAK9H,MAAL,CAAYE,MAAZ,CAAmB,IAAnB;AACH;AACD4H,aAAK9H,MAAL,GAAcqS,sBAAsBvK,IAAtB,CAAd;AACAhI,gBAAQ4W,WAAR,CAAoBnX,EAApB,IAA0BuI,IAA1B;AACH;AACJ;;AAED,SAAS6O,iBAAT,GAA6B;AACzB,QAAI,CAAC5V,MAAMC,GAAN,CAAU,iBAAV,CAAL,EAAmC;AAC/B,eAAO,KAAP;AACH;;AAED,QAAIF,OAAOpD,IAAIuG,OAAJ,EAAX;;AAEAyB,MAAEc,IAAF,CAAO1G,QAAQ4W,WAAf,EAA4B,UAAUhQ,GAAV,EAAeC,KAAf,EAAsB;AAC9C,YAAIjJ,IAAIuV,SAAJ,GAAgB/C,QAAhB,CAAyBvJ,MAAM3G,MAAN,CAAayF,WAAb,EAAzB,CAAJ,EAA0D;AACtD,gBAAI2L,MAAMI,oBAAoB7K,MAAM,MAAN,CAApB,CAAV;AACAA,kBAAM3G,MAAN,CAAauE,OAAb,CAAqBkN,gBAAgBL,GAAhB,EAAqBtQ,IAArB,CAArB;AACA6F,kBAAM3G,MAAN,CAAa4W,SAAb,CAAuB1E,gBAAgBd,GAAhB,CAAvB;AACH;AACJ,KAND;AAOH;;AAED,SAASpN,SAAT,GAAqB;AACjB,QAAIvC,WAAW/D,IAAImZ,SAAJ,EAAf;AACA9V,UAAMuB,GAAN,CAAU,6BAAV,EAAyC;AACrC5B,aAAKe,SAASf,GAAT,EADgC;AAErCE,aAAKa,SAASb,GAAT;AAFgC,KAAzC;;AAKA2S,kBAAcuD,IAAd,CAAmB,UAAUC,MAAV,EAAkB;AACjCrR,UAAEc,IAAF,CAAOuQ,OAAOhX,QAAd,EAAwBmV,eAAxB;AACAxP,UAAEc,IAAF,CAAOuQ,OAAO1B,SAAd,EAAyBD,gBAAzB;AACA1P,UAAEc,IAAF,CAAOuQ,OAAOhG,IAAd,EAAoB4E,WAApB;AACAjQ,UAAEc,IAAF,CAAOuQ,OAAOlE,OAAd,EAAuBwD,cAAvB;AACA3Q,UAAEc,IAAF,CAAOuQ,OAAOL,WAAd,EAA2BD,kBAA3B;AACA3D,4BAAoBhT,QAAQC,QAA5B,EAAsC,SAAtC;AACA+S,4BAAoBhT,QAAQqE,YAA5B,EAA0C,SAA1C;AACA2O,4BAAoBhT,QAAQiR,IAA5B,EAAkC,KAAlC;AACA+B,4BAAoBhT,QAAQuV,SAA5B,EAAuC,UAAvC;AACAvC,4BAAoBhT,QAAQ+S,OAA5B,EAAqC,SAArC;AACAC,4BAAoBhT,QAAQ4W,WAA5B,EAAyC;AACrC;AADJ;AAGA/D;;AAEA4D;AACAI;AACApB;;AAEA,YAAI7P,EAAE,QAAF,EAAYsR,QAAZ,CAAqB,SAArB,CAAJ,EAAqC;AACjCC,yBAAavZ,GAAb;AACH;;AAEDO,iBAAS8Y,OAAO9Y,MAAhB;AACAC,iBAAS6Y,OAAO7Y,MAAhB;AACAC,iBAAS4Y,OAAO5Y,MAAhB;AACAC,iBAAS2Y,OAAO3Y,MAAhB;;AAEAE,mBAAWyY,OAAOzY,QAAlB;AACAD,wBAAgB0Y,OAAO1Y,aAAvB;AACAE,sBAAcwY,OAAOxY,WAArB;AACAC,oBAAYuY,OAAOvY,SAAnB;AACAC,qBAAasY,OAAOtY,UAApB;;AAEAhB,gBAAQsZ,OAAOtZ,KAAf;AACA,YAAIA,iBAAiBgQ,KAArB,EAA4B;AACxBjQ,gCAAoBC,MAAMyZ,MAAN,CAAa,UAAUC,CAAV,EAAa;AAC1C,uBAAO,KAAK/H,OAAL,CAAa+H,CAAb,IAAkB,CAAzB;AACH,aAFmB,EAEjB3Z,iBAFiB,CAApB;AAGH;AACDN,oBAAY6Z,OAAO7Z,SAAnB;AACA0B,yBAAiB4E,KAAKyK,GAAL,EAAjB;AACH,KA3CD;AA4CH;;AAED,SAASmJ,YAAT,CAAsB7L,MAAtB,EAA8B;AAAE;AAC5B,QAAI8L,iBAAiB,EAArB;AACA3R,MAAEc,IAAF,CAAO+E,MAAP,EAAe,UAAU+L,GAAV,EAAeC,KAAf,EAAsB;AACjCF,uBAAe3B,IAAf,CAAoB;AAChBhV,iBAAK6W,MAAM,UAAN,CADW;AAEhB3W,iBAAK2W,MAAM,WAAN;AAFW,SAApB;AAIH,KALD;AAMA,QAAIxZ,QAAJ,EAAc;AACVA,iBAASmC,MAAT,CAAgB,IAAhB;AACH;AACDnC,eAAW,IAAIsC,OAAOC,IAAP,CAAYkX,QAAhB,CAAyB;AAChCC,cAAMJ,cAD0B;AAEhCK,kBAAU,IAFsB;AAGhC5K,qBAAa,SAHmB;AAIhCC,uBAAe,GAJiB;AAKhCF,sBAAc,CALkB;AAMhCnP,aAAKA;AAN2B,KAAzB,CAAX;AAQH;;AAED,SAASwG,aAAT,CAAuByT,WAAvB,EAAoC;AAChC,QAAI1I,mBAAmB,IAAvB;AACAvJ,MAAEc,IAAF,CAAOmR,WAAP,EAAoB,UAAUjR,GAAV,EAAeC,KAAf,EAAsB;AACtC,YAAImB,OAAO6P,YAAYjR,GAAZ,CAAX;AACA,YAAI,CAACoB,KAAK3H,MAAV,EAAkB;AACd,gBAAI2H,KAAK9H,MAAL,CAAYC,WAAhB,EAA6B6H,KAAK9H,MAAL,CAAYC,WAAZ,CAAwBC,MAAxB,CAA+B,IAA/B;AAC7B,gBAAI0X,YAAYzC,mBAAmBrN,IAAnB,EAAyBpK,GAAzB,EAA8B,KAAKsC,MAAL,CAAYmP,iBAA1C,CAAhB;AACAH,mCAAuB4I,SAAvB,EAAkC9P,IAAlC,EAAwCmH,gBAAxC;AACAnH,iBAAK9H,MAAL,CAAYE,MAAZ,CAAmB,IAAnB;AACAyX,wBAAYjR,GAAZ,EAAiB1G,MAAjB,GAA0B4X,SAA1B;AACH;AACJ,KATD;AAUH;;AAED,IAAIlH,sBAAsB,SAASA,mBAAT,GAA+B;AACrDhL,MAAE,kBAAF,EAAsBc,IAAtB,CAA2B,UAAU4C,KAAV,EAAiByO,OAAjB,EAA0B;AACjD,YAAIC,eAAe9J,aAAa+J,SAASF,QAAQ7H,YAAR,CAAqB,eAArB,CAAT,CAAb,CAAnB;;AAEA,YAAIgI,QAAQF,aAAazJ,IAAzB;AACA,YAAI4J,UAAUH,aAAa1J,GAA3B;AACA,YAAIxC,UAAUkM,aAAa3J,GAA3B;AACA,YAAI+J,aAAa,EAAjB;;AAEA,YAAIJ,aAAaK,KAAb,GAAqBL,aAAa7J,GAAtC,EAA2C;AACvCiK,yBAAa,WAAb;AACH,SAFD,MAEO;AACHA,yBAAa,GAAb;AACA,gBAAIF,QAAQ,CAAZ,EAAe;AACXE,6BAAaF,QAAQ,GAArB;AACH;;AAEDE,0BAAc5K,KAAK2K,OAAL,EAAc,CAAd,EAAiB,CAAjB,IAAsB,GAApC;AACAC,0BAAc5K,KAAK1B,OAAL,EAAc,CAAd,EAAiB,CAAjB,IAAsB,GAApC;AACAsM,0BAAc,GAAd;AACH;;AAEDxS,UAAEmS,OAAF,EAAW/Q,IAAX,CAAgBoR,UAAhB;AACH,KAtBD;AAuBH,CAxBD;;AA0BA,SAASE,gBAAT,CAA0BC,MAA1B,EAAkCC,MAAlC,EAA0C;AACtC,WAAOjY,OAAOC,IAAP,CAAY6F,QAAZ,CAAqBoS,SAArB,CAA+BC,sBAA/B,CAAsDH,MAAtD,EAA8DC,MAA9D,CAAP;AACH;;AAED,SAAShJ,gBAAT,CAA0BmJ,KAA1B,EAAiC3R,IAAjC,EAAuCtC,IAAvC,EAA6C9D,GAA7C,EAAkDE,GAAlD,EAAuD;AACnD,QAAI,EAAE,kBAAkB0G,MAApB,CAAJ,EAAiC;AAC7B,eAAO,KAAP,CAD6B,CAChB;AAChB;;AAED,QAAIoR,aAAaC,UAAb,KAA4B,SAAhC,EAA2C;AACvCD,qBAAaE,iBAAb;AACH,KAFD,MAEO;AACH,YAAIC,eAAe,IAAIH,YAAJ,CAAiBD,KAAjB,EAAwB;AACvCjU,kBAAMA,IADiC;AAEvCsU,kBAAMhS,IAFiC;AAGvCiS,mBAAO;AAHgC,SAAxB,CAAnB;;AAMAF,qBAAaG,OAAb,GAAuB,YAAY;AAC/B1R,mBAAO2R,KAAP;AACAJ,yBAAalI,KAAb;;AAEAuI,sBAAUxY,GAAV,EAAeE,GAAf,EAAoB,EAApB;AACH,SALD;AAMH;AACJ;;AAED,SAASwD,sBAAT,GAAkC;AAC9B,QAAI+U,oBAAoBzc,SAAS0c,aAAT,CAAuB,KAAvB,CAAxB;;AAEA,QAAIC,iBAAiB3c,SAAS0c,aAAT,CAAuB,QAAvB,CAArB;AACAC,mBAAe/X,KAAf,CAAqBgY,eAArB,GAAuC,MAAvC;AACAD,mBAAe/X,KAAf,CAAqBiY,MAArB,GAA8B,MAA9B;AACAF,mBAAe/X,KAAf,CAAqBkY,OAArB,GAA+B,MAA/B;AACAH,mBAAe/X,KAAf,CAAqBmY,KAArB,GAA6B,MAA7B;AACAJ,mBAAe/X,KAAf,CAAqBwH,MAArB,GAA8B,MAA9B;AACAuQ,mBAAe/X,KAAf,CAAqBoY,YAArB,GAAoC,KAApC;AACAL,mBAAe/X,KAAf,CAAqBqY,SAArB,GAAiC,2BAAjC;AACAN,mBAAe/X,KAAf,CAAqBsY,MAArB,GAA8B,SAA9B;AACAP,mBAAe/X,KAAf,CAAqBuY,WAArB,GAAmC,MAAnC;AACAR,mBAAe/X,KAAf,CAAqBwY,OAArB,GAA+B,KAA/B;AACAT,mBAAeZ,KAAf,GAAuB,aAAvB;AACAU,sBAAkBY,WAAlB,CAA8BV,cAA9B;;AAEA,QAAIW,eAAetd,SAAS0c,aAAT,CAAuB,KAAvB,CAAnB;AACAY,iBAAa1Y,KAAb,CAAmB2Y,MAAnB,GAA4B,KAA5B;AACAD,iBAAa1Y,KAAb,CAAmBmY,KAAnB,GAA2B,MAA3B;AACAO,iBAAa1Y,KAAb,CAAmBwH,MAAnB,GAA4B,MAA5B;AACAkR,iBAAa1Y,KAAb,CAAmB4Y,eAAnB,GAAqC,sCAArC;AACAF,iBAAa1Y,KAAb,CAAmB6Y,cAAnB,GAAoC,YAApC;AACAH,iBAAa1Y,KAAb,CAAmB8Y,kBAAnB,GAAwC,SAAxC;AACAJ,iBAAa1Y,KAAb,CAAmB+Y,gBAAnB,GAAsC,WAAtC;AACAL,iBAAaza,EAAb,GAAkB,kBAAlB;AACA8Z,mBAAeU,WAAf,CAA2BC,YAA3B;;AAEAX,mBAAeiB,gBAAf,CAAgC,OAAhC,EAAyC,YAAY;AACjDC;AACH,KAFD;;AAIApB,sBAAkB/P,KAAlB,GAA0B,CAA1B;AACA1L,QAAI8c,QAAJ,CAAana,OAAOC,IAAP,CAAYoB,eAAZ,CAA4B+Y,YAAzC,EAAuD/E,IAAvD,CAA4DyD,iBAA5D;;AAEA9Y,WAAOC,IAAP,CAAYiF,KAAZ,CAAkB3B,WAAlB,CAA8BlG,GAA9B,EAAmC,SAAnC,EAA8C,YAAY;AACtD,YAAIgd,kBAAkBhe,SAAS8D,cAAT,CAAwB,kBAAxB,CAAtB;AACAka,wBAAgBpZ,KAAhB,CAAsB8Y,kBAAtB,GAA2C,SAA3C;AACH,KAHD;AAIH;;AAED,SAASG,mBAAT,GAA+B;AAC3B,QAAIG,kBAAkBhe,SAAS8D,cAAT,CAAwB,kBAAxB,CAAtB;AACA,QAAIka,oBAAoB,IAAxB,EAA8B;AAC1B,YAAIC,OAAO,GAAX;AACA,YAAIC,oBAAoBC,YAAY,YAAY;AAC5C,gBAAIF,SAAS,KAAb,EAAoB;AAChBA,uBAAO,GAAP;AACH,aAFD,MAEO;AACHA,uBAAO,KAAP;AACH;AACDD,4BAAgBpZ,KAAhB,CAAsB8Y,kBAAtB,GAA2CO,OAAO,MAAlD;AACH,SAPuB,EAOrB,GAPqB,CAAxB;AAQH;AACD,QAAIG,UAAUC,WAAd,EAA2B;AACvBD,kBAAUC,WAAV,CAAsBC,kBAAtB,CAAyC,UAAUvZ,QAAV,EAAoB;AACzD,gBAAIwZ,SAAS,IAAI5a,OAAOC,IAAP,CAAYgM,MAAhB,CAAuB7K,SAASyZ,MAAT,CAAgBhT,QAAvC,EAAiDzG,SAASyZ,MAAT,CAAgB/S,SAAjE,CAAb;AACAvK,2BAAeud,WAAf,CAA2BF,MAA3B;AACAvd,gBAAI0d,SAAJ,CAAcH,MAAd;AACAla,kBAAMuB,GAAN,CAAU,0BAAV,EAAsC;AAClC5B,qBAAKe,SAASyZ,MAAT,CAAgBhT,QADa;AAElCtH,qBAAKa,SAASyZ,MAAT,CAAgB/S;AAFa,aAAtC;AAIAkT,0BAAcT,iBAAd;AACA,gBAAIF,oBAAoB,IAAxB,EAA8B;AAC1BA,gCAAgBpZ,KAAhB,CAAsB8Y,kBAAtB,GAA2C,YAA3C;AACH;AACJ,SAZD;AAaH,KAdD,MAcO;AACHiB,sBAAcT,iBAAd;AACA,YAAIF,oBAAoB,IAAxB,EAA8B;AAC1BA,4BAAgBpZ,KAAhB,CAAsB8Y,kBAAtB,GAA2C,SAA3C;AACH;AACJ;AACJ;;AAED,SAAS9T,cAAT,CAAwB5F,GAAxB,EAA6BE,GAA7B,EAAkC;AAC9B,QAAIwF,MAAM,IAAI/F,OAAOC,IAAP,CAAYgM,MAAhB,CAAuB5L,GAAvB,EAA4BE,GAA5B,CAAV;AACAlD,QAAI0d,SAAJ,CAAchV,GAAd;AACH;;AAED,SAAS8S,SAAT,CAAmBxY,GAAnB,EAAwBE,GAAxB,EAA6BE,IAA7B,EAAmC;AAC/B,QAAIsF,MAAM,IAAI/F,OAAOC,IAAP,CAAYgM,MAAhB,CAAuB5L,GAAvB,EAA4BE,GAA5B,CAAV;;AAEAlD,QAAI0d,SAAJ,CAAchV,GAAd;;AAEA,QAAItF,IAAJ,EAAU;AACNhD,oBAAY,KAAZ;AACAJ,YAAI4d,OAAJ,CAAYxa,IAAZ;AACH;AACJ;;AAED,SAAS6H,IAAT,CAAc4S,IAAd,EAAoB;AAChB,QAAI7V,EAAE8V,aAAF,CAAgB1e,cAAhB,KAAmCL,aAAa,IAAhD,IAAwDM,kBAAkBC,uBAA9E,EAAuG;AACnG0I,UAAE8O,IAAF,CAAO;AACHnN,iBAAK,yBAAyB5K,QAAzB,GAAoC,WADtC;AAEHkY,sBAAU,MAFP;AAGH8G,mBAAO,KAHJ;AAIHC,qBAAS,SAASA,OAAT,CAAiBhH,IAAjB,EAAuB;AAC5B5X,iCAAiB4X,IAAjB;AACH,aANE;AAOHI,mBAAO,SAASA,KAAT,CAAe6G,KAAf,EAAsBC,MAAtB,EAA8BC,MAA9B,EAAsC;AACzCC,wBAAQC,GAAR,CAAY,oCAAoCF,MAAhD;AACA9e;AACH;AAVE,SAAP;AAYH;AACD,QAAIwe,QAAQze,cAAZ,EAA4B;AACxB,eAAOA,eAAeye,IAAf,CAAP;AACH,KAFD,MAEO;AACH;AACA,eAAOA,IAAP;AACH;AACJ;;AAED,SAASS,iBAAT,GAA6B;AACzB,QAAIlB,UAAUC,WAAV,IAAyBha,MAAMC,GAAN,CAAU,kBAAV,CAA7B,EAA4D;AACxD8Z,kBAAUC,WAAV,CAAsBC,kBAAtB,CAAyC,UAAUvZ,QAAV,EAAoB;AACzD,gBAAIf,MAAMe,SAASyZ,MAAT,CAAgBhT,QAA1B;AACA,gBAAItH,MAAMa,SAASyZ,MAAT,CAAgB/S,SAA1B;AACA,gBAAI1H,SAAS,IAAIJ,OAAOC,IAAP,CAAYgM,MAAhB,CAAuB5L,GAAvB,EAA4BE,GAA5B,CAAb;;AAEA,gBAAIG,MAAMC,GAAN,CAAU,kBAAV,CAAJ,EAAmC;AAC/B,oBAAI,OAAOpD,cAAP,KAA0B,WAA1B,IAAyCwa,iBAAiBxa,eAAe6H,WAAf,EAAjB,EAA+ChF,MAA/C,KAA0D,CAAvG,EAA0G;AACtG/C,wBAAIue,KAAJ,CAAUxb,MAAV;AACA7C,mCAAeud,WAAf,CAA2B1a,MAA3B;AACAM,0BAAMuB,GAAN,CAAU,0BAAV,EAAsC;AAClC5B,6BAAKA,GAD6B;AAElCE,6BAAKA;AAF6B,qBAAtC;AAIH;AACJ;AACJ,SAfD;AAgBH;AACJ;;AAED,SAASsb,kBAAT,GAA8B;AAC1B,QAAI;AACA,YAAI3L,oBAAoBjJ,OAAO6U,MAA/B,EAAuC;AACnC,gBAAIC,aAAa,IAAIC,IAAJ,CAAS,CAAC,iQAAD,CAAT,CAAjB;;AAEA,gBAAIC,gBAAgBhV,OAAOiV,GAAP,CAAWC,eAAX,CAA2BJ,UAA3B,CAApB;;AAEAzd,2BAAe,IAAIwd,MAAJ,CAAWG,aAAX,CAAf;;AAEA3d,yBAAa8d,SAAb,GAAyB,UAAUtF,CAAV,EAAa;AAClC,oBAAIzC,OAAOyC,EAAEzC,IAAb;AACA,oBAAIhY,SAASyD,MAAT,IAAmBuU,KAAKtS,IAAL,KAAc,kBAAjC,IAAuDoB,KAAKyK,GAAL,KAAarP,cAAb,GAA8B,IAAzF,EAA+F;AAC3FoF;AACAgY;AACH;AACJ,aAND;;AAQArd,yBAAa+d,WAAb,CAAyB;AACrBta,sBAAM;AADe,aAAzB;AAGH;AACJ,KApBD,CAoBE,OAAOua,EAAP,EAAW;AACTb,gBAAQC,GAAR,CAAY,sBAAsBY,GAAGC,OAArC;AACH;AACJ;;AAED,SAASvM,cAAT,CAAwB9Q,EAAxB,EAA4B;AACxB;AACA,QAAIsd,UAAUngB,SAASqT,aAAT,CAAuB,cAAvB,CAAd;AACA,QAAI+M,YAAJ;;AAEAD,YAAQ5M,SAAR,CAAkB8M,GAAlB,CAAsB,SAAtB;;AAEA,QAAIrI,OAAOhP,EAAE8O,IAAF,CAAO;AACdnN,aAAK,UADS;AAEdF,cAAM,KAFQ;AAGdsN,iBAAS,MAHK;AAIdC,cAAM;AACF,kBAAMnV;AADJ,SAJQ;AAOdoV,kBAAU,MAPI;AAQdC,eAAO;AARO,KAAP,CAAX;;AAWAF,SAAKoC,IAAL,CAAU,UAAUC,MAAV,EAAkB;AACxB,YAAI1L,WAAWC,YAAYyL,OAAOnB,UAAnB,CAAf;AACA,YAAIoH,kBAAkBle,YAAYuM,WAAW,CAAvB,KAA6B,KAAnD;AACA,YAAI4R,qBAAqBlG,OAAOnB,UAAP,GAAoBoH,eAApB,GAAsC,GAA/D;AACA,YAAIjS,kBAAkBvD,WAAWuP,OAAOX,aAAlB,CAAtB;AACA,YAAIpL,iBAAiB,EAArB;AACA,YAAI+L,OAAOZ,YAAP,IAAuB,IAA3B,EAAiC;AAC7BnL,6BACI,kCACA,gBADA,GACmBxD,WAAWuP,OAAOZ,YAAlB,CADnB,GAEA,QAHJ;AAIH;AACD,YAAIF,UAAUc,OAAOd,OAAP,KAAmBvN,SAAnB,GAA+BqO,OAAOd,OAAtC,GAAgD,EAA9D;AACA,YAAIiH,YAAYjH,QAAQ7L,MAAR,GAAiBiB,WAAW4K,QAAQ7L,MAApC,GAA6C,CAA7D;AACA,YAAI+S,eAAeD,YAAY,QAAQA,SAAR,GAAoB,aAAhC,GAAgD,EAAnE;AACA,YAAIE,cAAc,EAAlB;;AAEA,YAAIrG,OAAO5D,OAAP,KAAmB,CAAvB,EAA0B;AACtBiK,0BACI,yBAAyBrG,OAAO5D,OAAhC,GAA0C,SAA1C,GACA,iBADA,GACoB4D,OAAO5D,OAD3B,GACqC,sCADrC,GAEA,WAHJ;AAIH,SALD,MAKO;AACHiK,0BACI,UACA,iBADA,GACoBrG,OAAO5D,OAD3B,GACqC,eADrC,GACuD9H,QADvD,GACkE8R,YADlE,GACiF,MADjF,GAEA,QAHJ;AAIH;;AAED,YAAIE,cAAc,EAAlB;;AAEA,YAAIC,aACA,yBAAyBvG,OAAO5D,OAAhC,GAA0C,SAA1C,GACA,OADA,GAEA,iBAFA,GAEoB4D,OAAO5D,OAF3B,GAEqC,SAFrC,IAEkD4D,OAAO3U,IAAP,IAAe,EAFjE,IAEuE,MAFvE,GAGA,QAHA,GAIA,6DAJA,GAIgEvD,SAASkY,OAAO5D,OAAhB,CAJhE,GAI2F,cAJ3F,GAKA,gCALA,GAKmC4D,OAAO5D,OAL1C,GAKoD,IALpD,GAMA,4BANA,GAM+B4D,OAAO5D,OANtC,GAMgD,kBANhD,GAMqE8J,kBANrE,GAM0F,KAN1F,GAOA,QAPA,GAQA,QARA,GASA,OATA,GAUAlG,OAAOnB,UAVP,GAUoB,GAVpB,GAU0BoH,eAV1B,GAWA,QAXA,GAYAI,WAZA,GAaA,+BAbA,GAcA,iBAdA,GAcoBrS,eAdpB,GAeA,QAfA,GAgBAC,cAhBA,GAiBA,OAjBA,GAkBA,wEAlBA,GAkB2E+L,OAAO7O,QAlBlF,GAkB6F,GAlB7F,GAkBmG6O,OAAO5O,SAlB1G,GAkBsH,+CAlBtH,GAmBA,QAnBA,GAoBA,WArBJ;;AAuBA,YAAI8N,QAAQ7L,MAAZ,EAAoB;AAChB1E,cAAEc,IAAF,CAAOyP,OAAP,EAAgB,UAAUxL,CAAV,EAAawL,OAAb,EAAsB;AAClC,oBAAIsH,iBAAiBhU,MAAM0M,QAAQuH,SAAd,EAAyBvH,QAAQwH,UAAjC,EAA6CxH,QAAQyH,UAArD,CAArB;AACA,oBAAIC,aAAa9R,KAAKwB,KAAL,CAAW,MAAM4I,QAAQ2H,aAAzB,CAAjB;;AAEAP,+BACI,+CACA,mBADA,GAEA,4BAFA,GAE+BpH,QAAQpL,UAFvC,GAEoD,QAFpD,GAGA,OAHA,GAIA,kBAJA,GAIqBkM,OAAO5D,OAJ5B,GAIsC,SAJtC,GAKA,+BALA,GAKkC8C,QAAQvL,YAL1C,GAKyD,QALzD,GAMA,qBANA,GAMwBuL,QAAQnL,UANhC,GAM6C,QAN7C,GAOA,OAPA,GAQA,8BARA,GAQiCiM,OAAO5D,OARxC,GAQkD,wBARlD,GASA,6BATA,GASgC8C,QAAQrL,aATxC,GASwD,QATxD,GAUA,gCAVA,GAUmCqL,QAAQtL,YAV3C,GAU0D,QAV1D,GAWA,OAXA,GAYA,iBAZA,GAaA,6DAbA,GAcA,iBAdA,GAcoBoM,OAAO5D,OAd3B,GAcqC,qCAdrC,GAeA,aAfA,GAgBA,OAhBA,GAiBA,OAjBA,GAkBA,sBAlBA,GAmBA,kBAnBA,GAoBA,mBApBA,GAqBA,kBArBA,GAsBA,6BAtBA,GAuBA,qBAvBA,GAwBA8C,QAAQuH,SAxBR,GAyBA,QAzBA,GA0BA,QA1BA,GA2BA,kBA3BA,GA4BA,6BA5BA,GA6BA,qBA7BA,GA8BAvH,QAAQwH,UA9BR,GA+BA,QA/BA,GAgCA,QAhCA,GAiCA,kBAjCA,GAkCA,6BAlCA,GAmCA,qBAnCA,GAoCAxH,QAAQyH,UApCR,GAqCA,QArCA,GAsCA,QAtCA,GAuCA,sCAvCA,GAwCA,iCAxCA,GAyCA,qBAzCA,GA0CAH,eAAe/T,OAAf,CAAuB,CAAvB,CA1CA,GA0C4B,EA1C5B,GA2CA,wCA3CA,GA4CA,QA5CA,GA6CA,QA7CA,GA8CA,QA9CA,GA+CA,OA/CA,GAgDA,kBAhDA,GAiDA,qBAjDA,GAkDA,oBAlDA,GAmDA,oBAnDA,GAoDAyM,QAAQ4H,WApDR,GAqDA,oBArDA,GAqDuB5H,QAAQ6H,WAAR,CAAoBC,WAApB,EArDvB,GAqD2D,IArD3D,GAqDkE9H,QAAQ6H,WArD1E,GAqDwF,QArDxF,GAsDA,QAtDA,GAuDA,sBAvDA,GAwDA7H,QAAQ+H,aAxDR,GAyDA,QAzDA,GA0DA,QA1DA,GA2DA,MA3DA,GA4DA,oBA5DA,GA6DA,oBA7DA,GA8DA/H,QAAQgI,WA9DR,GA+DA,oBA/DA,GA+DuBhI,QAAQiI,WAAR,CAAoBH,WAApB,EA/DvB,GA+D2D,IA/D3D,GA+DkE9H,QAAQiI,WA/D1E,GA+DwF,QA/DxF,GAgEA,OAhEA,GAiEA,4CAjEA,GAiE+CP,UAjE/C,GAiE4D,QAjE5D,GAkEA,QAlEA,GAmEA,QAnEA,GAoEA,sBApEA,GAqEA1H,QAAQkI,aArER,GAsEA,QAtEA,GAuEA,QAvEA,GAwEA,QAxEA,GAyEA,OAzEA,GA0EA,OA3EJ;AA4EH,aAhFD;;AAkFAd,0BAAc,mBAAmBA,WAAnB,GAAiC,kBAA/C;AACH,SApFD,MAoFO,IAAItG,OAAO5D,OAAP,KAAmB,CAAvB,EAA0B;AAC7BkK,0BAAc,EAAd;AACH,SAFM,MAEA;AACHA,0BACI,yBAAyBtG,OAAO5D,OAAhC,GAA0C,SAA1C,GACA,iBADA,GAEA,kCAFA,GAEqC4D,OAAOqH,gBAF5C,GAE+D,YAF/D,GAGA,iBAHA,GAGoBrH,OAAO5D,OAH3B,GAGqC,SAHrC,GAGiD4D,OAAOsH,kBAHxD,GAG6E,MAH7E,GAIA,0CAJA,GAKA,gNALA,GAMA,MANA,GAOA,WARJ;AASH;;AAEDxB,gBAAQyB,SAAR,GAAoBhB,aAAaD,WAAjC;;AAEAP,uBAAepgB,SAAS0c,aAAT,CAAuB,GAAvB,CAAf;AACA0D,qBAAayB,IAAb,GAAoB,GAApB;AACAzB,qBAAa0B,SAAb,GAAyB,OAAzB;AACA1B,qBAAa2B,QAAb,GAAwB,CAAxB;AACA5B,gBAAQ9C,WAAR,CAAoB+C,YAApB;;AAEAA,qBAAaxC,gBAAb,CAA8B,OAA9B,EAAuC,UAAU/U,KAAV,EAAiB;AACpDA,kBAAMmZ,cAAN;AACAnZ,kBAAMoZ,eAAN;AACA9B,oBAAQ5M,SAAR,CAAkBE,MAAlB,CAAyB,SAAzB;AACH,SAJD;AAKH,KArKD;AAsKH;;AAED,SAASyO,uBAAT,CAAiCzH,CAAjC,EAAoC;AAAE;AAClCA,MAAE0H,gBAAF,CAAmBC,iBAAnB,CAAqC7O,SAArC,CAA+CrK,MAA/C,CAAsD,oBAAtD;AACAuR,MAAE0H,gBAAF,CAAmBC,iBAAnB,CAAqC7O,SAArC,CAA+CrK,MAA/C,CAAsD,sBAAtD;AACAuR,MAAE4H,kBAAF,CAAqB9O,SAArB,CAA+BrK,MAA/B,CAAsC,SAAtC;AACH;;AAED;AACA;AACA;;AAEAF,EAAE,YAAY;AACV,QAAI;AACA,YAAI,CAACgT,YAAL,EAAmB;AACfoD,oBAAQC,GAAR,CAAY,8BAAZ;AACA;AACH;AACJ,KALD,CAKE,OAAOiD,GAAP,EAAY,CACb;;AAED,QAAI;AACA,YAAItG,aAAaC,UAAb,KAA4B,SAAhC,EAA2C;AACvCD,yBAAaE,iBAAb;AACH;AACJ,KAJD,CAIE,OAAOoG,GAAP,EAAY,CACb;AACJ,CAfD;;AAiBAtZ,EAAE,YAAY;AACV;AACA7J,mBAAe6J,EAAE,YAAF,CAAf;;AAEA;AACAA,MAAEuZ,OAAF,CAAU,oCAAV,EAAgDnI,IAAhD,CAAqD,UAAUpC,IAAV,EAAgB;AACjE,YAAIwK,YAAY,EAAhB;;AAEAxZ,UAAEc,IAAF,CAAOkO,IAAP,EAAa,UAAUhO,GAAV,EAAeC,KAAf,EAAsB;AAC/BuY,sBAAUxJ,IAAV,CAAe;AACXnW,oBAAImH,GADO;AAEXI,sBAAM6B,KAAKhC,KAAL;AAFK,aAAf;AAIH,SALD;;AAOA;AACA9K,qBAAasjB,OAAb,CAAqB;AACjBC,yBAAa,cADI;AAEjB1K,kBAAMwK,SAFW;AAGjBG,qCAAyBC;AAHR,SAArB;;AAMA;AACAzjB,qBAAa0jB,EAAb,CAAgB,QAAhB,EAA0B,UAAUpI,CAAV,EAAa;AACnCzY,4BAAgB7C,aAAa2D,GAAb,EAAhB;AACA9B,gBAAIqG,YAAJ,CAAiBrF,aAAjB;AACAqC,kBAAMuB,GAAN,CAAU,WAAV,EAAuB5D,aAAvB;AACH,SAJD;;AAMA;AACA7C,qBAAa2D,GAAb,CAAiBuB,MAAMC,GAAN,CAAU,WAAV,CAAjB,EAAyCtB,OAAzC,CAAiD,QAAjD;AACH,KA1BD;;AA4BA5D,4BAAwB4J,EAAE,gBAAF,CAAxB;;AAEA5J,0BAAsBqjB,OAAtB,CAA8B;AAC1BC,qBAAa,wBADa;AAE1BC,iCAAyBC;AAFC,KAA9B;;AAKAxjB,0BAAsByjB,EAAtB,CAAyB,QAAzB,EAAmC,YAAY;AAC3Cxe,cAAMuB,GAAN,CAAU,cAAV,EAA0B,KAAKqE,KAA/B;AACAzC,sBAAcpE,QAAQC,QAAtB;AACAmE,sBAAcpE,QAAQqE,YAAtB;AACH,KAJD;;AAMApI,sBAAkB2J,EAAE,oBAAF,CAAlB;;AAEA3J,oBAAgBojB,OAAhB,CAAwB;AACpBC,qBAAa,kBADO;AAEpBC,iCAAyBC;AAFL,KAAxB;;AAKAvjB,oBAAgBwjB,EAAhB,CAAmB,QAAnB,EAA6B,YAAY;AACrCxe,cAAMuB,GAAN,CAAU,kBAAV,EAA8B,KAAKqE,KAAnC;AACAzC,sBAAcpE,QAAQC,QAAtB;AACAmE,sBAAcpE,QAAQqE,YAAtB;AACH,KAJD;;AAMAnI,0BAAsB0J,EAAE,wBAAF,CAAtB;;AAEA1J,wBAAoBmjB,OAApB,CAA4B;AACxBC,qBAAa,qBADW;AAExBC,iCAAyBC;AAFD,KAA5B;;AAKAtjB,wBAAoBujB,EAApB,CAAuB,QAAvB,EAAiC,YAAY;AACzCxe,cAAMuB,GAAN,CAAU,kBAAV,EAA8B,KAAKqE,KAAnC;AACArI,mBAAW,KAAX;AACA0F;AACH,KAJD;;AAMA/H,0BAAsByJ,EAAE,wBAAF,CAAtB;;AAEAzJ,wBAAoBkjB,OAApB,CAA4B;AACxBC,qBAAa,yBADW;AAExBC,iCAAyBC;AAFD,KAA5B;;AAKArjB,wBAAoBsjB,EAApB,CAAuB,QAAvB,EAAiC,YAAY;AACzCxe,cAAMuB,GAAN,CAAU,kBAAV,EAA8B,KAAKqE,KAAnC;AACArI,mBAAW,KAAX;AACA0F;AACH,KAJD;;AAMA9H,gCAA4BwJ,EAAE,0BAAF,CAA5B;;AAEAxJ,8BAA0BijB,OAA1B,CAAkC;AAC9BC,qBAAa,6BADiB;AAE9BC,iCAAyBC;AAFK,KAAlC;;AAKApjB,8BAA0BqjB,EAA1B,CAA6B,QAA7B,EAAuC,YAAY;AAC/Cxe,cAAMuB,GAAN,CAAU,yBAAV,EAAqC,KAAKqE,KAA1C;AACArI,mBAAW,KAAX;AACA0F;AACH,KAJD;;AAMA7H,yBAAqBuJ,EAAE,+BAAF,CAArB;;AAEAvJ,uBAAmBgjB,OAAnB,CAA2B;AACvBC,qBAAa,mBADU;AAEvBC,iCAAyBC;AAFF,KAA3B;;AAKAnjB,uBAAmBojB,EAAnB,CAAsB,QAAtB,EAAgC,YAAY;AACxCxe,cAAMuB,GAAN,CAAU,aAAV,EAAyB,KAAKqE,KAA9B;AACArI,mBAAW,KAAX;AACA0F;AACH,KAJD;;AAMA5H,yBAAqBsJ,EAAE,+BAAF,CAArB;;AAEAtJ,uBAAmB+iB,OAAnB,CAA2B;AACvBC,qBAAa,mBADU;AAEvBC,iCAAyBC;AAFF,KAA3B;;AAKAljB,uBAAmBmjB,EAAnB,CAAsB,QAAtB,EAAgC,YAAY;AACxCxe,cAAMuB,GAAN,CAAU,aAAV,EAAyB,KAAKqE,KAA9B;AACArI,mBAAW,KAAX;AACA0F;AACH,KAJD;;AAMA3H,gCAA4BqJ,EAAE,8BAAF,CAA5B;;AAEArJ,8BAA0B8iB,OAA1B,CAAkC;AAC9BC,qBAAa,2BADiB;AAE9BC,iCAAyBC;AAFK,KAAlC;;AAKAjjB,8BAA0BkjB,EAA1B,CAA6B,QAA7B,EAAuC,YAAY;AAC/Cxe,cAAMuB,GAAN,CAAU,wBAAV,EAAoC,KAAKqE,KAAzC;AACAtI,wBAAgB,KAAhB;AACA2F;AACH,KAJD;AAKAxH,wBAAoBkJ,EAAE,qBAAF,CAApB;;AAEAlJ,sBAAkB+iB,EAAlB,CAAqB,QAArB,EAA+B,YAAY;AACvCxe,cAAMuB,GAAN,CAAU,eAAV,EAA2B,KAAKkd,OAAhC;AACAlhB,mBAAW,KAAX;AACAoH,UAAEc,IAAF,CAAO,CAAC,MAAD,CAAP,EAAiB,UAAUiZ,CAAV,EAAaC,KAAb,EAAoB;AACjCha,cAAEc,IAAF,CAAO1G,QAAQ4f,KAAR,CAAP,EAAuB,UAAUhZ,GAAV,EAAeC,KAAf,EAAsB;AACzC;AACA,oBAAI7G,QAAQ4f,KAAR,EAAehZ,GAAf,EAAoB1G,MAApB,CAA2BC,WAA/B,EAA4C;AACxCH,4BAAQ4f,KAAR,EAAehZ,GAAf,EAAoB1G,MAApB,CAA2BC,WAA3B,CAAuCC,MAAvC,CAA8C,IAA9C;AACA,2BAAOJ,QAAQ4f,KAAR,EAAehZ,GAAf,EAAoB1G,MAApB,CAA2BC,WAAlC;AACH;AACDH,wBAAQ4f,KAAR,EAAehZ,GAAf,EAAoB1G,MAApB,CAA2BE,MAA3B,CAAkC,IAAlC;AACH,aAPD;AAQAJ,oBAAQ4f,KAAR,IAAiB,EAAjB;AACH,SAVD;AAWA1b;AACH,KAfD;;AAiBAzH,gCAA4BmJ,EAAE,uBAAF,CAA5B;;AAEAA,MAAEuZ,OAAF,CAAU,6CAAV,EAAyDnI,IAAzD,CAA8D,UAAUpC,IAAV,EAAgB;AAC1EzX,6BAAqByX,IAArB;AACA,YAAIiL,wBAAwB,EAA5B;;AAEAja,UAAEc,IAAF,CAAOkO,IAAP,EAAa,UAAUhO,GAAV,EAAeC,KAAf,EAAsB;AAC/BgZ,kCAAsBjK,IAAtB,CAA2B;AACvBnW,oBAAImH,GADmB;AAEvBI,sBAAMH,MAAMvE;AAFW,aAA3B;AAIH,SALD;;AAOAxE,yBAAiB6G,sBAAjB;;AAEA,YAAI1D,MAAMC,GAAN,CAAU,qBAAV,CAAJ,EAAsC;AAClCuZ;AACH;;AAED,YAAIxZ,MAAMC,GAAN,CAAU,qBAAV,CAAJ,EAAsC;AAClC,gBAAIS,WAAWV,MAAMC,GAAN,CAAU,6BAAV,CAAf;AACA,gBAAIN,MAAM,SAASe,QAAT,GAAoBA,SAASf,GAA7B,GAAmCC,SAA7C;AACA,gBAAIC,MAAM,SAASa,QAAT,GAAoBA,SAASb,GAA7B,GAAmCC,SAA7C;;AAEA,gBAAIoa,SAAS,IAAI5a,OAAOC,IAAP,CAAYgM,MAAhB,CAAuB5L,GAAvB,EAA4BE,GAA5B,CAAb;AACAhD,2BAAeud,WAAf,CAA2BF,MAA3B;AACAvd,gBAAI0d,SAAJ,CAAcH,MAAd;AACH;;AAED1e,kCAA0B4iB,OAA1B,CAAkC;AAC9BC,yBAAa,wBADiB;AAE9B1K,kBAAMiL,qBAFwB;AAG9BN,qCAAyBC;AAHK,SAAlC;;AAMA/iB,kCAA0BgjB,EAA1B,CAA6B,QAA7B,EAAuC,UAAUpI,CAAV,EAAa;AAChDpW,kBAAMuB,GAAN,CAAU,qBAAV,EAAiC,KAAKqE,KAAtC;AACArC,iCAAqB,KAAKqC,KAA1B;AACH,SAHD;;AAKApK,kCAA0BiD,GAA1B,CAA8BuB,MAAMC,GAAN,CAAU,qBAAV,CAA9B,EAAgEtB,OAAhE,CAAwE,QAAxE;AACH,KAvCD;;AAyCApD,4BAAwBoJ,EAAE,mBAAF,CAAxB;;AAEApJ,0BAAsB6iB,OAAtB,CAA8B;AAC1BC,qBAAa,cADa;AAE1BC,iCAAyBC;AAFC,KAA9B;;AAKAhjB,0BAAsBijB,EAAtB,CAAyB,QAAzB,EAAmC,UAAUpI,CAAV,EAAa;AAC5CpW,cAAMuB,GAAN,CAAU,gBAAV,EAA4B,KAAKqE,KAAjC;AACAmK;AACH,KAHD;;AAKAxU,0BAAsBkD,GAAtB,CAA0BuB,MAAMC,GAAN,CAAU,gBAAV,CAA1B,EAAuDtB,OAAvD,CAA+D,QAA/D;AACH,CAnND;;AAqNAgG,EAAE,YAAY;AACV,aAASka,WAAT,CAAqBC,KAArB,EAA4B;AACxB,YAAI,CAACA,MAAMtgB,EAAX,EAAe;AACX,mBAAOsgB,MAAM/Y,IAAb;AACH;AACD,YAAIgZ,SAASpa,EAAE,qCAAqCma,MAAMhI,OAAN,CAAclR,KAAd,CAAoB0K,QAApB,EAArC,GAAsE,SAAtE,GAAkFwO,MAAM/Y,IAAxF,GAA+F,SAAjG,CAAb;AACA,eAAOgZ,MAAP;AACH;;AAEDpa,MAAEuZ,OAAF,CAAU,iCAAV,EAA6CnI,IAA7C,CAAkD,UAAUpC,IAAV,EAAgB;AAC9D1W,gBAAQ0W,IAAR;AACH,KAFD;;AAIAjZ,qBAAiBiK,EAAE,kBAAF,CAAjB;AACAhK,2BAAuBgK,EAAE,iBAAF,CAAvB;AACA/J,0BAAsB+J,EAAE,gBAAF,CAAtB;AACA9J,4BAAwB8J,EAAE,oBAAF,CAAxB;AACA,QAAIqa,kBAAkB,GAAtB;;AAEA;AACAra,MAAEuZ,OAAF,CAAU,mCAAV,EAA+CnI,IAA/C,CAAoD,UAAUpC,IAAV,EAAgB;AAChE,YAAIsL,WAAW,EAAf;;AAEAta,UAAEc,IAAF,CAAOkO,IAAP,EAAa,UAAUhO,GAAV,EAAeC,KAAf,EAAsB;AAC/B,gBAAID,MAAMqZ,eAAV,EAA2B;AACvB,uBAAO,KAAP;AACH;AACD,gBAAIE,SAAS,EAAb;AACAD,qBAAStK,IAAT,CAAc;AACVnW,oBAAImH,GADM;AAEVI,sBAAM6B,KAAKhC,MAAM,MAAN,CAAL,IAAsB,MAAtB,GAA+BD;AAF3B,aAAd;AAIAC,kBAAM,MAAN,IAAgBgC,KAAKhC,MAAM,MAAN,CAAL,CAAhB;AACAA,kBAAM,QAAN,IAAkBgC,KAAKhC,MAAM,QAAN,CAAL,CAAlB;AACAjB,cAAEc,IAAF,CAAOG,MAAM,OAAN,CAAP,EAAuB,UAAUD,GAAV,EAAewZ,WAAf,EAA4B;AAC/CD,uBAAOvK,IAAP,CAAY;AACR,4BAAQ/M,KAAKuX,YAAY,MAAZ,CAAL,CADA;AAER,6BAASA,YAAY,OAAZ;AAFD,iBAAZ;AAIH,aALD;AAMAvZ,kBAAM,OAAN,IAAiBsZ,MAAjB;AACApjB,wBAAY6J,GAAZ,IAAmBC,KAAnB;AACH,SAnBD;;AAqBA;AACAlL,uBAAe0jB,OAAf,CAAuB;AACnBC,yBAAazW,KAAK,gBAAL,CADM;AAEnB+L,kBAAMsL,QAFa;AAGnBG,4BAAgBP;AAHG,SAAvB;AAKAlkB,6BAAqByjB,OAArB,CAA6B;AACzBC,yBAAazW,KAAK,gBAAL,CADY;AAEzB+L,kBAAMsL,QAFmB;AAGzBG,4BAAgBP;AAHS,SAA7B;AAKAjkB,4BAAoBwjB,OAApB,CAA4B;AACxBC,yBAAazW,KAAK,eAAL,CADW;AAExB+L,kBAAM,CAAC/L,KAAK,QAAL,CAAD,EAAiBA,KAAK,UAAL,CAAjB,EAAmCA,KAAK,MAAL,CAAnC,EAAiDA,KAAK,WAAL,CAAjD,EAAoEA,KAAK,YAAL,CAApE,CAFkB;AAGxBwX,4BAAgBP;AAHQ,SAA5B;;AAMA;AACAnkB,uBAAe8jB,EAAf,CAAkB,QAAlB,EAA4B,UAAUpI,CAAV,EAAa;AACrC5Z,qBAASJ,eAAT;AACAA,8BAAkB1B,eAAe+D,GAAf,GAAqB9B,GAArB,CAAyB0iB,MAAzB,CAAlB;AACA7iB,qBAASA,OAAO2Z,MAAP,CAAc,UAAUC,CAAV,EAAa;AAChC,uBAAO,KAAK/H,OAAL,CAAa+H,CAAb,IAAkB,CAAzB;AACH,aAFQ,EAENha,eAFM,CAAT;AAGAK,gCAAoBA,kBAAkBiC,MAAlB,CAAyBlC,MAAzB,CAApB;AACAoV;AACA5R,kBAAMuB,GAAN,CAAU,yBAAV,EAAqCnF,eAArC;AACH,SATD;AAUAzB,6BAAqB6jB,EAArB,CAAwB,QAAxB,EAAkC,UAAUpI,CAAV,EAAa;AAC3C/Z,8BAAkB1B,qBAAqB8D,GAArB,GAA2B9B,GAA3B,CAA+B0iB,MAA/B,CAAlB;AACArf,kBAAMuB,GAAN,CAAU,wBAAV,EAAoClF,eAApC;AACH,SAHD;AAIAzB,4BAAoB4jB,EAApB,CAAuB,QAAvB,EAAiC,UAAUpI,CAAV,EAAa;AAC1C9Z,6BAAiB1B,oBAAoB6D,GAApB,GAA0B9B,GAA1B,CAA8BiQ,MAA9B,CAAjB;AACA5M,kBAAMuB,GAAN,CAAU,+BAAV,EAA2CjF,cAA3C;AACH,SAHD;AAIAzB,8BAAsB2jB,EAAtB,CAAyB,QAAzB,EAAmC,UAAUpI,CAAV,EAAa;AAC5C7Z,oCAAwBya,SAASnc,sBAAsB4D,GAAtB,EAAT,EAAsC,EAAtC,CAAxB;AACA,gBAAI6gB,MAAM/iB,qBAAN,KAAgCA,yBAAyB,CAA7D,EAAgE;AAC5DA,wCAAwB,EAAxB;AACH;AACD,gBAAIA,wBAAwB,GAA5B,EAAiC;AAC7BA,wCAAwB,GAAxB;AACH;AACD1B,kCAAsB4D,GAAtB,CAA0BlC,qBAA1B;AACAyD,kBAAMuB,GAAN,CAAU,iCAAV,EAA6ChF,qBAA7C;AACH,SAVD;;AAYA;AACA7B,uBAAe+D,GAAf,CAAmBuB,MAAMC,GAAN,CAAU,yBAAV,CAAnB,EAAyDtB,OAAzD,CAAiE,QAAjE;AACAhE,6BAAqB8D,GAArB,CAAyBuB,MAAMC,GAAN,CAAU,wBAAV,CAAzB,EAA8DtB,OAA9D,CAAsE,QAAtE;AACA/D,4BAAoB6D,GAApB,CAAwBuB,MAAMC,GAAN,CAAU,+BAAV,CAAxB,EAAoEtB,OAApE,CAA4E,QAA5E;AACA9D,8BAAsB4D,GAAtB,CAA0BuB,MAAMC,GAAN,CAAU,iCAAV,CAA1B,EAAwEtB,OAAxE,CAAgF,QAAhF;;AAEA,YAAI8Q,mBAAmBD,gBAAvB,EAAyC;AACrC7K,cAAE,uBAAF,EAA2BC,IAA3B,CAAgC,UAAhC,EAA4C,IAA5C;AACH;AACJ,KAjFD;;AAmFA;AACA2B,WAAOuT,WAAP,CAAmBnK,mBAAnB,EAAwC,IAAxC;AACApJ,WAAOuT,WAAP,CAAmB7W,SAAnB,EAA8B,IAA9B;AACAsD,WAAOuT,WAAP,CAAmBmB,iBAAnB,EAAsC,IAAtC;;AAEAE;;AAEA;AACA,aAASoE,yBAAT,CAAmC5L,IAAnC,EAAyCC,QAAzC,EAAmD4L,UAAnD,EAA+D;AAC3D,eAAO,YAAY;AACfxf,kBAAMuB,GAAN,CAAUie,UAAV,EAAsB,KAAKf,OAA3B;AACA,gBAAI,KAAKA,OAAT,EAAkB;AACd;AACA;AACA,oBAAIe,eAAe,aAAnB,EAAkC;AAC9BhiB,kCAAc,KAAd;AACH,iBAFD,MAEO,IAAIgiB,eAAe,UAAnB,EAA+B;AAClCjiB,+BAAW,KAAX;AACH,iBAFM,MAEA,IAAIiiB,eAAe,eAAnB,EAAoC;AACvCliB,oCAAgB,KAAhB;AACH,iBAFM,MAEA,IAAIkiB,eAAe,aAAnB,EAAkC;AACrC/hB,gCAAY,KAAZ;AACH,iBAFM,MAEA,IAAI+hB,eAAe,iBAAnB,EAAsC;AACzC9hB,iCAAa,KAAb;AACH;AACDuF;AACH,aAfD,MAeO;AACH0B,kBAAEc,IAAF,CAAOmO,QAAP,EAAiB,UAAU8K,CAAV,EAAaC,KAAb,EAAoB;AACjCha,sBAAEc,IAAF,CAAOkO,KAAKgL,KAAL,CAAP,EAAoB,UAAUhZ,GAAV,EAAeC,KAAf,EAAsB;AACtC;AACA,4BAAI+N,KAAKgL,KAAL,EAAYhZ,GAAZ,EAAiB1G,MAAjB,CAAwBC,WAA5B,EAAyC;AACrCyU,iCAAKgL,KAAL,EAAYhZ,GAAZ,EAAiB1G,MAAjB,CAAwBC,WAAxB,CAAoCC,MAApC,CAA2C,IAA3C;AACA,mCAAOwU,KAAKgL,KAAL,EAAYhZ,GAAZ,EAAiB1G,MAAjB,CAAwBC,WAA/B;AACH;AACD,4BAAIsgB,eAAe,YAAnB,EAAiC7L,KAAKgL,KAAL,EAAYhZ,GAAZ,EAAiB1G,MAAjB,CAAwBE,MAAxB,CAA+B,IAA/B;AACpC,qBAPD;AAQA,wBAAIqgB,eAAe,YAAnB,EAAiC7L,KAAKgL,KAAL,IAAc,EAAd;AACpC,iBAVD;AAWA,oBAAIa,eAAe,YAAnB,EAAiC;AAC7Bvc;AACH;AACJ;AACJ,SAjCD;AAkCH;;AAED;AACA0B,MAAE,cAAF,EAAkB8a,MAAlB,CAAyB,YAAY;AACjC,YAAIxL,UAAU;AACV,wBAAY;AADF,SAAd;AAGA,YAAIyL,UAAU/a,EAAE,sBAAF,CAAd;AACA,YAAI,KAAK8Z,OAAT,EAAkB;AACdlhB,uBAAW,KAAX;AACAmiB,oBAAQzN,IAAR,CAAagC,OAAb;AACH,SAHD,MAGO;AACH1W,uBAAW,KAAX;AACAmiB,oBAAQC,IAAR,CAAa1L,OAAb;AACH;AACD,YAAI2L,WAAWjb,EAAE,sBAAF,CAAf;AACA,YAAI,KAAK8Z,OAAT,EAAkB;AACdlhB,uBAAW,KAAX;AACAqiB,qBAAS3N,IAAT,CAAcgC,OAAd;AACH,SAHD,MAGO;AACH1W,uBAAW,KAAX;AACAqiB,qBAASD,IAAT,CAAc1L,OAAd;AACH;AACDsL,kCAA0BxgB,OAA1B,EAAmC,CAAC,MAAD,CAAnC,EAA6C,UAA7C,EAAyD8gB,IAAzD,CAA8D,IAA9D;AACH,KArBD;AAsBAlb,MAAE,iBAAF,EAAqB8a,MAArB,CAA4B,YAAY;AACpCF,kCAA0BxgB,OAA1B,EAAmC,CAAC,UAAD,CAAnC,EAAiD,aAAjD,EAAgE8gB,IAAhE,CAAqE,IAArE;AACH,KAFD;AAGAlb,MAAE,iBAAF,EAAqB8a,MAArB,CAA4B,YAAY;AACpCF,kCAA0BxgB,OAA1B,EAAmC,CAAC,SAAD,CAAnC,EAAgD,aAAhD,EAA+D8gB,IAA/D,CAAoE,IAApE;AACH,KAFD;AAGAlb,MAAE,qBAAF,EAAyB8a,MAAzB,CAAgC,YAAY;AACxCF,kCAA0BxgB,OAA1B,EAAmC,CAAC,aAAD,CAAnC,EAAoD,iBAApD,EAAuE8gB,IAAvE,CAA4E,IAA5E;AACH,KAFD;AAGAlb,MAAE,gBAAF,EAAoB8a,MAApB,CAA2BF,0BAA0BxgB,OAA1B,EAAmC,CAAC,MAAD,EAAS,UAAT,EAAqB,WAArB,CAAnC,EAAsE,YAAtE,CAA3B;;AAEA4F,MAAE,mBAAF,EAAuB8a,MAAvB,CAA8B,YAAY;AACtC,YAAIxL,UAAU;AACV,wBAAY;AADF,SAAd;AAGA,YAAIyL,UAAU/a,EAAE,+BAAF,CAAd;AACA,YAAI,KAAK8Z,OAAT,EAAkB;AACdnhB,4BAAgB,KAAhB;AACAoiB,oBAAQzN,IAAR,CAAagC,OAAb;AACH,SAHD,MAGO;AACH3W,4BAAgB,KAAhB;AACAoiB,oBAAQC,IAAR,CAAa1L,OAAb;AACH;AACD,eAAOsL,0BAA0BxgB,OAA1B,EAAmC,CAAC,WAAD,CAAnC,EAAkD,eAAlD,EAAmE8gB,IAAnE,CAAwE,IAAxE,GAAP;AACH,KAbD;;AAeAlb,MAAE,eAAF,EAAmB8a,MAAnB,CAA0B,YAAY;AAClCzf,cAAMuB,GAAN,CAAU,WAAV,EAAuB,KAAKkd,OAA5B;AACH,KAFD;;AAIA9Z,MAAE,gCAAF,EAAoC8a,MAApC,CAA2C,YAAY;AACnDzf,cAAMuB,GAAN,CAAU,qBAAV,EAAiC,KAAKkd,OAAtC;AACA,YAAI,KAAKA,OAAL,KAAiB,IAAjB,IAAyBze,MAAMC,GAAN,CAAU,qBAAV,MAAqC,IAAlE,EAAwE;AACpED,kBAAMuB,GAAN,CAAU,qBAAV,EAAiC,KAAjC;AACAoD,cAAE,gCAAF,EAAoCC,IAApC,CAAyC,SAAzC,EAAoD,KAApD;AACH;AACJ,KAND;;AAQAD,MAAE,gCAAF,EAAoC8a,MAApC,CAA2C,YAAY;AACnDzf,cAAMuB,GAAN,CAAU,qBAAV,EAAiC,KAAKkd,OAAtC;AACA,YAAI,KAAKA,OAAL,KAAiB,IAAjB,IAAyBze,MAAMC,GAAN,CAAU,qBAAV,MAAqC,IAAlE,EAAwE;AACpED,kBAAMuB,GAAN,CAAU,qBAAV,EAAiC,KAAjC;AACAoD,cAAE,gCAAF,EAAoCC,IAApC,CAAyC,SAAzC,EAAoD,KAApD;AACH;AACJ,KAND;;AAQAD,MAAE,4BAAF,EAAgC8a,MAAhC,CAAuC,YAAY;AAC/C,YAAI,CAAC1F,UAAUC,WAAf,EAA4B;AACxB,iBAAKyE,OAAL,GAAe,KAAf;AACH,SAFD,MAEO;AACHze,kBAAMuB,GAAN,CAAU,kBAAV,EAA8B,KAAKkd,OAAnC;AACH;AACD5hB,uBAAeijB,YAAf,CAA4B,CAAC,KAAKrB,OAAlC;AACH,KAPD;;AASA,QAAI9Z,EAAE,gBAAF,EAAoB0E,MAAxB,EAAgC;AAC5B1E,UAAE,gBAAF,EAAoBob,SAApB,CAA8B;AAC1BC,oBAAQ,CADkB;AAE1BC,yBAAa,IAFa;AAG1BC,yBAAa;AAHa,SAA9B;AAKH;;AAED;AACA;AACA;;AAEAvb,MAAE,oBAAF,EAAwBwb,SAAxB,CAAkC;AAC9BC,gBAAQ,KADsB;AAE9BC,mBAAW,KAFmB;AAG9BC,cAAM,KAHwB;AAI9BC,iBAAS,OAJqB;AAK9B,oBAAY;AACR,0BAAc;AADN,SALkB;AAQ9B,mBAAW,CAAC,EAAC,aAAa,KAAd,EAAD,EAAuB,IAAvB,EAA6B,IAA7B,EAAmC,IAAnC;AARmB,KAAlC,EASGC,KATH,CASS,CAAC,CAAD,EAAI,KAAJ,CATT;AAUH,CAxPD","file":"map.built.js","sourcesContent":["//\r\n// Global map.js variables\r\n//\r\n\r\nvar $selectExclude\r\nvar $selectPokemonNotify\r\nvar $selectRarityNotify\r\nvar $textPerfectionNotify\r\nvar $selectStyle\r\nvar $selectIconResolution\r\nvar $selectIconSize\r\nvar $selectOpenGymsOnly\r\nvar $selectTeamGymsOnly\r\nvar $selectLastUpdateGymsOnly\r\nvar $selectMinGymLevel\r\nvar $selectMaxGymLevel\r\nvar $selectLuredPokestopsOnly\r\nvar $selectGymMarkerStyle\r\nvar $selectLocationIconMarker\r\nvar $switchGymSidebar\r\n\r\nvar language = document.documentElement.lang === '' ? 'en' : document.documentElement.lang\r\nvar idToPokemon = {}\r\nvar i8lnDictionary = {}\r\nvar languageLookups = 0\r\nvar languageLookupThreshold = 3\r\n\r\nvar searchMarkerStyles\r\n\r\nvar timestamp\r\nvar excludedPokemon = []\r\nvar notifiedPokemon = []\r\nvar notifiedRarity = []\r\nvar notifiedMinPerfection = null\r\n\r\nvar buffer = []\r\nvar reincludedPokemon = []\r\nvar reids = []\r\n\r\nvar map\r\nvar rawDataIsLoading = false\r\nvar locationMarker\r\nvar rangeMarkers = ['pokemon', 'pokestop', 'gym']\r\nvar storeZoom = true\r\nvar scanPath\r\nvar moves\r\n\r\nvar oSwLat\r\nvar oSwLng\r\nvar oNeLat\r\nvar oNeLng\r\n\r\nvar lastpokestops\r\nvar lastgyms\r\nvar lastpokemon\r\nvar lastslocs\r\nvar lastspawns\r\n\r\nvar selectedStyle = 'light'\r\n\r\nvar updateWorker\r\nvar lastUpdateTime\r\n\r\nvar gymTypes = ['Uncontested', 'Mystic', 'Valor', 'Instinct']\r\nvar gymPrestige = [2000, 4000, 8000, 12000, 16000, 20000, 30000, 40000, 50000]\r\nvar audio = new Audio('static/sounds/ding.mp3')\r\n\r\nvar genderType = ['', '', '']\r\nvar unownForm = ['unset', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '!', '?']\r\n\r\n/*\r\n text place holders:\r\n <pkm> - pokemon name\r\n <prc> - iv in percent without percent symbol\r\n <atk> - attack as number\r\n <def> - defense as number\r\n <sta> - stamnia as number\r\n */\r\nvar notifyIvTitle = '<pkm> <prc>% (<atk>/<def>/<sta>)'\r\nvar notifyNoIvTitle = '<pkm>'\r\n\r\n/*\r\n text place holders:\r\n <dist>  - disappear time\r\n <udist> - time until disappear\r\n */\r\nvar notifyText = 'disappears at <dist> (<udist>)'\r\n\r\n//\r\n// Functions\r\n//\r\n\r\nfunction excludePokemon(id) { // eslint-disable-line no-unused-vars\r\n    $selectExclude.val(\r\n        $selectExclude.val().concat(id)\r\n    ).trigger('change')\r\n}\r\n\r\nfunction notifyAboutPokemon(id) { // eslint-disable-line no-unused-vars\r\n    $selectPokemonNotify.val(\r\n        $selectPokemonNotify.val().concat(id)\r\n    ).trigger('change')\r\n}\r\n\r\nfunction removePokemonMarker(encounterId) { // eslint-disable-line no-unused-vars\r\n    if (mapData.pokemons[encounterId].marker.rangeCircle) {\r\n        mapData.pokemons[encounterId].marker.rangeCircle.setMap(null)\r\n        delete mapData.pokemons[encounterId].marker.rangeCircle\r\n    }\r\n    mapData.pokemons[encounterId].marker.setMap(null)\r\n    mapData.pokemons[encounterId].hidden = true\r\n}\r\n\r\nfunction initMap() { // eslint-disable-line no-unused-vars\r\n    map = new google.maps.Map(document.getElementById('map'), {\r\n        center: {\r\n            lat: centerLat,\r\n            lng: centerLng\r\n        },\r\n        zoom: zoom == null ? Store.get('zoomLevel') : zoom,\r\n        fullscreenControl: true,\r\n        streetViewControl: false,\r\n        mapTypeControl: false,\r\n        clickableIcons: false,\r\n        mapTypeControlOptions: {\r\n            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,\r\n            position: google.maps.ControlPosition.RIGHT_TOP,\r\n            mapTypeIds: [\r\n                google.maps.MapTypeId.ROADMAP,\r\n                google.maps.MapTypeId.SATELLITE,\r\n                google.maps.MapTypeId.HYBRID,\r\n                'nolabels_style',\r\n                'dark_style',\r\n                'style_light2',\r\n                'style_pgo',\r\n                'dark_style_nl',\r\n                'style_light2_nl',\r\n                'style_pgo_nl',\r\n                'style_pgo_day',\r\n                'style_pgo_night',\r\n                'style_pgo_dynamic'\r\n            ]\r\n        }\r\n    })\r\n\r\n    var styleNoLabels = new google.maps.StyledMapType(noLabelsStyle, {\r\n        name: 'No Labels'\r\n    })\r\n    map.mapTypes.set('nolabels_style', styleNoLabels)\r\n\r\n    var styleDark = new google.maps.StyledMapType(darkStyle, {\r\n        name: 'Dark'\r\n    })\r\n    map.mapTypes.set('dark_style', styleDark)\r\n\r\n    var styleLight2 = new google.maps.StyledMapType(light2Style, {\r\n        name: 'Light2'\r\n    })\r\n    map.mapTypes.set('style_light2', styleLight2)\r\n\r\n    var stylePgo = new google.maps.StyledMapType(pGoStyle, {\r\n        name: 'PokemonGo'\r\n    })\r\n    map.mapTypes.set('style_pgo', stylePgo)\r\n\r\n    var styleDarkNl = new google.maps.StyledMapType(darkStyleNoLabels, {\r\n        name: 'Dark (No Labels)'\r\n    })\r\n    map.mapTypes.set('dark_style_nl', styleDarkNl)\r\n\r\n    var styleLight2Nl = new google.maps.StyledMapType(light2StyleNoLabels, {\r\n        name: 'Light2 (No Labels)'\r\n    })\r\n    map.mapTypes.set('style_light2_nl', styleLight2Nl)\r\n\r\n    var stylePgoNl = new google.maps.StyledMapType(pGoStyleNoLabels, {\r\n        name: 'PokemonGo (No Labels)'\r\n    })\r\n    map.mapTypes.set('style_pgo_nl', stylePgoNl)\r\n\r\n    var stylePgoDay = new google.maps.StyledMapType(pGoStyleDay, {\r\n        name: 'PokemonGo Day'\r\n    })\r\n    map.mapTypes.set('style_pgo_day', stylePgoDay)\r\n\r\n    var stylePgoNight = new google.maps.StyledMapType(pGoStyleNight, {\r\n        name: 'PokemonGo Night'\r\n    })\r\n    map.mapTypes.set('style_pgo_night', stylePgoNight)\r\n\r\n    // dynamic map style chooses stylePgoDay or stylePgoNight depending on client time\r\n    var currentDate = new Date()\r\n    var currentHour = currentDate.getHours()\r\n    var stylePgoDynamic = currentHour >= 6 && currentHour < 19 ? stylePgoDay : stylePgoNight\r\n    map.mapTypes.set('style_pgo_dynamic', stylePgoDynamic)\r\n\r\n    map.addListener('maptypeid_changed', function (s) {\r\n        Store.set('map_style', this.mapTypeId)\r\n    })\r\n\r\n    map.setMapTypeId(Store.get('map_style'))\r\n    map.addListener('idle', updateMap)\r\n\r\n    map.addListener('zoom_changed', function () {\r\n        if (storeZoom === true) {\r\n            Store.set('zoomLevel', this.getZoom())\r\n        } else {\r\n            storeZoom = true\r\n        }\r\n\r\n        redrawPokemon(mapData.pokemons)\r\n        redrawPokemon(mapData.lurePokemons)\r\n    })\r\n\r\n    createMyLocationButton()\r\n    initSidebar()\r\n}\r\n\r\nfunction updateLocationMarker(style) {\r\n    if (style in searchMarkerStyles) {\r\n        locationMarker.setIcon(searchMarkerStyles[style].icon)\r\n        Store.set('locationMarkerStyle', style)\r\n    }\r\n    return locationMarker\r\n}\r\n\r\nfunction createLocationMarker() {\r\n    var position = Store.get('followMyLocationPosition')\r\n    var lat = 'lat' in position ? position.lat : centerLat\r\n    var lng = 'lng' in position ? position.lng : centerLng\r\n\r\n    var locationMarker = new google.maps.Marker({\r\n        map: map,\r\n        animation: google.maps.Animation.DROP,\r\n        position: {\r\n            lat: lat,\r\n            lng: lng\r\n        },\r\n        draggable: false,\r\n        icon: null,\r\n        optimized: false,\r\n        zIndex: google.maps.Marker.MAX_ZINDEX + 2\r\n    })\r\n\r\n    locationMarker.setIcon(searchMarkerStyles[Store.get('locationMarkerStyle')].icon)\r\n\r\n    locationMarker.infoWindow = new google.maps.InfoWindow({\r\n        content: '<div><b>My Location</b></div>',\r\n        disableAutoPan: true\r\n    })\r\n\r\n    addListeners(locationMarker)\r\n\r\n    google.maps.event.addListener(locationMarker, 'dragend', function () {\r\n        var newLocation = locationMarker.getPosition()\r\n        Store.set('followMyLocationPosition', {\r\n            lat: newLocation.lat(),\r\n            lng: newLocation.lng()\r\n        })\r\n    })\r\n\r\n    return locationMarker\r\n}\r\n\r\nfunction initSidebar() {\r\n    $('#gyms-switch').prop('checked', Store.get('showGyms'))\r\n    $('#gym-sidebar-switch').prop('checked', Store.get('useGymSidebar'))\r\n    $('#gym-sidebar-wrapper').toggle(Store.get('showGyms'))\r\n    $('#gyms-filter-wrapper').toggle(Store.get('showGyms'))\r\n    $('#team-gyms-only-switch').val(Store.get('showTeamGymsOnly'))\r\n    $('#open-gyms-only-switch').val(Store.get('showOpenGymsOnly'))\r\n    $('#min-level-gyms-filter-switch').val(Store.get('minGymLevel'))\r\n    $('#max-level-gyms-filter-switch').val(Store.get('maxGymLevel'))\r\n    $('#last-update-gyms-switch').val(Store.get('showLastUpdatedGymsOnly'))\r\n    $('#pokemon-switch').prop('checked', Store.get('showPokemon'))\r\n    $('#pokestops-switch').prop('checked', Store.get('showPokestops'))\r\n    $('#lured-pokestops-only-switch').val(Store.get('showLuredPokestopsOnly'))\r\n    $('#lured-pokestops-only-wrapper').toggle(Store.get('showPokestops'))\r\n    $('#start-at-user-location-switch').prop('checked', Store.get('startAtUserLocation'))\r\n    $('#start-at-last-location-switch').prop('checked', Store.get('startAtLastLocation'))\r\n    $('#follow-my-location-switch').prop('checked', Store.get('followMyLocation'))\r\n    $('#scanned-switch').prop('checked', Store.get('showScanned'))\r\n    $('#spawnpoints-switch').prop('checked', Store.get('showSpawnpoints'))\r\n    $('#ranges-switch').prop('checked', Store.get('showRanges'))\r\n    $('#sound-switch').prop('checked', Store.get('playSound'))\r\n    if (document.getElementById('next-location')) {\r\n        var searchBox = new google.maps.places.Autocomplete(document.getElementById('next-location'))\r\n        $('#next-location').css('background-color', $('#geoloc-switch').prop('checked') ? '#e0e0e0' : '#ffffff')\r\n\r\n        searchBox.addListener('place_changed', function () {\r\n            var place = searchBox.getPlace()\r\n\r\n            if (!place.geometry) return\r\n\r\n            var loc = place.geometry.location\r\n            changeLocation(loc.lat(), loc.lng())\r\n        })\r\n    }\r\n\r\n    var icons = $('#pokemon-icons')\r\n    $.each(pokemonSprites, function (key, value) {\r\n        icons.append($('<option></option>').attr('value', key).text(value.name))\r\n    })\r\n    icons.val(pokemonSprites[Store.get('pokemonIcons')] ? Store.get('pokemonIcons') : 'highres')\r\n\r\n    $('#pokemon-icon-size').val(Store.get('iconSizeModifier'))\r\n}\r\n\r\nfunction pad(number) {\r\n    return number <= 99 ? ('0' + number).slice(-2) : number\r\n}\r\n\r\nfunction getTypeSpan(type) {\r\n    return '<span style=\\'padding: 2px 5px text-transform: uppercase color: white margin-right: 2px border-radius: 4px font-size: 0.8em vertical-align: text-bottom background-color: ' + type['color'] + '\\'>' + type['type'] + '</span>'\r\n}\r\n\r\nfunction openMapDirections(lat, lng) { // eslint-disable-line no-unused-vars\r\n    var url = 'https://www.google.com/maps/?daddr=' + lat + ',' + lng\r\n    window.open(url, '_blank')\r\n}\r\n\r\n// Converts timestamp to readable String\r\nfunction getDateStr(t) {\r\n    var dateStr = 'Unknown'\r\n    if (t) {\r\n        dateStr = moment(t).format('DD-MM-YYYY, HH:mm:ss')\r\n    }\r\n    return dateStr\r\n}\r\n\r\nfunction pokemonLabel(item) {\r\n    var name = item['pokemon_name']\r\n    var rarityDisplay = item['pokemon_rarity'] ? '(' + item['pokemon_rarity'] + ')' : ''\r\n    var types = item['pokemon_types']\r\n    var typesDisplay = ''\r\n    var encounterId = item['encounter_id']\r\n    var id = item['pokemon_id']\r\n    var latitude = item['latitude']\r\n    var longitude = item['longitude']\r\n    var disappearTime = item['disappear_time']\r\n    var disappearDate = new Date(disappearTime)\r\n    var atk = item['individual_attack']\r\n    var def = item['individual_defense']\r\n    var sta = item['individual_stamina']\r\n    var pMove1 = moves[item['move_1']] !== undefined ? i8ln(moves[item['move_1']]['name']) : 'gen/unknown'\r\n    var pMove2 = moves[item['move_2']] !== undefined ? i8ln(moves[item['move_2']]['name']) : 'gen/unknown'\r\n    var weight = item['weight']\r\n    var height = item['height']\r\n    var gender = item['gender']\r\n    var form = item['form']\r\n    var cp = item['cp']\r\n    var cpMultiplier = item['cp_multiplier']\r\n    var level = item['level']\r\n\r\n    $.each(types, function (index, type) {\r\n        typesDisplay += getTypeSpan(type)\r\n    })\r\n\r\n    var details = ''\r\n    if (atk != null && def != null && sta != null) {\r\n        var iv = getIv(atk, def, sta)\r\n        details =\r\n            '<div>' +\r\n            'IV: ' + iv.toFixed(1) + '% (' + atk + '/' + def + '/' + sta + ')' +\r\n            '</div>'\r\n\r\n        if (cp != null && (cpMultiplier != null || level != null)) {\r\n            var pokemonLevel\r\n            if (level != null) {\r\n                pokemonLevel = level\r\n            } else {\r\n                pokemonLevel = getPokemonLevel(cpMultiplier)\r\n            }\r\n            details +=\r\n                '<div>' +\r\n                'CP: ' + cp + ' | Level: ' + pokemonLevel +\r\n                '</div>'\r\n        }\r\n\r\n        details +=\r\n            '<div>' +\r\n            'Moves: ' + pMove1 + ' / ' + pMove2 +\r\n            '</div>'\r\n    }\r\n    if (gender != null) {\r\n        details +=\r\n            '<div>' +\r\n            'Gender: ' + genderType[gender - 1]\r\n        if (weight != null && height != null) {\r\n            details += ' | Weight: ' + weight.toFixed(2) + 'kg | Height: ' + height.toFixed(2) + 'm'\r\n        }\r\n        details +=\r\n            '</div>'\r\n    }\r\n    var contentstring =\r\n        '<div>' +\r\n        '<b>' + name + '</b>'\r\n    if (id === 201 && form !== null && form > 0) {\r\n        contentstring += ' (' + unownForm[item['form']] + ')'\r\n    }\r\n    contentstring += '<span> - </span>' +\r\n        '<small>' +\r\n        '<a href=\"https://pokemon.gameinfo.io/en/pokemon/' + id + '\" target=\"_blank\" title=\"View in Pokedex\">#' + id + '</a>' +\r\n        '</small>' +\r\n        '<span> ' + rarityDisplay + '</span>' +\r\n        '<span> - </span>' +\r\n        '<small>' + typesDisplay + '</small>' +\r\n        '</div>' +\r\n        '<div>' +\r\n        'Disappears at ' + pad(disappearDate.getHours()) + ':' + pad(disappearDate.getMinutes()) + ':' + pad(disappearDate.getSeconds()) +\r\n        '<span class=\"label-countdown\" disappears-at=\"' + disappearTime + '\">(00m00s)</span>' +\r\n        '</div>' +\r\n        '<div>' +\r\n        'Location: ' + latitude.toFixed(6) + ', ' + longitude.toFixed(7) +\r\n        '</div>' +\r\n        details +\r\n        '<div>' +\r\n        '<a href=\"javascript:excludePokemon(' + id + ')\">Exclude</a>&nbsp&nbsp' +\r\n        '<a href=\"javascript:notifyAboutPokemon(' + id + ')\">Notify</a>&nbsp&nbsp' +\r\n        '<a href=\"javascript:removePokemonMarker\\'\"' + encounterId + '\\')\">Remove</a>&nbsp&nbsp' +\r\n        '<a href=\"javascript:void(0)\" onclick=\"javascript:openMapDirections(' + latitude + ', ' + longitude + ')\" title=\"View in Maps\">Get directions</a>' +\r\n        '</div>'\r\n    return contentstring\r\n}\r\n\r\nfunction gymLabel(teamName, teamId, gymPoints, latitude, longitude) {\r\n    var lastScanned = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : null\r\n    var lastModified = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : null\r\n    var name = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : null\r\n    var members = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : []\r\n    // var gymId = arguments[9]\r\n    var guardPokemon = arguments[10]\r\n\r\n    var memberStr = ''\r\n    if (members.length > 0) {\r\n        for (var i = 0; i < members.length; i++) {\r\n            memberStr +=\r\n                '<span class=\"gym-member\" title=\"' + members[i].pokemon_name + ' | ' + members[i].trainer_name + ' (Lvl ' + members[i].trainer_level + '\">' +\r\n                '<i class=\"pokemon-sprite n' + members[i].pokemon_id + '\"></i>' +\r\n                '<span class=\"cp team-' + teamId + '\">' + members[i].pokemon_cp + '</span>' +\r\n                '</span>'\r\n        }\r\n    } else {\r\n        memberStr =\r\n            '<span class=\"gym-member\">' +\r\n            '<i class=\"pokemon-sprite n' + guardPokemon + '\"></i>' +\r\n            '</span>'\r\n    }\r\n\r\n    var lastModifiedStr = getDateStr(lastModified)\r\n    var lastScannedStr = ''\r\n    if (lastScanned != null) {\r\n        lastScannedStr =\r\n            '<div>' +\r\n            'Last Scanned: ' + getDateStr(lastScanned) +\r\n            '</div>'\r\n    }\r\n    var directionsStr = ''\r\n    if (!Store.get('useGymSidebar')) {\r\n        directionsStr =\r\n            '<div>' +\r\n            '<a href=\\'javascript:void(0)\\' onclick=\\'javascript:openMapDirections(' + latitude + ',' + longitude + ')\\' title=\\'View in Maps\\'>Get directions</a>' +\r\n            '</div>'\r\n    }\r\n\r\n    var nameStr = name ? '<div>' + name + '</div>' : ''\r\n\r\n    var gymColor = ['0, 0, 0, .4', '74, 138, 202, .6', '240, 68, 58, .6', '254, 217, 40, .6']\r\n    var str\r\n    if (teamId === 0) {\r\n        str = '<div> ' +\r\n            '<center>' +\r\n            '<div>' +\r\n            '<b style=\"color:rgba(' + gymColor[teamId] + ')\">' + teamName + '</b><br>' +\r\n            '<img height=\"70px\" style=\"padding: 5px\" src=\"static/forts/' + teamName + '_large.png\">' +\r\n            '</div>' +\r\n            nameStr +\r\n            '<div>' +\r\n            'Location: ' + latitude.toFixed(6) + ', ' + longitude.toFixed(7) +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Last Modified: ' + lastModifiedStr +\r\n            '</div>' +\r\n            lastScannedStr +\r\n            directionsStr +\r\n            '</center>' +\r\n            '</div>'\r\n    } else {\r\n        var gymLevel = getGymLevel(gymPoints)\r\n        str =\r\n            '<div>' +\r\n            '<center>' +\r\n            '<div style=\"padding-bottom: 2px\">' +\r\n            'Gym owned by:' +\r\n            '</div>' +\r\n            '<div>' +\r\n            '<b style=\"color:rgba(' + gymColor[teamId] + ')\">Team ' + teamName + '</b><br>' +\r\n            '<img height=\"70px\" style=\"padding: 5px\" src=\"static/forts/' + teamName + '_large.png\">' +\r\n            '</div>' +\r\n            '<div>' +\r\n            nameStr +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Level: ' + gymLevel + ' | Prestige: ' + gymPoints + '/' + (gymPrestige[gymLevel - 1] || 50000) +\r\n            '</div>' +\r\n            '<div>' + memberStr +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Location: ' + latitude.toFixed(6) + ', ' + longitude.toFixed(7) +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Last Modified: ' + lastModifiedStr +\r\n            '</div>' + lastScannedStr +\r\n            directionsStr +\r\n            '</center>' +\r\n            '</div>'\r\n    }\r\n\r\n    return str\r\n}\r\n\r\nfunction getGymLevel(points) {\r\n    var level = 1\r\n    while (points >= gymPrestige[level - 1]) {\r\n        level++\r\n    }\r\n\r\n    return level\r\n}\r\n\r\nfunction pokestopLabel(expireTime, latitude, longitude) {\r\n    var str\r\n    if (expireTime) {\r\n        var expireDate = new Date(expireTime)\r\n\r\n        str =\r\n            '<div>' +\r\n            '<b>Lured Pokstop</b>' +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Lure expires at ' + pad(expireDate.getHours()) + ':' + pad(expireDate.getMinutes()) + ':' + pad(expireDate.getSeconds()) +\r\n            '<span class=\"label-countdown\" disappears-at=\"' + expireTime + '\">(00m00s)</span>' +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Location: ' + latitude.toFixed(6) + ', ' + longitude.toFixed(7) +\r\n            '</div>' +\r\n            '<div>' +\r\n            '<a href=\"javascript:void(0)\" onclick=\"javascript:openMapDirections(' + latitude + ',' + longitude + ')\" title=\"View in Maps\">Get directions</a>' +\r\n            '</div>'\r\n    } else {\r\n        str =\r\n            '<div>' +\r\n            '<b>Pokstop</b>' +\r\n            '</div>' +\r\n            '<div>' +\r\n            'Location: ' + latitude.toFixed(6) + ', ' + longitude.toFixed(7) +\r\n            '</div>' +\r\n            '<div>' +\r\n            '<a href=\"javascript:void(0)\" onclick=\"javascript:openMapDirections(' + latitude + ',' + longitude + ')\" title=\"View in Maps\">Get directions</a>' +\r\n            '</div>'\r\n    }\r\n\r\n    return str\r\n}\r\n\r\nfunction formatSpawnTime(seconds) {\r\n    // the addition and modulo are required here because the db stores when a spawn disappears\r\n    // the subtraction to get the appearance time will knock seconds under 0 if the spawn happens in the previous hour\r\n    return ('0' + Math.floor((seconds + 3600) % 3600 / 60)).substr(-2) + ':' + ('0' + seconds % 60).substr(-2)\r\n}\r\n\r\nfunction spawnpointLabel(item) {\r\n    var str =\r\n        '<div>' +\r\n        '<b>Spawn Point</b>' +\r\n        '</div>' +\r\n        '<div>' +\r\n        'Every hour from ' + formatSpawnTime(item.time) + ' to ' + formatSpawnTime(item.time + 900) +\r\n        '</div>'\r\n\r\n    if (item.special) {\r\n        str +=\r\n            '<div>' +\r\n            'May appear as early as ' + formatSpawnTime(item.time - 1800) +\r\n            '</div>'\r\n    }\r\n    return str\r\n}\r\n\r\nfunction addRangeCircle(marker, map, type, teamId) {\r\n    var targetmap = null\r\n    var circleCenter = new google.maps.LatLng(marker.position.lat(), marker.position.lng())\r\n    var gymColors = ['#999999', '#0051CF', '#FF260E', '#FECC23'] // 'Uncontested', 'Mystic', 'Valor', 'Instinct']\r\n    var teamColor = gymColors[0]\r\n    if (teamId) teamColor = gymColors[teamId]\r\n\r\n    var range\r\n    var circleColor\r\n\r\n    // handle each type of marker and be explicit about the range circle attributes\r\n    switch (type) {\r\n        case 'pokemon':\r\n            circleColor = '#C233F2'\r\n            range = 40 // pokemon appear at 40m and then you can move away. still have to be 40m close to see it though, so ignore the further disappear distance\r\n            break\r\n        case 'pokestop':\r\n            circleColor = '#3EB0FF'\r\n            range = 40\r\n            break\r\n        case 'gym':\r\n            circleColor = teamColor\r\n            range = 40\r\n            break\r\n    }\r\n\r\n    if (map) targetmap = map\r\n\r\n    var rangeCircleOpts = {\r\n        map: targetmap,\r\n        radius: range, // meters\r\n        strokeWeight: 1,\r\n        strokeColor: circleColor,\r\n        strokeOpacity: 0.9,\r\n        center: circleCenter,\r\n        fillColor: circleColor,\r\n        fillOpacity: 0.3\r\n    }\r\n    var rangeCircle = new google.maps.Circle(rangeCircleOpts)\r\n    return rangeCircle\r\n}\r\n\r\nfunction isRangeActive(map) {\r\n    if (map.getZoom() < 16) return false\r\n    return Store.get('showRanges')\r\n}\r\n\r\nfunction getIv(atk, def, stm) {\r\n    if (atk !== null) {\r\n        return 100.0 * (atk + def + stm) / 45\r\n    }\r\n\r\n    return false\r\n}\r\n\r\nfunction getPokemonLevel(cpMultiplier) {\r\n    if (cpMultiplier < 0.734) {\r\n        var pokemonLevel = 58.35178527 * cpMultiplier * cpMultiplier - 2.838007664 * cpMultiplier + 0.8539209906\r\n    } else {\r\n        pokemonLevel = 171.0112688 * cpMultiplier - 95.20425243\r\n    }\r\n    pokemonLevel = Math.round(pokemonLevel) * 2 / 2\r\n\r\n    return pokemonLevel\r\n}\r\n\r\nfunction lpad(str, len, padstr) {\r\n    return Array(Math.max(len - String(str).length + 1, 0)).join(padstr) + str\r\n}\r\n\r\nfunction repArray(text, find, replace) {\r\n    for (var i = 0; i < find.length; i++) {\r\n        text = text.replace(find[i], replace[i])\r\n    }\r\n\r\n    return text\r\n}\r\n\r\nfunction getTimeUntil(time) {\r\n    var now = +new Date()\r\n    var tdiff = time - now\r\n\r\n    var sec = Math.floor(tdiff / 1000 % 60)\r\n    var min = Math.floor(tdiff / 1000 / 60 % 60)\r\n    var hour = Math.floor(tdiff / (1000 * 60 * 60) % 24)\r\n\r\n    return {\r\n        'total': tdiff,\r\n        'hour': hour,\r\n        'min': min,\r\n        'sec': sec,\r\n        'now': now,\r\n        'ttime': time\r\n    }\r\n}\r\n\r\nfunction getNotifyText(item) {\r\n    var iv = getIv(item['individual_attack'], item['individual_defense'], item['individual_stamina'])\r\n    var find = ['<prc>', '<pkm>', '<atk>', '<def>', '<sta>']\r\n    var replace = [iv ? iv.toFixed(1) : '', item['pokemon_name'], item['individual_attack'], item['individual_defense'], item['individual_stamina']]\r\n    var ntitle = repArray(iv ? notifyIvTitle : notifyNoIvTitle, find, replace)\r\n    var dist = new Date(item['disappear_time']).toLocaleString([], {\r\n        hour: '2-digit', minute: '2-digit',\r\n        second: '2-digit', hour12: false\r\n    })\r\n    var until = getTimeUntil(item['disappear_time'])\r\n    var udist = until.hour > 0 ? until.hour + ':' : ''\r\n    udist += lpad(until.min, 2, 0) + 'm' + lpad(until.sec, 2, 0) + 's'\r\n    find = ['<dist>', '<udist>']\r\n    replace = [dist, udist]\r\n    var ntext = repArray(notifyText, find, replace)\r\n\r\n    return {\r\n        'fav_title': ntitle,\r\n        'fav_text': ntext\r\n    }\r\n}\r\n\r\nfunction customizePokemonMarker(marker, item, skipNotification) {\r\n    marker.addListener('click', function () {\r\n        this.setAnimation(null)\r\n        this.animationDisabled = true\r\n    })\r\n\r\n    if (!marker.rangeCircle && isRangeActive(map)) {\r\n        marker.rangeCircle = addRangeCircle(marker, map, 'pokemon')\r\n    }\r\n\r\n    marker.infoWindow = new google.maps.InfoWindow({\r\n        content: pokemonLabel(item),\r\n        disableAutoPan: true\r\n    })\r\n\r\n    if (notifiedPokemon.indexOf(item['pokemon_id']) > -1 || notifiedRarity.indexOf(item['pokemon_rarity']) > -1) {\r\n        if (!skipNotification) {\r\n            if (Store.get('playSound')) {\r\n                audio.play()\r\n            }\r\n            sendNotification(getNotifyText(item).fav_title, getNotifyText(item).fav_text, 'static/icons/' + item['pokemon_id'] + '.png', item['latitude'], item['longitude'])\r\n        }\r\n        if (marker.animationDisabled !== true) {\r\n            marker.setAnimation(google.maps.Animation.BOUNCE)\r\n        }\r\n    }\r\n\r\n    if (item['individual_attack'] != null) {\r\n        var perfection = getIv(item['individual_attack'], item['individual_defense'], item['individual_stamina'])\r\n        if (notifiedMinPerfection > 0 && perfection >= notifiedMinPerfection) {\r\n            if (!skipNotification) {\r\n                if (Store.get('playSound')) {\r\n                    audio.play()\r\n                }\r\n                sendNotification(getNotifyText(item).fav_title, getNotifyText(item).fav_text, 'static/icons/' + item['pokemon_id'] + '.png', item['latitude'], item['longitude'])\r\n            }\r\n            if (marker.animationDisabled !== true) {\r\n                marker.setAnimation(google.maps.Animation.BOUNCE)\r\n            }\r\n        }\r\n    }\r\n\r\n    addListeners(marker)\r\n}\r\n\r\nfunction setupGymMarker(item) {\r\n    var marker = new google.maps.Marker({\r\n        position: {\r\n            lat: item['latitude'],\r\n            lng: item['longitude']\r\n        },\r\n        map: map,\r\n        icon: {\r\n            url: 'static/forts/' + Store.get('gymMarkerStyle') + '/' + gymTypes[item['team_id']] + (item['team_id'] !== 0 ? '_' + getGymLevel(item['gym_points']) : '') + '.png',\r\n            scaledSize: new google.maps.Size(48, 48)\r\n        }\r\n    })\r\n\r\n    if (!marker.rangeCircle && isRangeActive(map)) {\r\n        marker.rangeCircle = addRangeCircle(marker, map, 'gym', item['team_id'])\r\n    }\r\n\r\n    marker.infoWindow = new google.maps.InfoWindow({\r\n        content: gymLabel(gymTypes[item['team_id']], item['team_id'], item['gym_points'], item['latitude'], item['longitude'], item['last_scanned'], item['last_modified'], item['name'], item['pokemon'], item['gym_id'], item['guard_pokemon_id']),\r\n        disableAutoPan: true\r\n    })\r\n\r\n    if (Store.get('useGymSidebar')) {\r\n        marker.addListener('click', function () {\r\n            var gymSidebar = document.querySelector('#gym-details')\r\n            if (gymSidebar.getAttribute('data-id') === item['gym_id'] && gymSidebar.classList.contains('visible')) {\r\n                gymSidebar.classList.remove('visible')\r\n            } else {\r\n                gymSidebar.setAttribute('data-id', item['gym_id'])\r\n                showGymDetails(item['gym_id'])\r\n            }\r\n        })\r\n\r\n        google.maps.event.addListener(marker.infoWindow, 'closeclick', function () {\r\n            marker.persist = null\r\n        })\r\n\r\n        if (!isMobileDevice() && !isTouchDevice()) {\r\n            marker.addListener('mouseover', function () {\r\n                marker.infoWindow.open(map, marker)\r\n                clearSelection()\r\n                updateLabelDiffTime()\r\n            })\r\n        }\r\n\r\n        marker.addListener('mouseout', function () {\r\n            if (!marker.persist) {\r\n                marker.infoWindow.close()\r\n            }\r\n        })\r\n    } else {\r\n        addListeners(marker)\r\n    }\r\n    return marker\r\n}\r\n\r\nfunction updateGymMarker(item, marker) {\r\n    marker.setIcon({\r\n        url: 'static/forts/' + Store.get('gymMarkerStyle') + '/' + gymTypes[item['team_id']] + (item['team_id'] !== 0 ? '_' + getGymLevel(item['gym_points']) : '') + '.png',\r\n        scaledSize: new google.maps.Size(48, 48)\r\n    })\r\n    marker.infoWindow.setContent(gymLabel(gymTypes[item['team_id']], item['team_id'], item['gym_points'], item['latitude'], item['longitude'], item['last_scanned'], item['last_modified'], item['name'], item['pokemon'], item['gym_id'], item['guard_pokemon_id']))\r\n    return marker\r\n}\r\n\r\nfunction updateGymIcons() {\r\n    $.each(mapData.gyms, function (key, value) {\r\n        mapData.gyms[key]['marker'].setIcon({\r\n            url: 'static/forts/' + Store.get('gymMarkerStyle') + '/' + gymTypes[mapData.gyms[key]['team_id']] + (mapData.gyms[key]['team_id'] !== 0 ? '_' + getGymLevel(mapData.gyms[key]['gym_points']) : '') + '.png',\r\n            scaledSize: new google.maps.Size(48, 48)\r\n        })\r\n    })\r\n}\r\n\r\nfunction setupPokestopMarker(item) {\r\n    var imagename = item['lure_expiration'] ? 'PstopLured' : 'Pstop'\r\n    var marker = new google.maps.Marker({\r\n        position: {\r\n            lat: item['latitude'],\r\n            lng: item['longitude']\r\n        },\r\n        map: map,\r\n        zIndex: 2,\r\n        icon: 'static/forts/' + imagename + '.png'\r\n    })\r\n\r\n    if (!marker.rangeCircle && isRangeActive(map)) {\r\n        marker.rangeCircle = addRangeCircle(marker, map, 'pokestop')\r\n    }\r\n\r\n    marker.infoWindow = new google.maps.InfoWindow({\r\n        content: pokestopLabel(item['lure_expiration'], item['latitude'], item['longitude']),\r\n        disableAutoPan: true\r\n    })\r\n\r\n    addListeners(marker)\r\n    return marker\r\n}\r\n\r\nfunction getColorByDate(value) {\r\n    // Changes the color from red to green over 15 mins\r\n    var diff = (Date.now() - value) / 1000 / 60 / 15\r\n\r\n    if (diff > 1) {\r\n        diff = 1\r\n    }\r\n\r\n    // value from 0 to 1 - Green to Red\r\n    var hue = ((1 - diff) * 120).toString(10)\r\n    return ['hsl(', hue, ',100%,50%)'].join('')\r\n}\r\n\r\nfunction setupScannedMarker(item) {\r\n    var circleCenter = new google.maps.LatLng(item['latitude'], item['longitude'])\r\n\r\n    var marker = new google.maps.Circle({\r\n        map: map,\r\n        clickable: false,\r\n        center: circleCenter,\r\n        radius: 70, // metres\r\n        fillColor: getColorByDate(item['last_modified']),\r\n        fillOpacity: 0.1,\r\n        strokeWeight: 1,\r\n        strokeOpacity: 0.5\r\n    })\r\n\r\n    return marker\r\n}\r\n\r\nfunction getColorBySpawnTime(value) {\r\n    var now = new Date()\r\n    var seconds = now.getMinutes() * 60 + now.getSeconds()\r\n\r\n    // account for hour roll-over\r\n    if (seconds < 900 && value > 2700) {\r\n        seconds += 3600\r\n    } else if (seconds > 2700 && value < 900) {\r\n        value += 3600\r\n    }\r\n\r\n    var diff = seconds - value\r\n    var hue = 275 // light purple when spawn is neither about to spawn nor active\r\n    if (diff >= 0 && diff <= 900) {\r\n        // green to red over 15 minutes of active spawn\r\n        hue = (1 - diff / 60 / 15) * 120\r\n    } else if (diff < 0 && diff > -300) {\r\n        // light blue to dark blue over 5 minutes til spawn\r\n        hue = (1 - -diff / 60 / 5) * 50 + 200\r\n    }\r\n\r\n    hue = Math.round(hue / 5) * 5\r\n\r\n    return hue\r\n}\r\n\r\nfunction changeSpawnIcon(color, zoom) {\r\n    var urlColor = ''\r\n    if (color === 275) {\r\n        urlColor = './static/icons/hsl-275-light.png'\r\n    } else {\r\n        urlColor = './static/icons/hsl-' + color + '.png'\r\n    }\r\n    var zoomScale = 1.6 // adjust this value to change the size of the spawnpoint icons\r\n    var minimumSize = 1\r\n    var newSize = Math.round(zoomScale * (zoom - 10) // this scales the icon based on zoom\r\n    )\r\n    if (newSize < minimumSize) {\r\n        newSize = minimumSize\r\n    }\r\n\r\n    var newIcon = {\r\n        url: urlColor,\r\n        scaledSize: new google.maps.Size(newSize, newSize),\r\n        anchor: new google.maps.Point(newSize / 2, newSize / 2)\r\n    }\r\n\r\n    return newIcon\r\n}\r\n\r\nfunction spawnPointIndex(color) {\r\n    var newIndex = 1\r\n    var scale = 0\r\n    if (color >= 0 && color <= 120) {\r\n        // high to low over 15 minutes of active spawn\r\n        scale = color / 120\r\n        newIndex = 100 + scale * 100\r\n    } else if (color >= 200 && color <= 250) {\r\n        // low to high over 5 minutes til spawn\r\n        scale = (color - 200) / 50\r\n        newIndex = scale * 100\r\n    }\r\n\r\n    return newIndex\r\n}\r\n\r\nfunction setupSpawnpointMarker(item) {\r\n    var circleCenter = new google.maps.LatLng(item['latitude'], item['longitude'])\r\n    var hue = getColorBySpawnTime(item.time)\r\n    var zoom = map.getZoom()\r\n\r\n    var marker = new google.maps.Marker({\r\n        map: map,\r\n        position: circleCenter,\r\n        icon: changeSpawnIcon(hue, zoom),\r\n        zIndex: spawnPointIndex(hue)\r\n    })\r\n\r\n    marker.infoWindow = new google.maps.InfoWindow({\r\n        content: spawnpointLabel(item),\r\n        disableAutoPan: true,\r\n        position: circleCenter\r\n    })\r\n\r\n    addListeners(marker)\r\n\r\n    return marker\r\n}\r\n\r\nfunction clearSelection() {\r\n    if (document.selection) {\r\n        document.selection.empty()\r\n    } else if (window.getSelection) {\r\n        window.getSelection().removeAllRanges()\r\n    }\r\n}\r\n\r\nfunction addListeners(marker) {\r\n    marker.addListener('click', function () {\r\n        if (!marker.infoWindowIsOpen) {\r\n            marker.infoWindow.open(map, marker)\r\n            clearSelection()\r\n            updateLabelDiffTime()\r\n            marker.persist = true\r\n            marker.infoWindowIsOpen = true\r\n        } else {\r\n            marker.persist = null\r\n            marker.infoWindow.close()\r\n            marker.infoWindowIsOpen = false\r\n        }\r\n    })\r\n\r\n    google.maps.event.addListener(marker.infoWindow, 'closeclick', function () {\r\n        marker.persist = null\r\n    })\r\n\r\n    if (!isMobileDevice() && !isTouchDevice()) {\r\n        marker.addListener('mouseover', function () {\r\n            marker.infoWindow.open(map, marker)\r\n            clearSelection()\r\n            updateLabelDiffTime()\r\n        })\r\n    }\r\n\r\n    marker.addListener('mouseout', function () {\r\n        if (!marker.persist) {\r\n            marker.infoWindow.close()\r\n        }\r\n    })\r\n\r\n    return marker\r\n}\r\n\r\nfunction clearStaleMarkers() {\r\n    $.each(mapData.pokemons, function (key, value) {\r\n        if (mapData.pokemons[key]['disappear_time'] < new Date().getTime() || excludedPokemon.indexOf(mapData.pokemons[key]['pokemon_id']) >= 0) {\r\n            if (mapData.pokemons[key].marker.rangeCircle) {\r\n                mapData.pokemons[key].marker.rangeCircle.setMap(null)\r\n                delete mapData.pokemons[key].marker.rangeCircle\r\n            }\r\n            mapData.pokemons[key].marker.setMap(null)\r\n            delete mapData.pokemons[key]\r\n        }\r\n    })\r\n\r\n    $.each(mapData.lurePokemons, function (key, value) {\r\n        if (mapData.lurePokemons[key]['lure_expiration'] < new Date().getTime() || excludedPokemon.indexOf(mapData.lurePokemons[key]['pokemon_id']) >= 0) {\r\n            mapData.lurePokemons[key].marker.setMap(null)\r\n            delete mapData.lurePokemons[key]\r\n        }\r\n    })\r\n\r\n    $.each(mapData.scanned, function (key, value) {\r\n        // If older than 15mins remove\r\n        if (mapData.scanned[key]['last_modified'] < new Date().getTime() - 15 * 60 * 1000) {\r\n            mapData.scanned[key].marker.setMap(null)\r\n            delete mapData.scanned[key]\r\n        }\r\n    })\r\n}\r\n\r\nfunction showInBoundsMarkers(markers, type) {\r\n    $.each(markers, function (key, value) {\r\n        var marker = markers[key].marker\r\n        var show = false\r\n        if (!markers[key].hidden) {\r\n            if (typeof marker.getBounds === 'function') {\r\n                if (map.getBounds().intersects(marker.getBounds())) {\r\n                    show = true\r\n                }\r\n            } else if (typeof marker.getPosition === 'function') {\r\n                if (map.getBounds().contains(marker.getPosition())) {\r\n                    show = true\r\n                }\r\n            }\r\n        }\r\n        // marker has an associated range\r\n        if (show && rangeMarkers.indexOf(type) !== -1) {\r\n            // no range circle yet...let's create one\r\n            if (!marker.rangeCircle) {\r\n                // but only if range is active\r\n                if (isRangeActive(map)) {\r\n                    if (type === 'gym') marker.rangeCircle = addRangeCircle(marker, map, type, markers[key].team_id)\r\n                    else marker.rangeCircle = addRangeCircle(marker, map, type)\r\n                }\r\n            } else {\r\n                // there's already a range circle\r\n                if (isRangeActive(map)) {\r\n                    marker.rangeCircle.setMap(map)\r\n                } else {\r\n                    marker.rangeCircle.setMap(null)\r\n                }\r\n            }\r\n        }\r\n\r\n        if (show && !marker.getMap()) {\r\n            marker.setMap(map\r\n                // Not all markers can be animated (ex: scan locations)\r\n            )\r\n            if (marker.setAnimation && marker.oldAnimation) {\r\n                marker.setAnimation(marker.oldAnimation)\r\n            }\r\n        } else if (!show && marker.getMap()) {\r\n            // Not all markers can be animated (ex: scan locations)\r\n            if (marker.getAnimation) {\r\n                marker.oldAnimation = marker.getAnimation()\r\n            }\r\n            if (marker.rangeCircle) marker.rangeCircle.setMap(null)\r\n            marker.setMap(null)\r\n        }\r\n    })\r\n}\r\n\r\nfunction loadRawData() {\r\n    var loadPokemon = Store.get('showPokemon')\r\n    var loadGyms = Store.get('showGyms')\r\n    var loadPokestops = Store.get('showPokestops')\r\n    var loadScanned = Store.get('showScanned')\r\n    var loadSpawnpoints = Store.get('showSpawnpoints')\r\n    var loadLuredOnly = Boolean(Store.get('showLuredPokestopsOnly'))\r\n\r\n    var bounds = map.getBounds()\r\n    var swPoint = bounds.getSouthWest()\r\n    var nePoint = bounds.getNorthEast()\r\n    var swLat = swPoint.lat()\r\n    var swLng = swPoint.lng()\r\n    var neLat = nePoint.lat()\r\n    var neLng = nePoint.lng()\r\n\r\n    return $.ajax({\r\n        url: 'raw_data',\r\n        type: 'GET',\r\n        timeout: 300000,\r\n        data: {\r\n            'timestamp': timestamp,\r\n            'pokemon': loadPokemon,\r\n            'lastpokemon': lastpokemon,\r\n            'pokestops': loadPokestops,\r\n            'lastpokestops': lastpokestops,\r\n            'luredonly': loadLuredOnly,\r\n            'gyms': loadGyms,\r\n            'lastgyms': lastgyms,\r\n            'scanned': loadScanned,\r\n            'lastslocs': lastslocs,\r\n            'spawnpoints': loadSpawnpoints,\r\n            'lastspawns': lastspawns,\r\n            'swLat': swLat,\r\n            'swLng': swLng,\r\n            'neLat': neLat,\r\n            'neLng': neLng,\r\n            'oSwLat': oSwLat,\r\n            'oSwLng': oSwLng,\r\n            'oNeLat': oNeLat,\r\n            'oNeLng': oNeLng,\r\n            'reids': String(reincludedPokemon),\r\n            'eids': String(excludedPokemon)\r\n        },\r\n        dataType: 'json',\r\n        cache: false,\r\n        beforeSend: function beforeSend() {\r\n            if (rawDataIsLoading) {\r\n                return false\r\n            } else {\r\n                rawDataIsLoading = true\r\n            }\r\n        },\r\n        error: function error() {\r\n            // Display error toast\r\n            toastr['error']('Please check connectivity or reduce marker settings.', 'Error getting data')\r\n            toastr.options = {\r\n                'closeButton': true,\r\n                'debug': false,\r\n                'newestOnTop': true,\r\n                'progressBar': false,\r\n                'positionClass': 'toast-top-right',\r\n                'preventDuplicates': true,\r\n                'onclick': null,\r\n                'showDuration': '300',\r\n                'hideDuration': '1000',\r\n                'timeOut': '25000',\r\n                'extendedTimeOut': '1000',\r\n                'showEasing': 'swing',\r\n                'hideEasing': 'linear',\r\n                'showMethod': 'fadeIn',\r\n                'hideMethod': 'fadeOut'\r\n            }\r\n        },\r\n        complete: function complete() {\r\n            rawDataIsLoading = false\r\n        }\r\n    })\r\n}\r\n\r\nfunction processPokemons(i, item) {\r\n    if (!Store.get('showPokemon')) {\r\n        return false // in case the checkbox was unchecked in the meantime.\r\n    }\r\n\r\n    if (!(item['encounter_id'] in mapData.pokemons) && excludedPokemon.indexOf(item['pokemon_id']) < 0 && item['disappear_time'] > Date.now()) {\r\n        // add marker to map and item to dict\r\n        if (item.marker) {\r\n            item.marker.setMap(null)\r\n        }\r\n        if (!item.hidden) {\r\n            item.marker = setupPokemonMarker(item, map)\r\n            customizePokemonMarker(item.marker, item)\r\n            mapData.pokemons[item['encounter_id']] = item\r\n        }\r\n    }\r\n}\r\n\r\nfunction processPokestops(i, item) {\r\n    if (!Store.get('showPokestops')) {\r\n        return false\r\n    }\r\n\r\n    if (Store.get('showLuredPokestopsOnly') && !item['lure_expiration']) {\r\n        return true\r\n    }\r\n\r\n    if (!mapData.pokestops[item['pokestop_id']]) {\r\n        // new pokestop, add marker to map and item to dict\r\n        if (item.marker && item.marker.rangeCircle) {\r\n            item.marker.rangeCircle.setMap(null)\r\n        }\r\n        if (item.marker) {\r\n            item.marker.setMap(null)\r\n        }\r\n        item.marker = setupPokestopMarker(item)\r\n        mapData.pokestops[item['pokestop_id']] = item\r\n    } else {\r\n        // change existing pokestop marker to unlured/lured\r\n        var item2 = mapData.pokestops[item['pokestop_id']]\r\n        if (!!item['lure_expiration'] !== !!item2['lure_expiration']) {\r\n            if (item2.marker && item2.marker.rangeCircle) {\r\n                item2.marker.rangeCircle.setMap(null)\r\n            }\r\n            item2.marker.setMap(null)\r\n            item.marker = setupPokestopMarker(item)\r\n            mapData.pokestops[item['pokestop_id']] = item\r\n        }\r\n    }\r\n}\r\n\r\nfunction updatePokestops() {\r\n    if (!Store.get('showPokestops')) {\r\n        return false\r\n    }\r\n\r\n    var removeStops = []\r\n    var currentTime = new Date().getTime()\r\n\r\n    // change lured pokestop marker to unlured when expired\r\n    $.each(mapData.pokestops, function (key, value) {\r\n        if (value['lure_expiration'] && value['lure_expiration'] < currentTime) {\r\n            value['lure_expiration'] = null\r\n            if (value.marker && value.marker.rangeCircle) {\r\n                value.marker.rangeCircle.setMap(null)\r\n            }\r\n            value.marker.setMap(null)\r\n            value.marker = setupPokestopMarker(value)\r\n        }\r\n    })\r\n\r\n    // remove unlured stops if show lured only is selected\r\n    if (Store.get('showLuredPokestopsOnly')) {\r\n        $.each(mapData.pokestops, function (key, value) {\r\n            if (!value['lure_expiration']) {\r\n                removeStops.push(key)\r\n            }\r\n        })\r\n        $.each(removeStops, function (key, value) {\r\n            if (mapData.pokestops[value] && mapData.pokestops[value].marker) {\r\n                if (mapData.pokestops[value].marker.rangeCircle) {\r\n                    mapData.pokestops[value].marker.rangeCircle.setMap(null)\r\n                }\r\n                mapData.pokestops[value].marker.setMap(null)\r\n                delete mapData.pokestops[value]\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nfunction processGyms(i, item) {\r\n    if (!Store.get('showGyms')) {\r\n        return false // in case the checkbox was unchecked in the meantime.\r\n    }\r\n\r\n    var gymLevel = getGymLevel(item.gym_points)\r\n    var removeGymFromMap = function removeGymFromMap(gymid) {\r\n        if (mapData.gyms[gymid] && mapData.gyms[gymid].marker) {\r\n            if (mapData.gyms[gymid].marker.rangeCircle) {\r\n                mapData.gyms[gymid].marker.rangeCircle.setMap(null)\r\n            }\r\n            mapData.gyms[gymid].marker.setMap(null)\r\n            delete mapData.gyms[gymid]\r\n        }\r\n    }\r\n\r\n    var gymHasOpenSpot = function gymHasOpenSpot(gymLevel, pokemonInGym) {\r\n        return gymLevel > item.pokemon.length && item.pokemon.length !== 0\r\n    }\r\n\r\n    if (Store.get('showOpenGymsOnly') === 1) {\r\n        if (!gymHasOpenSpot(gymLevel, item.pokemon.length)) {\r\n            removeGymFromMap(item['gym_id'])\r\n            return true\r\n        }\r\n    }\r\n\r\n    if (Store.get('showOpenGymsOnly') > 1) {\r\n        var closePrestige = 0\r\n        switch (Store.get('showOpenGymsOnly')) {\r\n            case 2:\r\n                closePrestige = 1000\r\n                break\r\n            case 3:\r\n                closePrestige = 2500\r\n                break\r\n            case 4:\r\n                closePrestige = 5000\r\n                break\r\n        }\r\n\r\n        if (!gymHasOpenSpot(gymLevel, item.pokemon.length) && (gymPrestige[gymLevel - 1] > closePrestige + item.gym_points || gymLevel === 10)) {\r\n            removeGymFromMap(item['gym_id'])\r\n            return true\r\n        }\r\n    }\r\n\r\n    if (Store.get('showTeamGymsOnly') && Store.get('showTeamGymsOnly') !== item.team_id) {\r\n        removeGymFromMap(item['gym_id'])\r\n        return true\r\n    }\r\n\r\n    if (Store.get('showLastUpdatedGymsOnly')) {\r\n        var now = new Date()\r\n        if (item.last_scanned == null) {\r\n            if (Store.get('showLastUpdatedGymsOnly') * 3600 * 1000 + item.last_modified < now.getTime()) {\r\n                removeGymFromMap(item['gym_id'])\r\n                return true\r\n            }\r\n        } else {\r\n            if (Store.get('showLastUpdatedGymsOnly') * 3600 * 1000 + item.last_scanned < now.getTime()) {\r\n                removeGymFromMap(item['gym_id'])\r\n                return true\r\n            }\r\n        }\r\n    }\r\n\r\n    if (gymLevel < Store.get('minGymLevel')) {\r\n        removeGymFromMap(item['gym_id'])\r\n        return true\r\n    }\r\n\r\n    if (gymLevel > Store.get('maxGymLevel')) {\r\n        removeGymFromMap(item['gym_id'])\r\n        return true\r\n    }\r\n\r\n    if (item['gym_id'] in mapData.gyms) {\r\n        item.marker = updateGymMarker(item, mapData.gyms[item['gym_id']].marker)\r\n    } else {\r\n        // add marker to map and item to dict\r\n        item.marker = setupGymMarker(item)\r\n    }\r\n    mapData.gyms[item['gym_id']] = item\r\n}\r\n\r\nfunction processScanned(i, item) {\r\n    if (!Store.get('showScanned')) {\r\n        return false\r\n    }\r\n\r\n    var scanId = item['latitude'] + '|' + item['longitude']\r\n\r\n    if (!(scanId in mapData.scanned)) {\r\n        // add marker to map and item to dict\r\n        if (item.marker) {\r\n            item.marker.setMap(null)\r\n        }\r\n        item.marker = setupScannedMarker(item)\r\n        mapData.scanned[scanId] = item\r\n    } else {\r\n        mapData.scanned[scanId].last_modified = item['last_modified']\r\n    }\r\n}\r\n\r\nfunction updateScanned() {\r\n    if (!Store.get('showScanned')) {\r\n        return false\r\n    }\r\n\r\n    $.each(mapData.scanned, function (key, value) {\r\n        if (map.getBounds().intersects(value.marker.getBounds())) {\r\n            value.marker.setOptions({\r\n                fillColor: getColorByDate(value['last_modified'])\r\n            })\r\n        }\r\n    })\r\n}\r\n\r\nfunction processSpawnpoints(i, item) {\r\n    if (!Store.get('showSpawnpoints')) {\r\n        return false\r\n    }\r\n\r\n    var id = item['spawnpoint_id']\r\n\r\n    if (!(id in mapData.spawnpoints)) {\r\n        // add marker to map and item to dict\r\n        if (item.marker) {\r\n            item.marker.setMap(null)\r\n        }\r\n        item.marker = setupSpawnpointMarker(item)\r\n        mapData.spawnpoints[id] = item\r\n    }\r\n}\r\n\r\nfunction updateSpawnPoints() {\r\n    if (!Store.get('showSpawnpoints')) {\r\n        return false\r\n    }\r\n\r\n    var zoom = map.getZoom()\r\n\r\n    $.each(mapData.spawnpoints, function (key, value) {\r\n        if (map.getBounds().contains(value.marker.getPosition())) {\r\n            var hue = getColorBySpawnTime(value['time'])\r\n            value.marker.setIcon(changeSpawnIcon(hue, zoom))\r\n            value.marker.setZIndex(spawnPointIndex(hue))\r\n        }\r\n    })\r\n}\r\n\r\nfunction updateMap() {\r\n    var position = map.getCenter()\r\n    Store.set('startAtLastLocationPosition', {\r\n        lat: position.lat(),\r\n        lng: position.lng()\r\n    })\r\n\r\n    loadRawData().done(function (result) {\r\n        $.each(result.pokemons, processPokemons)\r\n        $.each(result.pokestops, processPokestops)\r\n        $.each(result.gyms, processGyms)\r\n        $.each(result.scanned, processScanned)\r\n        $.each(result.spawnpoints, processSpawnpoints)\r\n        showInBoundsMarkers(mapData.pokemons, 'pokemon')\r\n        showInBoundsMarkers(mapData.lurePokemons, 'pokemon')\r\n        showInBoundsMarkers(mapData.gyms, 'gym')\r\n        showInBoundsMarkers(mapData.pokestops, 'pokestop')\r\n        showInBoundsMarkers(mapData.scanned, 'scanned')\r\n        showInBoundsMarkers(mapData.spawnpoints, 'inbound'\r\n            //      drawScanPath(result.scanned)\r\n        )\r\n        clearStaleMarkers()\r\n\r\n        updateScanned()\r\n        updateSpawnPoints()\r\n        updatePokestops()\r\n\r\n        if ($('#stats').hasClass('visible')) {\r\n            countMarkers(map)\r\n        }\r\n\r\n        oSwLat = result.oSwLat\r\n        oSwLng = result.oSwLng\r\n        oNeLat = result.oNeLat\r\n        oNeLng = result.oNeLng\r\n\r\n        lastgyms = result.lastgyms\r\n        lastpokestops = result.lastpokestops\r\n        lastpokemon = result.lastpokemon\r\n        lastslocs = result.lastslocs\r\n        lastspawns = result.lastspawns\r\n\r\n        reids = result.reids\r\n        if (reids instanceof Array) {\r\n            reincludedPokemon = reids.filter(function (e) {\r\n                return this.indexOf(e) < 0\r\n            }, reincludedPokemon)\r\n        }\r\n        timestamp = result.timestamp\r\n        lastUpdateTime = Date.now()\r\n    })\r\n}\r\n\r\nfunction drawScanPath(points) { // eslint-disable-line no-unused-vars\r\n    var scanPathPoints = []\r\n    $.each(points, function (idx, point) {\r\n        scanPathPoints.push({\r\n            lat: point['latitude'],\r\n            lng: point['longitude']\r\n        })\r\n    })\r\n    if (scanPath) {\r\n        scanPath.setMap(null)\r\n    }\r\n    scanPath = new google.maps.Polyline({\r\n        path: scanPathPoints,\r\n        geodesic: true,\r\n        strokeColor: '#FF0000',\r\n        strokeOpacity: 1.0,\r\n        strokeWeight: 2,\r\n        map: map\r\n    })\r\n}\r\n\r\nfunction redrawPokemon(pokemonList) {\r\n    var skipNotification = true\r\n    $.each(pokemonList, function (key, value) {\r\n        var item = pokemonList[key]\r\n        if (!item.hidden) {\r\n            if (item.marker.rangeCircle) item.marker.rangeCircle.setMap(null)\r\n            var newMarker = setupPokemonMarker(item, map, this.marker.animationDisabled)\r\n            customizePokemonMarker(newMarker, item, skipNotification)\r\n            item.marker.setMap(null)\r\n            pokemonList[key].marker = newMarker\r\n        }\r\n    })\r\n}\r\n\r\nvar updateLabelDiffTime = function updateLabelDiffTime() {\r\n    $('.label-countdown').each(function (index, element) {\r\n        var disappearsAt = getTimeUntil(parseInt(element.getAttribute('disappears-at')))\r\n\r\n        var hours = disappearsAt.hour\r\n        var minutes = disappearsAt.min\r\n        var seconds = disappearsAt.sec\r\n        var timestring = ''\r\n\r\n        if (disappearsAt.ttime < disappearsAt.now) {\r\n            timestring = '(expired)'\r\n        } else {\r\n            timestring = '('\r\n            if (hours > 0) {\r\n                timestring = hours + 'h'\r\n            }\r\n\r\n            timestring += lpad(minutes, 2, 0) + 'm'\r\n            timestring += lpad(seconds, 2, 0) + 's'\r\n            timestring += ')'\r\n        }\r\n\r\n        $(element).text(timestring)\r\n    })\r\n}\r\n\r\nfunction getPointDistance(pointA, pointB) {\r\n    return google.maps.geometry.spherical.computeDistanceBetween(pointA, pointB)\r\n}\r\n\r\nfunction sendNotification(title, text, icon, lat, lng) {\r\n    if (!('Notification' in window)) {\r\n        return false // Notifications are not present in browser\r\n    }\r\n\r\n    if (Notification.permission !== 'granted') {\r\n        Notification.requestPermission()\r\n    } else {\r\n        var notification = new Notification(title, {\r\n            icon: icon,\r\n            body: text,\r\n            sound: 'sounds/ding.mp3'\r\n        })\r\n\r\n        notification.onclick = function () {\r\n            window.focus()\r\n            notification.close()\r\n\r\n            centerMap(lat, lng, 20)\r\n        }\r\n    }\r\n}\r\n\r\nfunction createMyLocationButton() {\r\n    var locationContainer = document.createElement('div')\r\n\r\n    var locationButton = document.createElement('button')\r\n    locationButton.style.backgroundColor = '#fff'\r\n    locationButton.style.border = 'none'\r\n    locationButton.style.outline = 'none'\r\n    locationButton.style.width = '28px'\r\n    locationButton.style.height = '28px'\r\n    locationButton.style.borderRadius = '2px'\r\n    locationButton.style.boxShadow = '0 1px 4px rgba(0,0,0,0.3)'\r\n    locationButton.style.cursor = 'pointer'\r\n    locationButton.style.marginRight = '10px'\r\n    locationButton.style.padding = '0px'\r\n    locationButton.title = 'My Location'\r\n    locationContainer.appendChild(locationButton)\r\n\r\n    var locationIcon = document.createElement('div')\r\n    locationIcon.style.margin = '5px'\r\n    locationIcon.style.width = '18px'\r\n    locationIcon.style.height = '18px'\r\n    locationIcon.style.backgroundImage = 'url(static/mylocation-sprite-1x.png)'\r\n    locationIcon.style.backgroundSize = '180px 18px'\r\n    locationIcon.style.backgroundPosition = '0px 0px'\r\n    locationIcon.style.backgroundRepeat = 'no-repeat'\r\n    locationIcon.id = 'current-location'\r\n    locationButton.appendChild(locationIcon)\r\n\r\n    locationButton.addEventListener('click', function () {\r\n        centerMapOnLocation()\r\n    })\r\n\r\n    locationContainer.index = 1\r\n    map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(locationContainer)\r\n\r\n    google.maps.event.addListener(map, 'dragend', function () {\r\n        var currentLocation = document.getElementById('current-location')\r\n        currentLocation.style.backgroundPosition = '0px 0px'\r\n    })\r\n}\r\n\r\nfunction centerMapOnLocation() {\r\n    var currentLocation = document.getElementById('current-location')\r\n    if (currentLocation !== null) {\r\n        var imgX = '0'\r\n        var animationInterval = setInterval(function () {\r\n            if (imgX === '-18') {\r\n                imgX = '0'\r\n            } else {\r\n                imgX = '-18'\r\n            }\r\n            currentLocation.style.backgroundPosition = imgX + 'px 0'\r\n        }, 500)\r\n    }\r\n    if (navigator.geolocation) {\r\n        navigator.geolocation.getCurrentPosition(function (position) {\r\n            var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)\r\n            locationMarker.setPosition(latlng)\r\n            map.setCenter(latlng)\r\n            Store.set('followMyLocationPosition', {\r\n                lat: position.coords.latitude,\r\n                lng: position.coords.longitude\r\n            })\r\n            clearInterval(animationInterval)\r\n            if (currentLocation !== null) {\r\n                currentLocation.style.backgroundPosition = '-144px 0px'\r\n            }\r\n        })\r\n    } else {\r\n        clearInterval(animationInterval)\r\n        if (currentLocation !== null) {\r\n            currentLocation.style.backgroundPosition = '0px 0px'\r\n        }\r\n    }\r\n}\r\n\r\nfunction changeLocation(lat, lng) {\r\n    var loc = new google.maps.LatLng(lat, lng)\r\n    map.setCenter(loc)\r\n}\r\n\r\nfunction centerMap(lat, lng, zoom) {\r\n    var loc = new google.maps.LatLng(lat, lng)\r\n\r\n    map.setCenter(loc)\r\n\r\n    if (zoom) {\r\n        storeZoom = false\r\n        map.setZoom(zoom)\r\n    }\r\n}\r\n\r\nfunction i8ln(word) {\r\n    if ($.isEmptyObject(i8lnDictionary) && language !== 'en' && languageLookups < languageLookupThreshold) {\r\n        $.ajax({\r\n            url: 'static/dist/locales/' + language + '.min.json',\r\n            dataType: 'json',\r\n            async: false,\r\n            success: function success(data) {\r\n                i8lnDictionary = data\r\n            },\r\n            error: function error(jqXHR, status, _error) {\r\n                console.log('Error loading i8ln dictionary: ' + _error)\r\n                languageLookups++\r\n            }\r\n        })\r\n    }\r\n    if (word in i8lnDictionary) {\r\n        return i8lnDictionary[word]\r\n    } else {\r\n        // Word doesn't exist in dictionary return it as is\r\n        return word\r\n    }\r\n}\r\n\r\nfunction updateGeoLocation() {\r\n    if (navigator.geolocation && Store.get('followMyLocation')) {\r\n        navigator.geolocation.getCurrentPosition(function (position) {\r\n            var lat = position.coords.latitude\r\n            var lng = position.coords.longitude\r\n            var center = new google.maps.LatLng(lat, lng)\r\n\r\n            if (Store.get('followMyLocation')) {\r\n                if (typeof locationMarker !== 'undefined' && getPointDistance(locationMarker.getPosition(), center) >= 5) {\r\n                    map.panTo(center)\r\n                    locationMarker.setPosition(center)\r\n                    Store.set('followMyLocationPosition', {\r\n                        lat: lat,\r\n                        lng: lng\r\n                    })\r\n                }\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nfunction createUpdateWorker() {\r\n    try {\r\n        if (isMobileDevice() && window.Worker) {\r\n            var updateBlob = new Blob([\"onmessage = function(e) {\\n                var data = e.data\\n                if (data.name === 'backgroundUpdate') {\\n                    self.setInterval(function () {self.postMessage({name: 'backgroundUpdate'})}, 5000)\\n                }\\n            }\"])\r\n\r\n            var updateBlobURL = window.URL.createObjectURL(updateBlob)\r\n\r\n            updateWorker = new Worker(updateBlobURL)\r\n\r\n            updateWorker.onmessage = function (e) {\r\n                var data = e.data\r\n                if (document.hidden && data.name === 'backgroundUpdate' && Date.now() - lastUpdateTime > 2500) {\r\n                    updateMap()\r\n                    updateGeoLocation()\r\n                }\r\n            }\r\n\r\n            updateWorker.postMessage({\r\n                name: 'backgroundUpdate'\r\n            })\r\n        }\r\n    } catch (ex) {\r\n        console.log('Webworker error: ' + ex.message)\r\n    }\r\n}\r\n\r\nfunction showGymDetails(id) {\r\n    // eslint-disable-line no-unused-vars\r\n    var sidebar = document.querySelector('#gym-details')\r\n    var sidebarClose\r\n\r\n    sidebar.classList.add('visible')\r\n\r\n    var data = $.ajax({\r\n        url: 'gym_data',\r\n        type: 'GET',\r\n        timeout: 300000,\r\n        data: {\r\n            'id': id\r\n        },\r\n        dataType: 'json',\r\n        cache: false\r\n    })\r\n\r\n    data.done(function (result) {\r\n        var gymLevel = getGymLevel(result.gym_points)\r\n        var nextLvlPrestige = gymPrestige[gymLevel - 1] || 50000\r\n        var prestigePercentage = result.gym_points / nextLvlPrestige * 100\r\n        var lastModifiedStr = getDateStr(result.last_modified)\r\n        var lastScannedStr = ''\r\n        if (result.last_scanned != null) {\r\n            lastScannedStr =\r\n                '<div style=\"font-size: .7em\">' +\r\n                'Last Scanned: ' + getDateStr(result.last_scanned) +\r\n                '</div>'\r\n        }\r\n        var pokemon = result.pokemon !== undefined ? result.pokemon : []\r\n        var freeSlots = pokemon.length ? gymLevel - pokemon.length : 0\r\n        var freeSlotsStr = freeSlots ? ' - ' + freeSlots + ' Free Slots' : ''\r\n        var gymLevelStr = ''\r\n\r\n        if (result.team_id === 0) {\r\n            gymLevelStr =\r\n                '<center class=\"team-' + result.team_id + '-text\">' +\r\n                '<b class=\"team-' + result.team_id + '-text\">Uncontested - 1 Free Slot</b>' +\r\n                '</center>'\r\n        } else {\r\n            gymLevelStr =\r\n                '<div>' +\r\n                '<b class=\"team-' + result.team_id + '-text\">Level ' + gymLevel + freeSlotsStr + '</b>' +\r\n                '</div>'\r\n        }\r\n\r\n        var pokemonHtml = ''\r\n\r\n        var headerHtml =\r\n            '<center class=\"team-' + result.team_id + '-text\">' +\r\n            '<div>' +\r\n            '<b class=\"team-' + result.team_id + '-text\">' + (result.name || '') + '</b>' +\r\n            '</div>' +\r\n            '<img height=\"100px\" style=\"padding: 5px\" src=\"static/forts/' + gymTypes[result.team_id] + '_large.png\">' +\r\n            '<div class=\"prestige-bar team-' + result.team_id + '\">' +\r\n            '<div class=\"prestige team-' + result.team_id + '\" style=\"width: ' + prestigePercentage + '%\">' +\r\n            '</div>' +\r\n            '</div>' +\r\n            '<div>' +\r\n            result.gym_points + '/' + nextLvlPrestige +\r\n            '</div>' +\r\n            gymLevelStr +\r\n            '<div style=\"font-size: .7em\">' +\r\n            'Last Modified: ' + lastModifiedStr +\r\n            '</div>' +\r\n            lastScannedStr +\r\n            '<div>' +\r\n            '<a href=\\'javascript:void(0)\\' onclick=\\'javascript:openMapDirections(' + result.latitude + ',' + result.longitude + ')\\' title=\\'View in Maps\\'>Get directions</a>' +\r\n            '</div>' +\r\n            '</center>'\r\n\r\n        if (pokemon.length) {\r\n            $.each(pokemon, function (i, pokemon) {\r\n                var perfectPercent = getIv(pokemon.iv_attack, pokemon.iv_defense, pokemon.iv_stamina)\r\n                var moveEnergy = Math.round(100 / pokemon.move_2_energy)\r\n\r\n                pokemonHtml +=\r\n                    '<tr onclick=toggleGymPokemonDetails(this)>' +\r\n                    '<td width=\"30px\">' +\r\n                    '<i class=\"pokemon-sprite n' + pokemon.pokemon_id + '\"></i>' +\r\n                    '</td>' +\r\n                    '<td class=\"team-' + result.team_id + '-text\">' +\r\n                    '<div style=\"line-height:1em\">' + pokemon.pokemon_name + '</div>' +\r\n                    '<div class=\"cp\">CP ' + pokemon.pokemon_cp + '</div>' +\r\n                    '</td>' +\r\n                    '<td width=\"190\" class=\"team-' + result.team_id + '-text\" align=\"center\">' +\r\n                    '<div class=\"trainer-level\">' + pokemon.trainer_level + '</div>' +\r\n                    '<div style=\"line-height: 1em\">' + pokemon.trainer_name + '</div>' +\r\n                    '</td>' +\r\n                    '<td width=\"10\">' +\r\n                    '<!--<a href=\"#\" onclick=\"toggleGymPokemonDetails(this)\">-->' +\r\n                    '<i class=\"team-' + result.team_id + '-text fa fa-angle-double-down\"></i>' +\r\n                    '<!--</a>-->' +\r\n                    '</td>' +\r\n                    '</tr>' +\r\n                    '<tr class=\"details\">' +\r\n                    '<td colspan=\"2\">' +\r\n                    '<div class=\"ivs\">' +\r\n                    '<div class=\"iv\">' +\r\n                    '<div class=\"type\">ATK</div>' +\r\n                    '<div class=\"value\">' +\r\n                    pokemon.iv_attack +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"iv\">' +\r\n                    '<div class=\"type\">DEF</div>' +\r\n                    '<div class=\"value\">' +\r\n                    pokemon.iv_defense +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"iv\">' +\r\n                    '<div class=\"type\">STA</div>' +\r\n                    '<div class=\"value\">' +\r\n                    pokemon.iv_stamina +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"iv\" style=\"width: 36px\">' +\r\n                    '<div class=\"type\">PERFECT</div>' +\r\n                    '<div class=\"value\">' +\r\n                    perfectPercent.toFixed(0) + '' +\r\n                    '<span style=\"font-size: .6em\">%</span>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</td>' +\r\n                    '<td colspan=\"2\">' +\r\n                    '<div class=\"moves\">' +\r\n                    '<div class=\"move\">' +\r\n                    '<div class=\"name\">' +\r\n                    pokemon.move_1_name +\r\n                    ' <div class=\"type ' + pokemon.move_1_type.toLowerCase() + '\">' + pokemon.move_1_type + '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"damage\">' +\r\n                    pokemon.move_1_damage +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<br>' +\r\n                    '<div class=\"move\">' +\r\n                    '<div class=\"name\">' +\r\n                    pokemon.move_2_name +\r\n                    ' <div class=\"type ' + pokemon.move_2_type.toLowerCase() + '\">' + pokemon.move_2_type + '</div>' +\r\n                    '<div>' +\r\n                    '<i class=\"move-bar-sprite move-bar-sprite-' + moveEnergy + '\"></i>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '<div class=\"damage\">' +\r\n                    pokemon.move_2_damage +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</div>' +\r\n                    '</td>' +\r\n                    '</tr>'\r\n            })\r\n\r\n            pokemonHtml = '<table><tbody>' + pokemonHtml + '</tbody></table>'\r\n        } else if (result.team_id === 0) {\r\n            pokemonHtml = ''\r\n        } else {\r\n            pokemonHtml =\r\n                '<center class=\"team-' + result.team_id + '-text\">' +\r\n                'Gym Leader:<br>' +\r\n                '<i class=\"pokemon-large-sprite n' + result.guard_pokemon_id + '\"></i><br>' +\r\n                '<b class=\"team-' + result.team_id + '-text\">' + result.guard_pokemon_name + '</b>' +\r\n                '<p style=\"font-size: .75em margin: 5px\">' +\r\n                'No additional gym information is available for this gym. Make sure you are collecting detailed gym info. If you have detailed gym info collection running, this gym\\'s Pokemon information may be out of date.' +\r\n                '</p>' +\r\n                '</center>'\r\n        }\r\n\r\n        sidebar.innerHTML = headerHtml + pokemonHtml\r\n\r\n        sidebarClose = document.createElement('a')\r\n        sidebarClose.href = '#'\r\n        sidebarClose.className = 'close'\r\n        sidebarClose.tabIndex = 0\r\n        sidebar.appendChild(sidebarClose)\r\n\r\n        sidebarClose.addEventListener('click', function (event) {\r\n            event.preventDefault()\r\n            event.stopPropagation()\r\n            sidebar.classList.remove('visible')\r\n        })\r\n    })\r\n}\r\n\r\nfunction toggleGymPokemonDetails(e) { // eslint-disable-line no-unused-vars\r\n    e.lastElementChild.firstElementChild.classList.toggle('fa-angle-double-up')\r\n    e.lastElementChild.firstElementChild.classList.toggle('fa-angle-double-down')\r\n    e.nextElementSibling.classList.toggle('visible')\r\n}\r\n\r\n//\r\n// Page Ready Exection\r\n//\r\n\r\n$(function () {\r\n    try {\r\n        if (!Notification) {\r\n            console.log('could not load notifications')\r\n            return\r\n        }\r\n    } catch (err) {\r\n    }\r\n\r\n    try {\r\n        if (Notification.permission !== 'granted') {\r\n            Notification.requestPermission()\r\n        }\r\n    } catch (err) {\r\n    }\r\n})\r\n\r\n$(function () {\r\n    // populate Navbar Style menu\r\n    $selectStyle = $('#map-style')\r\n\r\n    // Load Stylenames, translate entries, and populate lists\r\n    $.getJSON('static/dist/data/mapstyle.min.json').done(function (data) {\r\n        var styleList = []\r\n\r\n        $.each(data, function (key, value) {\r\n            styleList.push({\r\n                id: key,\r\n                text: i8ln(value)\r\n            })\r\n        })\r\n\r\n        // setup the stylelist\r\n        $selectStyle.select2({\r\n            placeholder: 'Select Style',\r\n            data: styleList,\r\n            minimumResultsForSearch: Infinity\r\n        })\r\n\r\n        // setup the list change behavior\r\n        $selectStyle.on('change', function (e) {\r\n            selectedStyle = $selectStyle.val()\r\n            map.setMapTypeId(selectedStyle)\r\n            Store.set('map_style', selectedStyle)\r\n        })\r\n\r\n        // recall saved mapstyle\r\n        $selectStyle.val(Store.get('map_style')).trigger('change')\r\n    })\r\n\r\n    $selectIconResolution = $('#pokemon-icons')\r\n\r\n    $selectIconResolution.select2({\r\n        placeholder: 'Select Icon Resolution',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectIconResolution.on('change', function () {\r\n        Store.set('pokemonIcons', this.value)\r\n        redrawPokemon(mapData.pokemons)\r\n        redrawPokemon(mapData.lurePokemons)\r\n    })\r\n\r\n    $selectIconSize = $('#pokemon-icon-size')\r\n\r\n    $selectIconSize.select2({\r\n        placeholder: 'Select Icon Size',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectIconSize.on('change', function () {\r\n        Store.set('iconSizeModifier', this.value)\r\n        redrawPokemon(mapData.pokemons)\r\n        redrawPokemon(mapData.lurePokemons)\r\n    })\r\n\r\n    $selectOpenGymsOnly = $('#open-gyms-only-switch')\r\n\r\n    $selectOpenGymsOnly.select2({\r\n        placeholder: 'Only Show Open Gyms',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectOpenGymsOnly.on('change', function () {\r\n        Store.set('showOpenGymsOnly', this.value)\r\n        lastgyms = false\r\n        updateMap()\r\n    })\r\n\r\n    $selectTeamGymsOnly = $('#team-gyms-only-switch')\r\n\r\n    $selectTeamGymsOnly.select2({\r\n        placeholder: 'Only Show Gyms For Team',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectTeamGymsOnly.on('change', function () {\r\n        Store.set('showTeamGymsOnly', this.value)\r\n        lastgyms = false\r\n        updateMap()\r\n    })\r\n\r\n    $selectLastUpdateGymsOnly = $('#last-update-gyms-switch')\r\n\r\n    $selectLastUpdateGymsOnly.select2({\r\n        placeholder: 'Only Show Gyms Last Updated',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectLastUpdateGymsOnly.on('change', function () {\r\n        Store.set('showLastUpdatedGymsOnly', this.value)\r\n        lastgyms = false\r\n        updateMap()\r\n    })\r\n\r\n    $selectMinGymLevel = $('#min-level-gyms-filter-switch')\r\n\r\n    $selectMinGymLevel.select2({\r\n        placeholder: 'Minimum Gym Level',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectMinGymLevel.on('change', function () {\r\n        Store.set('minGymLevel', this.value)\r\n        lastgyms = false\r\n        updateMap()\r\n    })\r\n\r\n    $selectMaxGymLevel = $('#max-level-gyms-filter-switch')\r\n\r\n    $selectMaxGymLevel.select2({\r\n        placeholder: 'Maximum Gym Level',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectMaxGymLevel.on('change', function () {\r\n        Store.set('maxGymLevel', this.value)\r\n        lastgyms = false\r\n        updateMap()\r\n    })\r\n\r\n    $selectLuredPokestopsOnly = $('#lured-pokestops-only-switch')\r\n\r\n    $selectLuredPokestopsOnly.select2({\r\n        placeholder: 'Only Show Lured Pokestops',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectLuredPokestopsOnly.on('change', function () {\r\n        Store.set('showLuredPokestopsOnly', this.value)\r\n        lastpokestops = false\r\n        updateMap()\r\n    })\r\n    $switchGymSidebar = $('#gym-sidebar-switch')\r\n\r\n    $switchGymSidebar.on('change', function () {\r\n        Store.set('useGymSidebar', this.checked)\r\n        lastgyms = false\r\n        $.each(['gyms'], function (d, dType) {\r\n            $.each(mapData[dType], function (key, value) {\r\n                // for any marker you're turning off, you'll want to wipe off the range\r\n                if (mapData[dType][key].marker.rangeCircle) {\r\n                    mapData[dType][key].marker.rangeCircle.setMap(null)\r\n                    delete mapData[dType][key].marker.rangeCircle\r\n                }\r\n                mapData[dType][key].marker.setMap(null)\r\n            })\r\n            mapData[dType] = {}\r\n        })\r\n        updateMap()\r\n    })\r\n\r\n    $selectLocationIconMarker = $('#locationmarker-style')\r\n\r\n    $.getJSON('static/dist/data/searchmarkerstyle.min.json').done(function (data) {\r\n        searchMarkerStyles = data\r\n        var searchMarkerStyleList = []\r\n\r\n        $.each(data, function (key, value) {\r\n            searchMarkerStyleList.push({\r\n                id: key,\r\n                text: value.name\r\n            })\r\n        })\r\n\r\n        locationMarker = createLocationMarker()\r\n\r\n        if (Store.get('startAtUserLocation')) {\r\n            centerMapOnLocation()\r\n        }\r\n\r\n        if (Store.get('startAtLastLocation')) {\r\n            var position = Store.get('startAtLastLocationPosition')\r\n            var lat = 'lat' in position ? position.lat : centerLat\r\n            var lng = 'lng' in position ? position.lng : centerLng\r\n\r\n            var latlng = new google.maps.LatLng(lat, lng)\r\n            locationMarker.setPosition(latlng)\r\n            map.setCenter(latlng)\r\n        }\r\n\r\n        $selectLocationIconMarker.select2({\r\n            placeholder: 'Select Location Marker',\r\n            data: searchMarkerStyleList,\r\n            minimumResultsForSearch: Infinity\r\n        })\r\n\r\n        $selectLocationIconMarker.on('change', function (e) {\r\n            Store.set('locationMarkerStyle', this.value)\r\n            updateLocationMarker(this.value)\r\n        })\r\n\r\n        $selectLocationIconMarker.val(Store.get('locationMarkerStyle')).trigger('change')\r\n    })\r\n\r\n    $selectGymMarkerStyle = $('#gym-marker-style')\r\n\r\n    $selectGymMarkerStyle.select2({\r\n        placeholder: 'Select Style',\r\n        minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectGymMarkerStyle.on('change', function (e) {\r\n        Store.set('gymMarkerStyle', this.value)\r\n        updateGymIcons()\r\n    })\r\n\r\n    $selectGymMarkerStyle.val(Store.get('gymMarkerStyle')).trigger('change')\r\n})\r\n\r\n$(function () {\r\n    function formatState(state) {\r\n        if (!state.id) {\r\n            return state.text\r\n        }\r\n        var $state = $('<span><i class=\"pokemon-sprite n' + state.element.value.toString() + '\"></i> ' + state.text + '</span>')\r\n        return $state\r\n    }\r\n\r\n    $.getJSON('static/dist/data/moves.min.json').done(function (data) {\r\n        moves = data\r\n    })\r\n\r\n    $selectExclude = $('#exclude-pokemon')\r\n    $selectPokemonNotify = $('#notify-pokemon')\r\n    $selectRarityNotify = $('#notify-rarity')\r\n    $textPerfectionNotify = $('#notify-perfection')\r\n    var numberOfPokemon = 493\r\n\r\n    // Load pokemon names and populate lists\r\n    $.getJSON('static/dist/data/pokemon.min.json').done(function (data) {\r\n        var pokeList = []\r\n\r\n        $.each(data, function (key, value) {\r\n            if (key > numberOfPokemon) {\r\n                return false\r\n            }\r\n            var _types = []\r\n            pokeList.push({\r\n                id: key,\r\n                text: i8ln(value['name']) + ' - #' + key\r\n            })\r\n            value['name'] = i8ln(value['name'])\r\n            value['rarity'] = i8ln(value['rarity'])\r\n            $.each(value['types'], function (key, pokemonType) {\r\n                _types.push({\r\n                    'type': i8ln(pokemonType['type']),\r\n                    'color': pokemonType['color']\r\n                })\r\n            })\r\n            value['types'] = _types\r\n            idToPokemon[key] = value\r\n        })\r\n\r\n        // setup the filter lists\r\n        $selectExclude.select2({\r\n            placeholder: i8ln('Select Pokmon'),\r\n            data: pokeList,\r\n            templateResult: formatState\r\n        })\r\n        $selectPokemonNotify.select2({\r\n            placeholder: i8ln('Select Pokmon'),\r\n            data: pokeList,\r\n            templateResult: formatState\r\n        })\r\n        $selectRarityNotify.select2({\r\n            placeholder: i8ln('Select Rarity'),\r\n            data: [i8ln('Common'), i8ln('Uncommon'), i8ln('Rare'), i8ln('Very Rare'), i8ln('Ultra Rare')],\r\n            templateResult: formatState\r\n        })\r\n\r\n        // setup list change behavior now that we have the list to work from\r\n        $selectExclude.on('change', function (e) {\r\n            buffer = excludedPokemon\r\n            excludedPokemon = $selectExclude.val().map(Number)\r\n            buffer = buffer.filter(function (e) {\r\n                return this.indexOf(e) < 0\r\n            }, excludedPokemon)\r\n            reincludedPokemon = reincludedPokemon.concat(buffer)\r\n            clearStaleMarkers()\r\n            Store.set('remember_select_exclude', excludedPokemon)\r\n        })\r\n        $selectPokemonNotify.on('change', function (e) {\r\n            notifiedPokemon = $selectPokemonNotify.val().map(Number)\r\n            Store.set('remember_select_notify', notifiedPokemon)\r\n        })\r\n        $selectRarityNotify.on('change', function (e) {\r\n            notifiedRarity = $selectRarityNotify.val().map(String)\r\n            Store.set('remember_select_rarity_notify', notifiedRarity)\r\n        })\r\n        $textPerfectionNotify.on('change', function (e) {\r\n            notifiedMinPerfection = parseInt($textPerfectionNotify.val(), 10)\r\n            if (isNaN(notifiedMinPerfection) || notifiedMinPerfection <= 0) {\r\n                notifiedMinPerfection = ''\r\n            }\r\n            if (notifiedMinPerfection > 100) {\r\n                notifiedMinPerfection = 100\r\n            }\r\n            $textPerfectionNotify.val(notifiedMinPerfection)\r\n            Store.set('remember_text_perfection_notify', notifiedMinPerfection)\r\n        })\r\n\r\n        // recall saved lists\r\n        $selectExclude.val(Store.get('remember_select_exclude')).trigger('change')\r\n        $selectPokemonNotify.val(Store.get('remember_select_notify')).trigger('change')\r\n        $selectRarityNotify.val(Store.get('remember_select_rarity_notify')).trigger('change')\r\n        $textPerfectionNotify.val(Store.get('remember_text_perfection_notify')).trigger('change')\r\n\r\n        if (isTouchDevice() && isMobileDevice()) {\r\n            $('.select2-search input').prop('readonly', true)\r\n        }\r\n    })\r\n\r\n    // run interval timers to regularly update map and timediffs\r\n    window.setInterval(updateLabelDiffTime, 1000)\r\n    window.setInterval(updateMap, 5000)\r\n    window.setInterval(updateGeoLocation, 1000)\r\n\r\n    createUpdateWorker()\r\n\r\n    // Wipe off/restore map icons when switches are toggled\r\n    function buildSwitchChangeListener(data, dataType, storageKey) {\r\n        return function () {\r\n            Store.set(storageKey, this.checked)\r\n            if (this.checked) {\r\n                // When switch is turned on we asume it has been off, makes sure we dont end up in limbo\r\n                // Without this there could've been a situation where no markers are on map and only newly modified ones are loaded\r\n                if (storageKey === 'showPokemon') {\r\n                    lastpokemon = false\r\n                } else if (storageKey === 'showGyms') {\r\n                    lastgyms = false\r\n                } else if (storageKey === 'showPokestops') {\r\n                    lastpokestops = false\r\n                } else if (storageKey === 'showScanned') {\r\n                    lastslocs = false\r\n                } else if (storageKey === 'showSpawnpoints') {\r\n                    lastspawns = false\r\n                }\r\n                updateMap()\r\n            } else {\r\n                $.each(dataType, function (d, dType) {\r\n                    $.each(data[dType], function (key, value) {\r\n                        // for any marker you're turning off, you'll want to wipe off the range\r\n                        if (data[dType][key].marker.rangeCircle) {\r\n                            data[dType][key].marker.rangeCircle.setMap(null)\r\n                            delete data[dType][key].marker.rangeCircle\r\n                        }\r\n                        if (storageKey !== 'showRanges') data[dType][key].marker.setMap(null)\r\n                    })\r\n                    if (storageKey !== 'showRanges') data[dType] = {}\r\n                })\r\n                if (storageKey === 'showRanges') {\r\n                    updateMap()\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Setup UI element interactions\r\n    $('#gyms-switch').change(function () {\r\n        var options = {\r\n            'duration': 500\r\n        }\r\n        var wrapper = $('#gym-sidebar-wrapper')\r\n        if (this.checked) {\r\n            lastgyms = false\r\n            wrapper.show(options)\r\n        } else {\r\n            lastgyms = false\r\n            wrapper.hide(options)\r\n        }\r\n        var wrapper2 = $('#gyms-filter-wrapper')\r\n        if (this.checked) {\r\n            lastgyms = false\r\n            wrapper2.show(options)\r\n        } else {\r\n            lastgyms = false\r\n            wrapper2.hide(options)\r\n        }\r\n        buildSwitchChangeListener(mapData, ['gyms'], 'showGyms').bind(this)()\r\n    })\r\n    $('#pokemon-switch').change(function () {\r\n        buildSwitchChangeListener(mapData, ['pokemons'], 'showPokemon').bind(this)()\r\n    })\r\n    $('#scanned-switch').change(function () {\r\n        buildSwitchChangeListener(mapData, ['scanned'], 'showScanned').bind(this)()\r\n    })\r\n    $('#spawnpoints-switch').change(function () {\r\n        buildSwitchChangeListener(mapData, ['spawnpoints'], 'showSpawnpoints').bind(this)()\r\n    })\r\n    $('#ranges-switch').change(buildSwitchChangeListener(mapData, ['gyms', 'pokemons', 'pokestops'], 'showRanges'))\r\n\r\n    $('#pokestops-switch').change(function () {\r\n        var options = {\r\n            'duration': 500\r\n        }\r\n        var wrapper = $('#lured-pokestops-only-wrapper')\r\n        if (this.checked) {\r\n            lastpokestops = false\r\n            wrapper.show(options)\r\n        } else {\r\n            lastpokestops = false\r\n            wrapper.hide(options)\r\n        }\r\n        return buildSwitchChangeListener(mapData, ['pokestops'], 'showPokestops').bind(this)()\r\n    })\r\n\r\n    $('#sound-switch').change(function () {\r\n        Store.set('playSound', this.checked)\r\n    })\r\n\r\n    $('#start-at-user-location-switch').change(function () {\r\n        Store.set('startAtUserLocation', this.checked)\r\n        if (this.checked === true && Store.get('startAtLastLocation') === true) {\r\n            Store.set('startAtLastLocation', false)\r\n            $('#start-at-last-location-switch').prop('checked', false)\r\n        }\r\n    })\r\n\r\n    $('#start-at-last-location-switch').change(function () {\r\n        Store.set('startAtLastLocation', this.checked)\r\n        if (this.checked === true && Store.get('startAtUserLocation') === true) {\r\n            Store.set('startAtUserLocation', false)\r\n            $('#start-at-user-location-switch').prop('checked', false)\r\n        }\r\n    })\r\n\r\n    $('#follow-my-location-switch').change(function () {\r\n        if (!navigator.geolocation) {\r\n            this.checked = false\r\n        } else {\r\n            Store.set('followMyLocation', this.checked)\r\n        }\r\n        locationMarker.setDraggable(!this.checked)\r\n    })\r\n\r\n    if ($('#nav-accordion').length) {\r\n        $('#nav-accordion').accordion({\r\n            active: 0,\r\n            collapsible: true,\r\n            heightStyle: 'content'\r\n        })\r\n    }\r\n\r\n    // Initialize dataTable in statistics sidebar\r\n    //   - turn off sorting for the 'icon' column\r\n    //   - initially sort 'name' column alphabetically\r\n\r\n    $('#pokemonList_table').DataTable({\r\n        paging: false,\r\n        searching: false,\r\n        info: false,\r\n        errMode: 'throw',\r\n        'language': {\r\n            'emptyTable': ''\r\n        },\r\n        'columns': [{'orderable': false}, null, null, null]\r\n    }).order([1, 'asc'])\r\n})\r\n"]}