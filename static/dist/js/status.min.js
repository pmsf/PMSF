/*
 pogomap 2017-02-17 
*/

"use strict";function addMainWorker(a){var b='\n     <div id="worker_'+a+'" class="worker">\n       <span id="name_'+a+'" class="name"></span>\n       <span id="method_'+a+'" class="method"></span>\n       <span id="message_'+a+'" class="message"></span>\n     </div>\n   ';$(b).appendTo("#status_container"),addTable(a)}function processMainWorker(a,b){var c=hashFnv32a(b.worker_name,!0);0===$("#worker_"+c).length&&addMainWorker(c),$("#name_"+c).html(b.worker_name),$("#method_"+c).html("("+b.method+")"),$("#message_"+c).html(b.message.replace(/\n/g,"<br>"))}function addWorker(a,b){var c='\n     <div id="row_'+b+'" class="status_row">\n       <div id="username_'+b+'" class="status_cell"/>\n       <div id="success_'+b+'"  class="status_cell"/>\n       <div id="fail_'+b+'"     class="status_cell"/>\n       <div id="no_items_'+b+'"  class="status_cell"/>\n       <div id="skip_'+b+'"     class="status_cell"/>\n       <div id="captchas_'+b+'" class="status_cell"/>\n       <div id="lastmod_'+b+'"  class="status_cell"/>\n       <div id="message_'+b+'"  class="status_cell"/>\n     </div>\n   ';$(c).appendTo("#table_"+a)}function processWorker(a,b){var c=hashFnv32a(b.username,!0),d;if(groupByWorker){if(d=hashFnv32a(b.worker_name,!0),0===$("#table_"+d).length)return}else d="global",0===$("#table_global").length&&addTable("global");0===$("#row_"+c).length&&addWorker(d,c);var e=new Date(b.last_modified);e=e.getHours()+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getDate()+" "+monthArray[e.getMonth()]+" "+e.getFullYear(),$("#username_"+c).html(b.username),$("#success_"+c).html(b.success),$("#fail_"+c).html(b.fail),$("#no_items_"+c).html(b.no_items),$("#skip_"+c).html(b.skip),$("#captchas_"+c).html(b.captcha),$("#lastmod_"+c).html(e),$("#message_"+c).html(b.message)}function parseResult(a){groupByWorker&&$.each(a.main_workers,processMainWorker),$.each(a.workers,processWorker)}function addTable(a){var b='\n     <div class="status_table" id="table_'+a+'">\n       <div class="status_row header">\n         <div class="status_cell">\n           Username\n         </div>\n         <div class="status_cell">\n           Success\n         </div>\n         <div class="status_cell">\n           Fail\n         </div>\n         <div class="status_cell">\n           No Items\n         </div>\n         <div class="status_cell">\n           Skipped\n         </div>\n         <div class="status_cell">\n           Captchas\n         </div>\n         <div class="status_cell">\n           Last Modified\n         </div>\n         <div class="status_cell">\n           Message\n         </div>\n       </div>\n     </div>\n   ';b=$(b),b.appendTo("#status_container"),b.find(".status_row.header .status_cell").click(tableSort)}function tableSort(){var a=$(this).parents(".status_table").eq(0),b=a.find(".status_row:gt(0)").toArray().sort(compare($(this).index()));this.asc=!this.asc,this.asc||(b=b.reverse());for(var c=0;c<b.length;c++)a.append(b[c])}function getCellValue(a,b){return $(a).children(".status_cell").eq(b).html()}function compare(a){return function(b,c){var d=getCellValue(b,a),e=getCellValue(c,a);return $.isNumeric(d)&&$.isNumeric(e)?d-e:d.localeCompare(e)}}function updateStatus(){loadRawData().done(function(a){parseResult(a)}).always(function(){var a=new Date-lastRawUpdateTime,b=Math.max(minUpdateDelay-a,1);window.setTimeout(updateStatus,b)})}function hashFnv32a(a,b,c){var d,e,f=void 0===c?2166136261:c;for(d=0,e=a.length;d<e;d++)f^=a.charCodeAt(d),f+=(f<<1)+(f<<4)+(f<<7)+(f<<8)+(f<<24);return b?("0000000"+(f>>>0).toString(16)).substr(-8):f>>>0}function loadRawData(){return $.ajax({url:"status",type:"post",data:{password:statusPagePassword},dataType:"json",beforeSend:function a(){return!rawDataIsLoading&&void(rawDataIsLoading=!0)},complete:function a(){rawDataIsLoading=!1}})}var monthArray=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],rawDataIsLoading=!1,statusPagePassword=!1,groupByWorker=!0,minUpdateDelay=1e3,lastRawUpdateTime=new Date;$(document).ready(function(){$("#password").focus(),$("#password_form").submit(function(a){a.preventDefault(),statusPagePassword=$("#password").val(),loadRawData().done(function(a){"ok"===a.login?($(".status_form").remove(),parseResult(a),window.setTimeout(updateStatus,minUpdateDelay)):($(".status_form").effect("bounce"),$("#password").focus())})}),$("#groupbyworker-switch").change(function(){groupByWorker=this.checked,$("#status_container .status_table").remove(),$("#status_container .worker").remove(),statusPagePassword&&updateStatus()})});
//# sourceMappingURL=status.min.js.map